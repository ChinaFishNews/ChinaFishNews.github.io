<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>含笑饮砒霜的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="含笑饮砒霜的博客">
<meta property="og:url" content="http://chinafish.news/index.html">
<meta property="og:site_name" content="含笑饮砒霜的博客">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="含笑饮砒霜的博客">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="含笑饮砒霜的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://tp1.sinaimg.cn/2185265952/180/5686790740/1" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">含笑饮砒霜</a></h1>
		</hgroup>

		
		<p class="header-subtitle">如果可以打造非凡应用 为什么要止步于过得去</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						<li>友情链接</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">概览</a></li>
				        
							<li><a href="/categories/进阶">进阶</a></li>
				        
							<li><a href="/categories/OC">OC</a></li>
				        
							<li><a href="/categories/Swift">Swift</a></li>
				        
							<li><a href="/categories/随笔">随笔</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/ChinaFishNews" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/2185265952/profile?topnav=1&wvr=6&is_all=1" title="weibo">weibo</a>
					        
								<a class="twitter" target="_blank" href="https://twitter.com/fishnewsdream" title="twitter">twitter</a>
					        
								<a class="linkedin" target="_blank" href="http://www.linkedin.com/in/新闻-余-ab2b19101?trk=nav_responsive_tab_profile_pic" title="linkedin">linkedin</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/AVPlayer、MoviePlayer/" style="font-size: 10px;">AVPlayer、MoviePlayer</a> <a href="/tags/Aspects-转载/" style="font-size: 10px;">Aspects,转载</a> <a href="/tags/Asstrill-Shadowsocks-云梯，壁虎漫步/" style="font-size: 10px;">Asstrill,Shadowsocks,云梯，壁虎漫步</a> <a href="/tags/Autolayout/" style="font-size: 10px;">Autolayout</a> <a href="/tags/BugHD/" style="font-size: 10px;">BugHD</a> <a href="/tags/Cocoapods/" style="font-size: 10px;">Cocoapods</a> <a href="/tags/Coding-net/" style="font-size: 10px;">Coding.net</a> <a href="/tags/Core-Graphics/" style="font-size: 10px;">Core Graphics</a> <a href="/tags/Fabric/" style="font-size: 15px;">Fabric</a> <a href="/tags/Git，GitHub-回滚，仓库/" style="font-size: 10px;">Git，GitHub,回滚，仓库</a> <a href="/tags/Leaks，Allocations-Time-Profiler/" style="font-size: 10px;">Leaks，Allocations,Time Profiler</a> <a href="/tags/MMPDeepSleepPreventer-后台无限运行/" style="font-size: 10px;">MMPDeepSleepPreventer,后台无限运行</a> <a href="/tags/MarkDown、Mou、Macdown/" style="font-size: 10px;">MarkDown、Mou、Macdown</a> <a href="/tags/Openfire-Spark/" style="font-size: 10px;">Openfire,Spark</a> <a href="/tags/Reveal/" style="font-size: 10px;">Reveal</a> <a href="/tags/RunTime-转载/" style="font-size: 10px;">RunTime,转载</a> <a href="/tags/UIBezierPath-CAShapeLayer/" style="font-size: 10px;">UIBezierPath,CAShapeLayer</a> <a href="/tags/YYKit/" style="font-size: 10px;">YYKit</a> <a href="/tags/免证书，免数据线/" style="font-size: 10px;">免证书，免数据线</a> <a href="/tags/奇巧淫技/" style="font-size: 10px;">奇巧淫技</a> <a href="/tags/奇技淫巧/" style="font-size: 10px;">奇技淫巧</a> <a href="/tags/支付宝SDK/" style="font-size: 10px;">支付宝SDK</a> <a href="/tags/环信SDK/" style="font-size: 10px;">环信SDK</a> <a href="/tags/装逼，特技/" style="font-size: 10px;">装逼，特技</a> <a href="/tags/证书，Application-Loader/" style="font-size: 10px;">证书，Application Loader</a> <a href="/tags/转载/" style="font-size: 20px;">转载</a> <a href="/tags/逆向工程/" style="font-size: 10px;">逆向工程</a> <a href="/tags/随笔/" style="font-size: 10px;">随笔</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.devtang.com">唐巧的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.superqq.com">刚刚在线</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://jj59.com">九九文章网</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cocoachina.com">CocoaChina</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.henishuo.com">标哥的技术博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/yiyaaixuexi/">念茜的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">14级毕业生,专注于iOS开发。创建Objective-C、Swift技术开发交流群201556264,欢迎加入，共同提高!</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">含笑饮砒霜</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://tp1.sinaimg.cn/2185265952/180/5686790740/1" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">含笑饮砒霜</h1>
			</hgroup>
			
			<p class="header-subtitle">如果可以打造非凡应用 为什么要止步于过得去</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">概览</a></li>
		        
					<li><a href="/categories/进阶">进阶</a></li>
		        
					<li><a href="/categories/OC">OC</a></li>
		        
					<li><a href="/categories/Swift">Swift</a></li>
		        
					<li><a href="/categories/随笔">随笔</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/ChinaFishNews" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/2185265952/profile?topnav=1&wvr=6&is_all=1" title="weibo">weibo</a>
			        
						<a class="twitter" target="_blank" href="https://twitter.com/fishnewsdream" title="twitter">twitter</a>
			        
						<a class="linkedin" target="_blank" href="http://www.linkedin.com/in/新闻-余-ab2b19101?trk=nav_responsive_tab_profile_pic" title="linkedin">linkedin</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-Xcode无证书无数据线调试" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/10/13/Xcode无证书无数据线调试/" class="article-date">
  	<time datetime="2017-10-12T16:00:00.000Z" itemprop="datePublished">2017-10-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/13/Xcode无证书无数据线调试/">Xcode免证书免数据线调试</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="http://music.163.com/outchain/player?type=2&id=406072372&auto=0&height=66"></iframe>


<h5 id="u4E00-__u514D_u8BC1_u4E66"><a href="#u4E00-__u514D_u8BC1_u4E66" class="headerlink" title="一. 免证书"></a>一. 免证书</h5><p>Xcode7之后，开发者调试终于可以不需要证书了，之前越狱后免除证书不算在内</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017.10.13_07.gif" alt=""></p>
<ul>
<li>步骤如上图所示</li>
<li>注意，Bundle Inentifier最好使用之前没用过的，否则可能不成功</li>
<li>上图步骤之后，钥匙串中已经自动生成了一个供本机使用的调试证书</li>
<li>如果App ID已经是开发者账号或者属于某个已付费的账号组里，会给该账号自动生成一个证书，可登陆苹果开发者中心查看。勾选Automatically manage signing后会自动生成Provisioning Prifile描述文件,当然可能会生成失败，会提示更换Bundle Identifier。如果该账号不是开发者账号，则仅会在本机生成一个可供调试的证书</li>
<li>如果有多个工程需要调试，调试时可修改Bundle Identifier为同一个值，否则可能会对频繁更改Bundle Identifier的App Id进行限制。</li>
<li>运行后依然会报错，会提示需要打开手机设置-&gt;通用-&gt;描述文件与设备管理中添加信任</li>
</ul>
<h5 id="u4E8C-_u514D_u6570_u636E_u7EBF"><a href="#u4E8C-_u514D_u6570_u636E_u7EBF" class="headerlink" title="二.免数据线"></a>二.免数据线</h5><p>Xcode9之后，终于可以免数据线调试了。这里说的免数据线并非完全脱离数据线，而是第一次使用数据线启动之后才可以脱离使用</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017.10.13_08.gif" alt=""></p>
<ul>
<li>步骤如上图所示，注意勾选Connect via network,即通过网络连接</li>
<li>注意，手机系统要求iOS11及以上</li>
<li>第一次启动需要连接数据线，并且手机和电脑需处于同一无线网环境下。第一次启动后，拔出数据线，这时候会发现设备依然连接着，选中运行即可</li>
<li>可以同时支持多台设备</li>
</ul>
<p>以上，即可实现免证书免数据线，平时方便自己调试，还随时可以给测试人员安装开发包临时测试</p>
<hr>
<p>如有任何疑问或问题请联系我:fishnewsdream@gmail.com,欢迎交流，共同提高！</p>
<p>Objective-C/Swift技术开发交流群201556264，讨论何种技术并不受限，欢迎各位大牛百家争鸣！</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">刚刚在线工作室</a>，欢迎关注或提出建设性意见！</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">刚刚在线论坛</a>, 欢迎踊跃提问或解答！</p>
<p>如有转载，请注明出处，谢谢！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/免证书，免数据线/">免证书，免数据线</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/OC/">OC</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-六月" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/05/31/六月/" class="article-date">
  	<time datetime="2017-05-30T16:00:00.000Z" itemprop="datePublished">2017-05-31</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/31/六月/">六月</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="http://music.163.com/outchain/player?type=2&id=159401&auto=0&height=66"></iframe>



<p>又到六一了，去年的这个时候和老大请了半天假，陪伴另一个儿童。今年那个儿童又长大了一岁，应该也不需要我再请假陪伴了。端午这三天假才刚准备进入状态就火速结束了(此处没有事后烟)，可怜那个儿童连着三天都上班，我也不能挥霍的太过分，简直了。</p>
<p>七年过去了，七年是什么概念，可能当时你身体都可以进入的人现在连朋友圈都进不了了。还有一周又要高考了，我记得那会最后一门英语考的时候外面乌黑一片，山雨欲来风满楼，仿佛是为了我考试灾难性的结果买下伏笔，根本无心静下来思考，虽然不知道填的啥但就觉得填的是对的，这想法也是没谁了，这也是整个高考期间的缩影。我记得第一天考试正是NBA总决赛湖人VS绿军的第七场，晚上我竟然丧心病狂的去网吧看了下比赛回放，这把我激动的，晚上觉都没睡好。事后想了下，这可能也是为了衬托我考试灾难性的后果，毕竟以乐景写哀更见其哀。这一年又一年过去了，每年都会想起，无法释怀，又怎么去释怀。多说有泪，不能再说了~</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_05_31_01.jpg" alt=""></p>
<p>现在又逢NBA总决赛及欧冠决赛了，借此预测一波，勇士4：1骑士 or 4：2夺冠，皇马1：0尤文 or 2：1夺冠，坐等被证实。现在我还记得13年那个夏天我预测好声音汪峰组张恒远夺冠，结果很明显。</p>
<p>都说爱笑的女生运气不会太差，而JJ长的男生，亦是如此，然而运气不错，但也架不住明目张胆的折腾。这几天中金某领导潜规则实习生，据说此人年薪千万，然而掩盖不了low穿地心的本质。今年互联网平均年薪据调查首次超过金融业位居榜首，为十二万多，值得恭喜一波，讲真，我也不知道有啥值得恭喜的。《欢乐颂》最近这么火，里面的应勤又给广大IT男招黑了，其实不觉得有什么问题考虑到应勤自身的状况。一开始我还以为给IT男洗白了呢，谁知道闹了这么一出，平心而论，应勤配得上邱莹莹，但是否配得上邱莹莹的爱，仁者见仁了。好在最后两人又和好了，感情中这事没道理可讲，还是应了那句话，你说要敬往事一杯酒，再爱也不回头，然而就算你醉到黄昏独自愁，如果那人伸出手，你还是会跟他走！</p>
<p>金三银四铜五过去了，铁六锡七铝八就要来了。这一晃17年快过一半了，这一天天过得，纸醉金迷，酒肉池林。想做点什么，应该做点什么。于我而言，六月份是个比较独特的月份。要是有的选，我愿意牺牲点什么，换回之前几年的六月份，重新来过的机会。事实是，没有机会！</p>
<p>不打扰，我似乎很难做到，然而我似乎又做到了。是否有人知道我在说什么，谁知道呢，会有人的！</p>
<hr>
<p>如有任何疑问或问题请联系我:fishnewsdream@gmail.com,欢迎交流，共同提高！</p>
<p>Objective-C/Swift技术开发交流群201556264，讨论何种技术并不受限，欢迎各位大牛百家争鸣！</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">刚刚在线工作室</a>，欢迎关注或提出建设性意见！</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">刚刚在线论坛</a>, 欢迎踊跃提问或解答！</p>
<p>如有转载，请注明出处，谢谢！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/随笔/">随笔</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2016" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/01/2016/" class="article-date">
  	<time datetime="2016-12-31T16:00:00.000Z" itemprop="datePublished">2017-01-01</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/01/2016/">2016</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="http://music.163.com/outchain/player?type=2&id=28240119&auto=0&height=66"></iframe>

<p>16年永久性的成为了过往！</p>
<p>一如既往，朋友圈充满了各种过去一年的总结汇报以及来年的心愿展望，什么新的一年要成功脱单、加薪升职、胸再大点腰再细点、JJ再长点个子再高点之类的，像我这种只阅不发的人简直是一股清流。也不知道是男票女票不好玩还是不好用，竟然还有力气还有时间发动态，真是难得。微信各种群都是些骚乱的人们，当然可能并不乱。红包发个不停，抢了半天不够再发一个出去的，真是蛋疼，现在基本都不抢了。但是有个群例外，爱得威技术部，是我喜欢的氛围，要么不发，要发就数额不菲，都自觉的轮着来。想想离职快两年了也没退群，基本是装死的状态，一直也心系爱得威。那是我职业生涯的第一站，对我之后的各种装逼也产生了深远影响。现在想来，当时老大给的各种排期都比较宽松充裕，而年轻人总是急于冒进，每次都强行装逼觉得分分钟可以搞定，几次意外发生后也就吸取教训了。后来又来个新人，又在走我之前的老路，总是眼高于顶，你说给一天时间他说一小时足矣，结果很明显，脸打得啪啪响。时至今日，我的做事风格也归咎于此，需要一天的时间我可能会要两天，无他，只因可能会面临各种意外，而且提前搞定了还皆大欢喜。当时学到的各种基础对我后来也都起了极大的帮助，现在我所掌握的几门语言也都是在那段时间学习的，虽然有的现在已经仅剩点概念了。那会还学了半年日语，以至于每次看岛国爱情动作片的时候我都会下意识的去拼写日语单词，并尝试去纠正语法和发音，也学到了些许，是的。那也是我至今为止最为上进的一段时间吧，早上坐地铁全是背日语单词和课文，而现在我早上坐地铁关注的全tm是谁又偷我能量了，谁的能量又可以偷了，我罗是否又进球了，我科是不是又有什么记录被破了，偶尔心情好的话还会关注下周围妹子的罩杯大小，定期锻炼下眼力，真是堕落！</p>
<p>这几天又被余太逼着做饭了，我内心是拒绝的。这种属于细水长流的活岂是一朝一夕之事，想我16年全年厨艺都进步寥寥，也不知何时能大成！在上海的这几年，是真切的感受到了上海女人在家里的话语权实在太大，严重带坏了那些来上海工作的妹子们。开始来上海时都是妹子，后来都成了汉子，这些人最大的毛病就是妄图改造自己的另一半，自己却拒绝被改造。感情中最难能可贵的是什么，从来不是那些，彼此送的手表和项链，甚至也不是那些甜蜜的短信和合照，甚至都不是毫无保留的付出，而是彼此留在对方身上的，如同河流留给山川的，那些你对我，造成的改变。付出并不难，改变才是！也不知道何时才能顿悟，依然任重道远啊。</p>
<p>16年年初定的几个目标基本都完成了一半,希望自己稳重些，的确是重了不少；希望一年存款30万，结果果然存了有3万大概；希望在技术上有更多积累，所以微信上收藏了少说也有几百篇从未打开过的技术文章。一切都进展的难以置信的顺利，也不知道17年是个什么鸟样！</p>
<p>但是生活，最重要的是开心！</p>
<hr>
<p>如有任何疑问或问题请联系我:fishnewsdream@gmail.com,欢迎交流，共同提高！</p>
<p>Objective-C/Swift技术开发交流群201556264，讨论何种技术并不受限，欢迎各位大牛百家争鸣！</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">刚刚在线工作室</a>，欢迎关注或提出建设性意见！</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">刚刚在线论坛</a>, 欢迎踊跃提问或解答！</p>
<p>如有转载，请注明出处，谢谢！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/随笔/">随笔</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-追" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/09/18/追/" class="article-date">
  	<time datetime="2016-09-17T16:00:00.000Z" itemprop="datePublished">2016-09-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/18/追/">追</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="http://music.163.com/outchain/player?type=2&id=5023390&auto=0&height=66"></iframe>

<p>毕业前夕，我曾发出宏愿，走遍心中向往的风景，沿途拜访每一位江湖旧友，参加每一场好朋友的婚礼。可是去过很多地方，大多匆匆而过，旧友也早已消弭与江湖，没有参加的婚礼，也远比参加的要多。</p>
<p>我十分肯定想去的，却竟然始终也没有去。这几年变化的也不仅仅是心态，逐渐增多的赘肉和日益稀少的头发也都在见证着这一切。几年前一天动辄可以给予几次高潮的身体也一去不复返了，挺怀念的。毕竟一被子和谐才能一辈子和谐，这是刚需，做人不能太颓废，偶尔锻炼还是要有的。</p>
<p>这几天和余太从上海回来，走了下婚前流程。有些形式总是要走一遍的，毕竟人总是需要一种仪式感的。以前这些繁杂的流程，现在的年轻人基本都不甚了解，讲真，有点羞愧。谁知道会不会若干年后传到国外申请个文化遗产啥的，到时候再各种撕逼谁说的清呢。这些年在外上学家里这些娃都迫不及待的冒出来不少，这样一代代繁衍生息挺奇妙的，尽管很多时候初衷只是享受制造过程。想抱抱他们，到叔叔这里来，然而基本只给我留了一个背影。以前看中的妹子也不知道现在嫁到哪去了，曾经和我在学校并肩作战走南闯北的发小还是没有音信，如果你能看到，给家里报个平安吧。那些我熟悉的岁月印记越来越少了，然而一切依然进行着，他们也依然幸福的生活着。这么多年的学习后，似乎学到了很多，然而失去的也许更多，让我仿佛变成了一无所知的傻×，挺好的。</p>
<p>永乐的通知，一切都如预料般的猝不及防。我早没有那么放荡不羁了，然而你一如既往的不着调。上次来沪连做个啥保健的时间都没有，挺遗憾的。不过好在你的所在地也随时都可以。不过我还是劝你从良吧，尽管我知道的你一直都是优。昔日顶风尿三丈，如今顺风尿湿鞋，现在的年轻人还是要多注意，少年不知精子贵都是有历史教训的，下联我就不说了。讲真，坚持几年的感情实在不易，现在的女性都打着磨合的幌子渐渐的把男人磨平了，尤其是知识女性，女权思想太盛。看来书读得多也未必是好事。个人酸楚也就自己体验的最为真切了。婚姻怎么选都是错的，长久婚姻就是将错就错，修成正果这种事对男人来说尤其不易，毕竟会被要求太多，自行体会下。哥听到消息高兴的把旁边的雪花一饮而尽，算是隔空祝福了。</p>
<p>上段时间宝强的事霸屏很多天，讲真，看你们没事骂来骂去的挺没意思的。对一些没啥底线的人能动手就别吵吵。现在每天都在发生那么多的事，几乎每个事件下面的评论都是键盘侠的粗言秽语，妄图去骂醒别人的认知。一个成年人的认知基本无法改变，这种争论毫无意义，言论背后是多年生活方方面面的折射，岂会因为你一段话而改变。郎平在里约女排夺冠前一直被骂为叛徒，夺冠后各大媒体又各种跪舔将其捧上神坛。脸打的啪啪响，人至贱真是无敌。义愤填膺的是网民，冷漠无情的是路人，到底是网民不上街还是路人不上网，这种畸形网络文化也不知何时能终结，仿佛看不到曙光。</p>
<p>假期要结束了，这和余太还没来得及思念就又相见了，爽的飞起，这仿佛像是在尿裤子，很多人都能看到，但是只有自己才能体会到那种温暖。希望接下来的一段日子里我可以沉迷于工作无法自拔，其实内心是拒绝的。这段时间加的班比之前几年加的都多，仿佛看不到诗和远方，并且受到了从业以来仅有的能力质疑，酸爽！这种事情觉得只要说点啥基本都是在给自己找借口，还是默默承受比较好，毕竟也没人在意发生了啥。之前带的项目现在想来有些也是不应该，是否唯结果论并不重要，一切都要看人，没错，是看人。最重要的是，如果位置互换，未必会做的更好。但是这些谁会去在乎呢。工作是为了更好的生活，不应该本末倒置。我依然坚信，不能直接了当的判断一个人，信息量太大！</p>
<p>挺想到阳台上抽根烟的，考虑到安安宝贝还小，还是算了，我这一年抽一包的速度着实慢了点，谁让咱是三好青年呢。这中秋过的，以前小时候，嫦娥的故事根本听不下去，心里想着月饼，那个馋啊。而现在，月饼根本吃不下去，心里想着嫦娥，那个馋啊。成年人的世界也就剩想想了，放在心里，也许就成为了梦想！</p>
<p>讲真，感觉很是蛋疼！</p>
<hr>
<p>如有任何疑问或问题请联系我:fishnewsdream@gmail.com,欢迎交流，共同提高！</p>
<p>Objective-C/Swift技术开发交流群201556264，讨论何种技术并不受限，欢迎各位大牛百家争鸣！</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">刚刚在线工作室</a>，欢迎关注或提出建设性意见！</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">刚刚在线论坛</a>, 欢迎踊跃提问或解答！</p>
<p>如有转载，请注明出处，谢谢！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/随笔/">随笔</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-控雨片段" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/07/24/控雨片段/" class="article-date">
  	<time datetime="2016-07-23T16:00:00.000Z" itemprop="datePublished">2016-07-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/24/控雨片段/">控雨片段</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="http://music.163.com/outchain/player?type=2&id=5023390&auto=0&height=66"></iframe>

<video width="498" height="510 " src="http://7xqjid.com1.z0.glb.clouddn.com/controlwater.mp4 " poster=" " controls="controls"><br><br></video>

<p><br></p>
<hr>
<p>如有任何疑问或问题请联系我:fishnewsdream@gmail.com,欢迎交流，共同提高！</p>
<p>Objective-C/Swift技术开发交流群201556264，讨论何种技术并不受限，欢迎各位大牛百家争鸣！</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">刚刚在线工作室</a>，欢迎关注或提出建设性意见！</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">刚刚在线论坛</a>, 欢迎踊跃提问或解答！</p>
<p>如有转载，请注明出处，谢谢！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/随笔/">随笔</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/随笔/">随笔</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-逆向工程应用-竞品分析" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/05/26/逆向工程应用-竞品分析/" class="article-date">
  	<time datetime="2016-05-25T16:00:00.000Z" itemprop="datePublished">2016-05-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/26/逆向工程应用-竞品分析/">逆向工程应用-竞品分析</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><video width="498" height="510 " src="http://7xqjid.com1.z0.glb.clouddn.com/2016_04_14.mp4 " poster=" " controls="controls"><br></video><br><br></p>
<p>使用技术: 逆向工程，是一种产品设计技术再现的过程，即对一项目标产品进行逆向分析及研究，从而演绎并得出该产品的处理流程、组织结构、功能特性及技术规格等设计要素，其主要目的是在不能轻易获得必要的生产信息的情况下，直接从成品分析，推导出产品的设计原理。</p>
<p>分析对象: 某程、某龙</p>
<p>分析方法: 静态分析法，在不执行iOS应用的情形下，对应用进行静态分析的一种方法。比如获取应用的文件系统结构，本地文件的分析、使用反汇编工具（Disassembler，比如IDA）查看内部代码，分析代码结构也是静态分析。</p>
<ul>
<li><p>app bundle 分析</p>
</li>
<li><p>提取.h文件分析</p>
</li>
<li><p>提取可执行文件包含字符串分析</p>
</li>
<li><p>沙盒文件分析</p>
</li>
<li><p>页面结构分析</p>
</li>
</ul>
<h5 id="u524D_u671F_u51C6_u5907_3A"><a href="#u524D_u671F_u51C6_u5907_3A" class="headerlink" title="前期准备:"></a>前期准备:</h5><ul>
<li><ol>
<li>ituens上下载相关软件先， 打开ipa资源包，ipa文件其实就是个zip文件。</li>
</ol>
</li>
</ul>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_25_03.gif?attname=" alt=""><br><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_25_05.png?attname=" alt=""></p>
<blockquote>
<p>iTunesArtwork 用浏览器打开，是1024的app icon。</p>
<p>META-INF目录:存放签名信息</p>
<p>Payload(资源存放文件 )</p>
<ul>
<li>资源包中包含众多资源文件(图片、plist文件、Assets.car、本地化文件、签名相关文件(CodeResources、SC_Info)及其他资源文件)</li>
</ul>
</blockquote>
<p>iOS7后可使用Images.cxassets,打包后会生成Assets.car文件。可使用工具打开这个文件</p>
<p><a href="https://github.com/devcxm/iOS-Images-Extractor" target="_blank" rel="external">car文件解压工具</a>  </p>
<p>也可以直接下载 <a href="http://pan.baidu.com/s/1skHiHbv" target="_blank" rel="external">百度云下载地址</a></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_25_07.gif?attname=" alt=""></p>
<h6 id="u5E38_u89C1_u7684_u5BFC_u5165_u56FE_u7247_u7684_u51E0_u79CD_u65B9_u5F0F"><a href="#u5E38_u89C1_u7684_u5BFC_u5165_u56FE_u7247_u7684_u51E0_u79CD_u65B9_u5F0F" class="headerlink" title="常见的导入图片的几种方式"></a>常见的导入图片的几种方式</h6><blockquote>
<p> 加入到Assets.xcassets中</p>
<ul>
<li>只支持png格式的图片</li>
<li>图片只支持[UIImage imageNamed]的方式实例化，但是不能从Bundle中加载</li>
<li>在编译时，Images.xcassets中的所有文件会被打包为Assets.car的文件</li>
</ul>
<p>CreateGroup</p>
<ul>
<li>黄色文件夹图标；Xcode中分文件夹，Bundle中所有所在都在同一个文件夹下，因此，不能出现文件重名的情况</li>
<li>可以直接使用[NSBundle mainBundle]作为资源路径，效率高！</li>
<li>可以使用[UIImage imageNamed:]加载图像</li>
</ul>
<p>CreateFolderRefences</p>
<ul>
<li>蓝色文件夹；Xcode中分文件夹，Bundle中同样分文件夹，因此，可以出现文件重名的情况</li>
<li>需要在[NSBundle mainBundle]的基础上拼接实际的路径，效率较差</li>
<li>不能使用[UIImage imageNamed:]加载图</li>
</ul>
<p>PDFs矢量图（Xcode6+）</p>
<p>Bundle（包）中的图片素材</p>
</blockquote>
<p>在给ipa包瘦身的时候，可以使用图片压缩工具，通过无损或有损压缩的方式减小图片大小，还可以通过改变图片导入的方式给ipa包瘦身。携程、艺龙均有使用Images.xcassets。</p>
<p> CreateGroup、CreateFolderRefences两种方式打出来的包，图片都会直接放在.app文件中，所以打包前后，图片的大小不会改变，而加入到Assets.xcassets中的方法则不同，打包后，在.app中会生成Assets.car文件来存储Assets.xcassets中的图片，并且文件大小也大大降低。也可使用工具给图片压缩,比如 <a href="https://imageoptim.com/mac" target="_blank" rel="external">imageoptim</a>。</p>
<p>其他可以给ipa包瘦身的也有通过设置Bitcode、设置编译器优化级别、去除符号信息甚至修改方法名长度等。</p>
<blockquote>
<ol>
<li>通过逆向工程相关技术(class-dump-z)，拿到沙盒文件、.h文件集合等。</li>
</ol>
</blockquote>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2015_05_25_10.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_25_11.gif?attname=" alt=""></p>
<h5 id="app_bundle__u5206_u6790"><a href="#app_bundle__u5206_u6790" class="headerlink" title="app bundle 分析"></a>app bundle 分析</h5><ul>
<li><p>某龙:</p>
<blockquote>
<p>有大量图片资源使用中文命名</p>
<p>部分图片包含了1倍图片，部分图片只有@2x图片，使用了Images.assets</p>
<p>文件中包含momd文件，使用了CoreData</p>
<p>Frameworks文件夹中没有包含Swift需要的库，没有使用Swift</p>
<p>JSPatch文件</p>
<p>Plist文件中统计页面及事件</p>
<p>全局搜索配置(CoreSpotlight.plist)</p>
<p>webp引导页(减小大小)</p>
<p>配置url跳转(xxxRoute.plist)</p>
</blockquote>
</li>
<li><p>某程:</p>
<blockquote>
<p>部分图片包含了1倍图片，部分图片只有@2x图片，使用了Images.assets</p>
<p>图片命名均以_分隔，形如<code>call\_ico\_conceal\_click@2x</code></p>
<p>项目中没有使用Swift </p>
<p>JSPatch文件</p>
<p>相关Plist文件中存储SQL语句</p>
<p>内置H5页面(webapp)</p>
<p>Plist文件配置相关电话</p>
<p>开发员工配置(BundleVersion.json)</p>
<p>配置工程依赖(crip.json)</p>
</blockquote>
</li>
</ul>
<h5 id="h_u6587_u4EF6_u5206_u6790"><a href="#h_u6587_u4EF6_u5206_u6790" class="headerlink" title=".h文件分析"></a>.h文件分析</h5><ul>
<li><p>某龙:</p>
<blockquote>
<p>部分Model文件以model结尾，类名没有统一加前缀</p>
<p>使用了Cocoapods</p>
<p><a href="https://github.com/carsonperrotti/CNPPopupController" target="_blank" rel="external">CNPPopupController</a></p>
<p><a href="https://github.com/nicklockwood/FXBlurView" target="_blank" rel="external">FXBlurView</a></p>
<p><a href="https://github.com/SnapKit/Masonry" target="_blank" rel="external">Masonry</a></p>
<p><a href="https://github.com/rs/SDWebImage" target="_blank" rel="external">SDWebImage</a></p>
<p><a href="https://github.com/TTTAttributedLabel/TTTAttributedLabel" target="_blank" rel="external">TTTAttributedLabel</a></p>
<p><a href="https://github.com/wezm/RegexKitLite" target="_blank" rel="external">RegexKitLite</a></p>
<p><a href="https://github.com/icanzilb/JSONModel" target="_blank" rel="external">JSONModel</a></p>
<p><a href="https://github.com/CoderMJLee/MJRefresh" target="_blank" rel="external">MJRefresh</a></p>
<p><a href="http://dev.umeng.com/analytics/ios-doc/integration?spm=0.0.0.0.FpEdKs#1_2" target="_blank" rel="external">UMeng</a></p>
<p><a href="http://lbsyun.baidu.com/index.php?title=iossdk/sdkiosdev-download" target="_blank" rel="external">BaiduMap</a></p>
<p><a href="https://github.com/steipete/Aspects" target="_blank" rel="external">Aspects</a></p>
<p><a href="https://github.com/ccgus/fmdb" target="_blank" rel="external">FMDB</a></p>
<p><a href="https://github.com/nicklockwood/FXLabel" target="_blank" rel="external">FXLabel</a></p>
<p><a href="https://github.com/mattconnolly/ZipArchive" target="_blank" rel="external">ZipArchive</a></p>
</blockquote>
</li>
<li><p>某程： </p>
<blockquote>
<p> Model文件命名以model结尾，类名没有统一加前缀</p>
<p>没有使用Cocoapods </p>
<p><a href="https://github.com/zwaldowski/BlocksKit" target="_blank" rel="external">BlocksKit</a></p>
<p><a href="https://github.com/ibireme/YYKit" target="_blank" rel="external">YYKit</a></p>
<p><a href="https://github.com/AFNetworking/AFNetworking" target="_blank" rel="external">AFNetworking(2.x)</a></p>
<p><a href="https://github.com/rs/SDWebImage" target="_blank" rel="external">SDWebImage</a></p>
<p><a href="https://github.com/ninjinkun/NJKWebViewProgress" target="_blank" rel="external">NJKWebViewProgress</a></p>
<p><a href="https://github.com/TTTAttributedLabel/TTTAttributedLabel" target="_blank" rel="external">TTTAttributedLabel</a></p>
<p><a href="https://github.com/gsdios/SDCycleScrollView" target="_blank" rel="external">SDCycleScrollView</a></p>
<p><a href="https://github.com/robbiehanson/XMPPFramework" target="_blank" rel="external">XMPP</a></p>
<p><a href="https://github.com/robbiehanson/KissXML" target="_blank" rel="external">KissXML</a></p>
<p><a href="https://github.com/enormego/EGOTableViewPullRefresh" target="_blank" rel="external">EGOTableViewPullRefresh</a></p>
<p><a href="/(https://github.com/SnapKit/Masonry">Masonry</a>)</p>
<p><a href="https://github.com/jdg/MBProgressHUD" target="_blank" rel="external">MBProgressHUD</a> </p>
<p><a href="https://github.com/MortimerGoro/MGSwipeTableCell" target="_blank" rel="external">MGSwipeTableCell</a></p>
<p><a href="https://github.com/mpospese/MPFoldTransition" target="_blank" rel="external">MPFoldTransition</a></p>
<p><a href="https://github.com/mattconnolly/ZipArchive" target="_blank" rel="external">ZipArchive</a></p>
</blockquote>
</li>
</ul>
<p><code>CNPPopupController</code></p>
<p>简单和通用的弹出控件</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_1.gif?attname=" alt=""></p>
<p><code>FXBlurView</code></p>
<p>实现背景模糊效果</p>
<ul>
<li>初始化UIView在UIImageView或者其他控件的上方，FXBlurView可以根据底层显示的状态生成模糊效果，并且可以动态，静态生成模糊效果。</li>
</ul>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_2.jpg?attname=" alt=""><br><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_3.jpg?attname=" alt=""></p>
<p><code>FXLabel</code></p>
<ul>
<li>FXLabel 改进了标准的 UILabel 组件，提供了文字的各种阴影效果和梯度填充。</li>
</ul>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_4.jpg?attname=" alt=""></p>
<p><code>BlocksKit</code></p>
<ul>
<li><p>BlocksKit 是一个开源的框架，对 Cocoa 进行了扩展，将许多需要通过 delegate 调用的方法转换成了 block。在很多情况下，blocks 比 delegate 要方便简单，因为 block 是紧凑的，可以使代码更简洁，提高代码可读性，另外 block 还可以进行异步处理。使用 block 要注意避免循环引用。</p>
<p>BlocksKit 的所有方法都以bk_开头，这样可以方便地列出所有 BlocksKit 的所有方法。最常用的是 UIKit Category，它为 UIAlertView，UIActionSheet，UIButton，UITapGestureRecognizer 等提供了 blocks。BlocksKit 主要目录结构</p>
<ul>
<li><p>Core：存放 Foundation 相关的 Block category，如 NSObject、NSTimer、NSarray、NSDictionary、NSSet、NSIndexSet、NSMutableArray等</p>
</li>
<li><p>DynamicDelegate：动态代理（消息转发机制）</p>
</li>
<li><p>UIKit：扩展了 UIAlertView，UIActionView，UIButton 等</p>
</li>
</ul>
</li>
</ul>
<p>主要功能有下面三个方面：</p>
<ul>
<li><p>通过block传入事件处理函数</p>
</li>
<li><p>创建动态代理，传入block给想要实现的方法。</p>
</li>
<li><p>在很多基础的类上增加额外的方法。</p>
</li>
</ul>
<h5 id="u5E38_u89C1_u7528_u6CD5"><a href="#u5E38_u89C1_u7528_u6CD5" class="headerlink" title="常见用法"></a>常见用法</h5><p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_6.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_7.png?attname=" alt=""></p>
<h5 id="u539F_u7406_u5206_u6790_3A__u6D88_u606F_u8F6C_u53D1_u673A_u5236"><a href="#u539F_u7406_u5206_u6790_3A__u6D88_u606F_u8F6C_u53D1_u673A_u5236" class="headerlink" title="原理分析: 消息转发机制"></a>原理分析: 消息转发机制</h5><ul>
<li><p>当一个对象收到它没实现的消息的时候，通常会发生如下的情况。</p>
<blockquote>
<ol>
<li>调用+(BOOL)resolveInstanceMethod:(SEL)aSEL，如果对象在这里动态添加了selector 的实现方法，则消息转发结束，否则执行步骤2</li>
<li>调用 - (id)forwardingTargetForSelector:(SEL)aSelector，在这里你可以将消息转发给其他对象，如果实现则消息转发结束，否则执行步骤3</li>
<li>执行完整的消息转发机制，调用-(void)forwardInvocation:(NSInvocation *)invocation 在这一步，你可以修改消息的任何内容，包括目标（target），selector，参数。如果没有实现在这里还未实现转发则程序将抛出异常。</li>
</ol>
</blockquote>
</li>
</ul>
<p>BlocksKit 动态代理实现方式是最后一步，即-(void)forwardInvocation:(NSInvocation *)invocation，使得动态代理能够接受任意消息。</p>
<p>网上有两篇对BlocksKit源码的解析，看了觉得很受益匪浅。</p>
<p><a href="http://ios.jobbole.com/84719/" target="_blank" rel="external">BlocksKit源码解析一</a></p>
<p><a href="http://ios.jobbole.com/84718/" target="_blank" rel="external">BlocksKit源码解析二</a></p>
<p><code>NJKWebViewProgress</code></p>
<p>Webview进度条控件</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_11.png?attname=" alt=""></p>
<p><code>SDCycleScrollView</code></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_12.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_13.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_14.gif?attname=" alt=""></p>
<p><code>KissXML</code></p>
<p>解析xml数据</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_15.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_16.png?attname=" alt=""></p>
<p><code>MGSwipeTableCell</code></p>
<p>侧滑UITableViewCell展示多个可操作按钮</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_17.gif?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_19.png?attname=" alt=""></p>
<p><code>MPFoldTransition</code></p>
<p>一个实现多种视图切换效果的库。</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_26_20.gif?attname=" alt=""></p>
<h5 id="u9875_u9762_u7ED3_u6784_u5206_u6790"><a href="#u9875_u9762_u7ED3_u6784_u5206_u6790" class="headerlink" title="页面结构分析"></a>页面结构分析</h5><p>越狱设备可使用Reveal查看任意App的UI页面。 </p>
<p>官网下载地址: <a href="http://revealapp.com" target="_blank" rel="external">http://revealapp.com</a> </p>
<hr>
<p>如有任何疑问或问题请联系我:fishnewsdream@gmail.com,欢迎交流，共同提高！</p>
<p>Objective-C/Swift技术开发交流群201556264，讨论何种技术并不受限，欢迎各位大牛百家争鸣！</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">刚刚在线工作室</a>，欢迎关注或提出建设性意见！</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">刚刚在线论坛</a>, 欢迎踊跃提问或解答！</p>
<p>如有转载，请注明出处，谢谢！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/逆向工程/">逆向工程</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/进阶/">进阶</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-YYKit探究" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/05/10/YYKit探究/" class="article-date">
  	<time datetime="2016-05-09T16:00:00.000Z" itemprop="datePublished">2016-05-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/10/YYKit探究/">YYKit探究</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <video width="498" height="510 " src="http://7xqjid.com1.z0.glb.clouddn.com/2016_04_14.mp4 " poster=" " controls="controls"><br><br></video>

<p><br></p>
<p><a href="https://github.com/ibireme/YYKit.git" target="_blank" rel="external">YYKit</a> : 一组功能强大的iOS组件集合，支持iOS6.0及以上。</p>
<p>各组件之间有比较强的依赖关系，但原作者为了方便其他开发者使用，已将其拆分成以下独立组件。</p>
<blockquote>
<ul>
<li><p><a href="https://github.com/ibireme/YYModel" target="_blank" rel="external">YYModel</a> — 高性能的 iOS JSON 模型框架。</p>
</li>
<li><p><a href="https://github.com/ibireme/YYCache" target="_blank" rel="external">YYCache</a> — 高性能的 iOS 缓存框架。</p>
</li>
<li><p><a href="https://github.com/ibireme/YYImage" target="_blank" rel="external">YYImage</a> — 功能强大的 iOS 图像框架。</p>
</li>
<li><p><a href="https://github.com/ibireme/YYWebImage" target="_blank" rel="external">YYWebImage</a> — 高性能的 iOS 异步图像加载框架。</p>
</li>
<li><p><a href="https://github.com/ibireme/YYText" target="_blank" rel="external">YYText</a> — 功能强大的 iOS 富文本框架。</p>
</li>
<li><p><a href="https://github.com/ibireme/YYKeyboardManager" target="_blank" rel="external">YYKeyboardManager</a> — iOS 键盘监听管理工具</p>
</li>
<li><p><a href="https://github.com/ibireme/YYDispatchQueuePool" target="_blank" rel="external">YYDispatchQueuePool</a> — iOS 全局并发队列管理工具</p>
</li>
<li><p><a href="https://github.com/ibireme/YYAsyncLayer" target="_blank" rel="external">YYAsyncLayer</a> — iOS 异步绘制与显示的工具</p>
</li>
<li><p><a href="https://github.com/ibireme/YYCategories" target="_blank" rel="external">YYCategories</a> — 功能丰富的 Category 类型工具库</p>
</li>
</ul>
</blockquote>
<h4 id="u96C6_u6210_u53EF_u4F7F_u7528Cocoapods_u6216Carthage_u6216_u624B_u52A8_u5B89_u88C5"><a href="#u96C6_u6210_u53EF_u4F7F_u7528Cocoapods_u6216Carthage_u6216_u624B_u52A8_u5B89_u88C5" class="headerlink" title="集成可使用Cocoapods或Carthage或手动安装"></a>集成可使用Cocoapods或Carthage或手动安装</h4><h6 id="CocoaPods"><a href="#CocoaPods" class="headerlink" title="CocoaPods"></a>CocoaPods</h6><blockquote>
<ol>
<li>在 Podfile 中添加 pod ‘YYKit’</li>
<li>执行 pod install 或 pod update</li>
<li>导入<code>&lt;YYKit/YYKit.h&gt;</code></li>
</ol>
</blockquote>
<h6 id="Carthage"><a href="#Carthage" class="headerlink" title="Carthage"></a>Carthage</h6><blockquote>
<ol>
<li>在 Cartfile 中添加 github “ibireme/YYKit”</li>
<li>执行 carthage update –platform ios 并将生成的 framework 添加到你的工程</li>
<li>导入 <code>&lt;YYKit/YYKit.h&gt;</code></li>
<li>注意: carthage framework 并没有包含 webp 组件。如果你需要支持 webp，可以用 CocoaPods 安装，或者手动安装</li>
</ol>
</blockquote>
<h6 id="u624B_u52A8_u5B89_u88C5"><a href="#u624B_u52A8_u5B89_u88C5" class="headerlink" title="手动安装"></a>手动安装</h6><blockquote>
<ol>
<li>下载 YYKit 文件夹内的所有内容</li>
<li>将 YYKit 内的源文件添加(拖放)到你的工程</li>
<li>为 NSObject+YYAddForARC.m 和 NSThread+YYAdd.m 添加编译参数 -fno-objc-arc</li>
<li>链接以下 frameworks:<ul>
<li>UIKit</li>
<li>CoreFoundation</li>
<li>CoreText</li>
<li>CoreGraphics</li>
<li>CoreImage</li>
<li>QuartzCore</li>
<li>ImageIO</li>
<li>AssetsLibrary</li>
<li>Accelerate</li>
<li>MobileCoreServices</li>
<li>SystemConfiguration</li>
<li>sqlite3</li>
<li>libz</li>
</ul>
</li>
<li>如果你需要支持 WebP，可以将 Vendor/WebP.framework(静态库) 加入你的工程</li>
<li>导入 <code>YYModel.h</code></li>
</ol>
</blockquote>
<p>提到的<code>WebP</code>是<code>Google</code>新推出的影像技术，它可让网页 图档有效进行压缩，同时又不影响图片格式、兼容与实际清晰度，进而让整体网页下载速度加快。与<code>JPEG</code>相同，<code>WebP</code>是一种“有损压缩“，利用”预测编码“技术。但谷歌表示，这种格式的主要优势在于高效率。他们发现，“在质量相同的情况下，<code>WebP</code>格式图像的体积要比<code>JPEG</code>格式图像小40%。</p>
<p>更详细的使用文档可到<a href="http://cocoadocs.org/docsets/YYKit/1.0.5/" target="_blank" rel="external">CocoaDocs</a>查看</p>
<p><a href="http://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/" target="_blank" rel="external">iOS 保持界面流畅的技巧</a></p>
<p>这是作者使用YYKit提供的项目中的使用技巧。</p>
<h4 id="u6CE8_u610F_uFF1A_u539F_u4F5C_u8005_u5E76_u4E0D_u5EFA_u8BAE_u76F4_u63A5_u4F7F_u7528YYKit_u8FD9_u4E2A_u5E93_2C_u800C_u662F_u6839_u636E_u9700_u6C42_u5355_u72EC_u4F7F_u7528_u8FD9_u4E9B_u7EC4_u4EF6"><a href="#u6CE8_u610F_uFF1A_u539F_u4F5C_u8005_u5E76_u4E0D_u5EFA_u8BAE_u76F4_u63A5_u4F7F_u7528YYKit_u8FD9_u4E2A_u5E93_2C_u800C_u662F_u6839_u636E_u9700_u6C42_u5355_u72EC_u4F7F_u7528_u8FD9_u4E9B_u7EC4_u4EF6" class="headerlink" title="注意：原作者并不建议直接使用YYKit这个库,而是根据需求单独使用这些组件"></a>注意：原作者并不建议直接使用<code>YYKit</code>这个库,而是根据需求单独使用这些组件</h4><h4 id="u63A5_u4E0B_u6765_u5206_u522B_u63A2_u7A76_u4E0B_u5404_u4E2A_u7EC4_u4EF6"><a href="#u63A5_u4E0B_u6765_u5206_u522B_u63A2_u7A76_u4E0B_u5404_u4E2A_u7EC4_u4EF6" class="headerlink" title="接下来分别探究下各个组件"></a>接下来分别探究下各个组件</h4><h2 id="YYModel"><a href="#YYModel" class="headerlink" title="YYModel"></a>YYModel</h2><h4 id="u5B89_u88C5"><a href="#u5B89_u88C5" class="headerlink" title="安装"></a>安装</h4><h6 id="CocoaPods-1"><a href="#CocoaPods-1" class="headerlink" title="CocoaPods"></a>CocoaPods</h6><blockquote>
<ol>
<li>在 <code>Podfile</code> 中添加 <code>pod &#39;YYModel&#39;</code></li>
<li>执行 <code>pod install</code> 或 <code>pod update</code></li>
<li>导入<code>&lt;YYModel/YYModel.h&gt;</code></li>
</ol>
</blockquote>
<h6 id="Carthage-1"><a href="#Carthage-1" class="headerlink" title="Carthage"></a>Carthage</h6><blockquote>
<ol>
<li>在 <code>Cartfile</code> 中添加 <code>github &quot;ibireme/YYModel&quot;</code></li>
<li>执行 <code>carthage update --platform ios</code> 并将生成的 <code>framework</code> 添加到你的工程</li>
<li>导入<code>&lt;YYModel/YYModel.h&gt;</code></li>
</ol>
</blockquote>
<h6 id="u624B_u52A8_u5B89_u88C5-1"><a href="#u624B_u52A8_u5B89_u88C5-1" class="headerlink" title="手动安装"></a>手动安装</h6><blockquote>
<ol>
<li>下载 YYModel 文件夹内的所有内容</li>
<li>将 YYModel 内的源文件添加(拖放)到你的工程</li>
<li>导入 YYModel.h</li>
</ol>
</blockquote>
<h4 id="u5B9E_u73B0_u539F_u7406"><a href="#u5B9E_u73B0_u539F_u7406" class="headerlink" title="实现原理"></a>实现原理</h4><p>使用OC运行时函数将模型类进行解析，包括所有的属性、方法、实例变量等，然后将模型按照名字进行索引调用相应的set方法，模型类通常是固定的，并不用对每次转换的类进行解析，利用缓存机制，每个模型类只用解析一次，固性能会很高。</p>
<p>提供的演示Demo地址: <a href="https://github.com/ibireme/YYModel" target="_blank" rel="external">https://github.com/ibireme/YYModel</a></p>
<p>使用了六种模型转换方法来对比各自的性能。分别是</p>
<ul>
<li>手动转换、</li>
<li>YYModel、</li>
<li>FastEasyMapping、</li>
<li>JSONModel、</li>
<li>Mantle、</li>
<li>MJExtension.</li>
</ul>
<p>除了手动转换外其余均使用了第三方的开源库，我个人之前常用的是手动转换和<code>MJExtension</code></p>
<p>手动转换一般是这样</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_01.png?attname=" alt=""><br><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05-10_02.png?attname=" alt=""><br><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_03.png?attname=" alt=""></p>
<p>也就是对象之间的映射手动完成。上图也列举了系统的这个方法<code>setValuesForKeysWithDictionary</code>,这个方法用起来也还不错，不需要一一的来给对象赋值而直接从字典初始化即可，但用的不好会经常崩溃。</p>
<p>举个例子</p>
<p>创建<code>PersonInfoModel</code></p>
<p><code>@interface PersonInfoModel : NSObject</code></p>
<p><code>@property (nonatomic, copy) NSString  *name;</code></p>
<p><code>@property (nonatomic, copy) NSString  *age;</code></p>
<p><code>@property (nonatomic, strong) NSString *address;</code></p>
<p><code>@end</code></p>
<p><code>PersonInfoModel *personInfoModel = [[PersonInfoModel alloc]init];
[personInfoModel setValuesForKeysWithDictionary:dic];</code></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_04.png?attname=" alt=""></p>
<p>这是比较标准的使用方法，使用时完全没问题。如果我在`PersonInfoModel中再加一个属性</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_05.png?attname=" alt=""></p>
<p>这样也没有出错,可以正常使用,也就是说用字典初始化对象时,只要对象中都包含了这些键值,是可以正常初始化的,我们再在字典中添加一个键值对</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_06.png?attname=" alt=""></p>
<p>这样就会直接导致程序崩溃,因为该对象中没有 sex 这个属性,解决方法就是,实现一个方法setValue:forUndefinedKey:，然后实现这个方法，这样就会过滤掉给不存在的键值赋值。</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_07.png?attname=" alt=""></p>
<p>如果有个属性是id,而id本身就是系统自身关键字,不能够当做属性使用，这时可以这么做。</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_08.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_09.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_10.png?attname=" alt=""></p>
<p>setValue:forUndefinedKey:这个方法是关键,只有存在这个方法后,才可以过滤掉不存在的键值对而防止崩溃。在项目中使用时可以创建一个Model基类，添加这个方法<code>setValue:forUndefinedKey:</code>并实现。之后的Model继承自这个基类Model,这时候如果存在model中没有的键，可以重载父类的setValue:forUndefinedKey方法即可，否则会崩溃。</p>
<p>另外，程序在获取Json数据的时候可能会出现这种数据 <code>&quot;somevalue&quot;: null</code>,也就是没有返回值，通过一些第三方的库可能会解析成这样 <code>somevalue = &quot;&lt;null&gt;&quot;</code>;这种数据不是nil也不是string,如果向这个对象发送消息就会崩溃。</p>
<p>在AFNetworking中有这个方法可以解决，将这个空值去除</p>
<p> <code>AFJSONResponseSerializer *responseSerializer = [[AFJSONResponseSerializer alloc] init];</code></p>
<p> <code>responseSerializer.removesKeysWithNullValues = true;</code></p>
<p>而网上有个<code>Category</code>，叫做<code>NullSafe</code>,下载地址<br><a href="https://github.com/nicklockwood/NullSafe" target="_blank" rel="external">https://github.com/nicklockwood/NullSafe</a></p>
<p>是在运行时操作把空值置为nil，因为nil是安全的，可以向nil对象发送消息不会奔溃，只需将这个category加入项目即可。</p>
<p>作者给出了这几种开源库的比较结果,YYModel的性能仅次于手动转换。<br><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_11.png?attname=" alt=""></p>
<h6 id="YYModel_u7684_u4F18_u52BF"><a href="#YYModel_u7684_u4F18_u52BF" class="headerlink" title="YYModel的优势"></a>YYModel的优势</h6><ul>
<li>高性能: 模型转换性能接近手写解析代码。</li>
<li>自动类型转换: 对象类型可以自动转换，详情见下方表格。</li>
<li>类型安全: 转换过程中，所有的数据类型都会被检测一遍，以保证类型安全，避免崩溃问题。</li>
<li>无侵入性: 模型无需继承自其他基类。</li>
<li>轻量: 该框架只有 5 个文件 (包括.h文件)。</li>
<li>文档和单元测试: 文档覆盖率100%, 代码覆盖率99.6%。</li>
</ul>
<h4 id="u90E8_u5206_u4F7F_u7528_u65B9_u6CD5"><a href="#u90E8_u5206_u4F7F_u7528_u65B9_u6CD5" class="headerlink" title="部分使用方法"></a>部分使用方法</h4><h5 id="u7B80_u5355_u7684_Model__u4E0E_JSON__u76F8_u4E92_u8F6C_u6362"><a href="#u7B80_u5355_u7684_Model__u4E0E_JSON__u76F8_u4E92_u8F6C_u6362" class="headerlink" title="简单的 Model 与 JSON 相互转换"></a>简单的 Model 与 JSON 相互转换</h5><p><code>JSON</code><br><code>{
    &quot;uid&quot;:123456,
    &quot;name&quot;:&quot;Harry&quot;,
    &quot;created&quot;:&quot;1965-07-31T00:00:00+0000&quot;
}</code></p>
<p><code>Model</code></p>
<p><code>@interface User : NSObject</code></p>
<p><code>@property UInt64 uid;</code></p>
<p><code>@property NSString *name;</code></p>
<p><code>@property NSDate *created;</code></p>
<p><code>@end</code></p>
<p>// 将 JSON (NSData,NSString,NSDictionary) 转换为 Model:</p>
<p><code>User *user = [User yy_modelWithJSON:json];</code></p>
<p>// 将 Model 转换为 JSON 对象:</p>
<p><code>NSDictionary *json = [user yy_modelToJSONObject];</code><br>当 JSON/Dictionary 中的对象类型与 Model 属性不一致时，YYModel 将会进行如下自动转换。自动转换不支持的值将会被忽略，以避免各种潜在的崩溃问题。</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_12.png?attname=" alt=""></p>
<h5 id="u5C06_Model__u7684_u5C5E_u6027_u5339_u914D_u5230_u6307_u5B9A_u7684_JSON/NSDictionary__u952E_u503C"><a href="#u5C06_Model__u7684_u5C5E_u6027_u5339_u914D_u5230_u6307_u5B9A_u7684_JSON/NSDictionary__u952E_u503C" class="headerlink" title="将 Model 的属性匹配到指定的 JSON/NSDictionary 键值"></a>将 Model 的属性匹配到指定的 JSON/NSDictionary 键值</h5><p><code>JSON</code>:</p>
<p><code>{
    &quot;n&quot;:&quot;Harry Pottery&quot;,    
    &quot;p&quot;: 256,
    &quot;ext&quot; : {
        &quot;desc&quot; : &quot;A book written by J.K.Rowing.&quot;
    }
}</code></p>
<p><code>Model:</code></p>
<p><code>@interface Book : NSObject</code></p>
<p><code>@property NSString *name;</code></p>
<p><code>@property NSInteger page;</code></p>
<p><code>@property NSString *desc;</code></p>
<p><code>@end</code></p>
<p><code>`@implementation Book</code></p>
<p><code>+ (NSDictionary *)modelCustomPropertyMapper {</code></p>
<p>   <code>return @{@&quot;name&quot; : @&quot;n&quot;,</code></p>
<p>   <code>@&quot;page&quot; : @&quot;p&quot;,</code></p>
<p>   <code>@&quot;desc&quot; : @&quot;ext.desc&quot;};</code></p>
<p><code>}</code></p>
<p><code>@end</code></p>
<p>通过实现 协议中的 modelCustomPropertyMapper，可以将 Model 属性的名字对应到 JSON/NSDictionary 相应的字段。可以把一个或一组 json key (key path) 映射到一个或多个属性。如果一个属性没有映射关系，那默认会使用相同属性名作为映射。</p>
<p>在 json-&gt;model 的过程中：如果一个属性对应了多个 json key，那么转换过程会按顺序查找，并使用第一个不为空的值。</p>
<p>在 model-&gt;json 的过程中：如果一个属性对应了多个 json key (key path)，那么转换过程仅会处理第一个 json key (key path)；如果多个属性对应了同一个 json key，则转换过过程会使用其中任意一个不为空的值。</p>
<h5 id="Model__u5305_u542B_u5176_u4ED6_Model"><a href="#Model__u5305_u542B_u5176_u4ED6_Model" class="headerlink" title="Model 包含其他 Model"></a>Model 包含其他 Model</h5><p><code>JSON</code></p>
<p><code>{</code><br>   <code>&quot;author&quot;:{</code></p>
<pre><code>&quot;name&quot;:&quot;J.K.Rowling&quot;,

&quot;birthday&quot;:&quot;1965-07-31T00:00:00+0000&quot;

},
</code></pre><p>   <code>&quot;name&quot;:&quot;Harry Potter&quot;,</code></p>
<p>   <code>&quot;pages&quot;:256</code></p>
<p><code>}</code></p>
<p><code>Model</code>: 什么都不用做，转换会自动完成</p>
<p><code>@interface Author : NSObject</code></p>
<pre><code>@property NSString *name;
@property NSDate *birthday;
</code></pre><p><code>@end</code></p>
<p><code>@interface Book : NSObject</code></p>
<p> <code>@property NSString *name;</code></p>
<p> <code>@property NSUInteger pages;</code></p>
<p> <code>@property Author *author;</code> //Book 包含 Author 属性</p>
<p><code>@end</code></p>
<h5 id="u6CE8_u610F_uFF0CBook_u4E2D_u7684_u5C5E_u6027author_u5FC5_u987B_u548CJson_u4E32_u4E2D_u952Eauthor_u76F8_u540C_u3002"><a href="#u6CE8_u610F_uFF0CBook_u4E2D_u7684_u5C5E_u6027author_u5FC5_u987B_u548CJson_u4E32_u4E2D_u952Eauthor_u76F8_u540C_u3002" class="headerlink" title="注意，Book中的属性author必须和Json串中键author相同。"></a>注意，Book中的属性<code>author</code>必须和Json串中键<code>author</code>相同。</h5><h4 id="u5BB9_u5668_u7C7B_u5C5E_u6027"><a href="#u5BB9_u5668_u7C7B_u5C5E_u6027" class="headerlink" title="容器类属性"></a>容器类属性</h4><p><code>@class Shadow, Border, Attachment;</code></p>
<p><code>@interface Attributes</code></p>
<p><code>@property NSString *name;</code></p>
<p><code>@property NSArray *shadows; //Array&lt;Shadow&gt;</code></p>
<p><code>@property NSSet *borders; //Set&lt;Border&gt;</code></p>
<p><code>@property NSMutableDictionary *attachments; //Dict&lt;NSString,Attachment&gt;</code></p>
<p><code>@end</code></p>
<p><code>@implementation Attributes</code></p>
<p>// 返回容器类中的所需要存放的数据类型 (以 Class 或 Class Name 的形式)。</p>
<p><code>+ (NSDictionary *)modelContainerPropertyGenericClass {</code></p>
<p>  <code>return @{@&quot;shadows&quot; : [Shadow class],</code></p>
<pre><code>@&quot;borders&quot; : Border.class,

@&quot;attachments&quot; : @&quot;Attachment&quot; };
</code></pre><p><code>}</code></p>
<p><code>@end</code></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_14.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_15.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_16.png?attname=" alt=""></p>
<h4 id="u9ED1_u540D_u5355_u4E0E_u767D_u540D_u5355"><a href="#u9ED1_u540D_u5355_u4E0E_u767D_u540D_u5355" class="headerlink" title="黑名单与白名单"></a>黑名单与白名单</h4><p><code>@interface User</code></p>
<p><code>@property NSString *name;</code></p>
<p><code>@property NSUInteger age;</code></p>
<p><code>@end</code></p>
<p>@implementation Attributes</p>
<p>// 如果实现了该方法，则处理过程中会忽略该列表内的所有属性</p>
<p><code>+ (NSArray *)modelPropertyBlacklist {</code></p>
<pre><code>return @[@&quot;test1&quot;, @&quot;test2&quot;];
</code></pre><p><code>}</code></p>
<p>// 如果实现了该方法，则处理过程中不会处理该列表外的属性。</p>
<p><code>+ (NSArray *)modelPropertyWhitelist {</code></p>
<pre><code>return @[@&quot;name&quot;];
</code></pre><p><code>}</code><br><code>@end</code></p>
<p>如果同时实现<code>modelPropertyBlacklist</code>方法和<code>modelPropertyWhitelist</code>方法，且忽略和处理属性相同， 则所有属性都不会有值。</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_17.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_10_18.png?attname=" alt=""></p>
<p><a href="http://blog.ibireme.com/2015/10/23/ios_model_framework_benchmark/" target="_blank" rel="external">iOS JSON 模型转换库评测</a>  这篇文章作者对比了几个库的优劣，可以看看</p>
<h2 id="YYCache"><a href="#YYCache" class="headerlink" title="YYCache"></a>YYCache</h2><h4 id="u5B89_u88C5-1"><a href="#u5B89_u88C5-1" class="headerlink" title="安装"></a>安装</h4><h6 id="CocoaPods-2"><a href="#CocoaPods-2" class="headerlink" title="CocoaPods"></a>CocoaPods</h6><blockquote>
<ol>
<li>在 <code>Podfile</code> 中添加 <code>pod &#39;YYCache&#39;</code></li>
<li>执行 <code>pod install</code> 或 <code>pod update</code></li>
<li>导入 <code>&lt;YYCache/YYCache.h&gt;</code></li>
</ol>
</blockquote>
<h6 id="Carthage-2"><a href="#Carthage-2" class="headerlink" title="Carthage"></a>Carthage</h6><blockquote>
<ol>
<li>在 <code>Cartfile</code> 中添加 <code>github &quot;ibireme/YYCache&quot;</code></li>
<li>执行 <code>carthage update --platform ios</code> 并将生成的 <code>framework</code> 添加到你的工程</li>
<li>导入 <code>&lt;YYCache/YYCache.h&gt;</code></li>
</ol>
</blockquote>
<h6 id="u624B_u52A8_u5B89_u88C5-2"><a href="#u624B_u52A8_u5B89_u88C5-2" class="headerlink" title="手动安装"></a>手动安装</h6><blockquote>
<ol>
<li><p>下载 <code>YYCache</code> 文件夹内的所有内容</p>
</li>
<li><p>将 <code>YYCache</code> 内的源文件添加(拖放)到你的工程</p>
</li>
<li><p>链接以下的 <code>frameworks</code>:</p>
</li>
</ol>
<ul>
<li>UIKit</li>
<li>CoreFoundation</li>
<li>QuartzCore</li>
<li>sqlite3</li>
</ul>
<p>4.导入 <code>YYCache.h</code></p>
</blockquote>
<p>提供的演示Demo地址: <a href="https://github.com/ibireme/YYCache" target="_blank" rel="external">https://github.com/ibireme/YYCache</a></p>
<p>通常一个缓存是由内存缓存和磁盘缓存组成，内存缓存提供容量小但高速的存取功能，磁盘缓存提供大容量但低速的持久化存储.</p>
<p>作者比较了三个第三方的开源库<code>YYCache</code>、<code>PINCache</code>、<code>TMCache</code>。内存缓存方面分别比较了</p>
<ul>
<li>NSDictionary</li>
<li>NSDict+Lock</li>
<li>YYMemoryCache</li>
<li>NSCache</li>
<li>PINMemoryCache</li>
<li>TMMemoryCachee</li>
</ul>
<p>得出的性能结果如下</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11-02.png?attname=" alt=""></p>
<p>上图TMMemoryCache的测试结果因为性能太差并没有显示出来。</p>
<p>磁盘缓存的实现技术大致分为</p>
<ul>
<li>基于文件读写</li>
<li>基于mmap文件内存映射</li>
<li>基于数据库</li>
</ul>
<p>TMDiskCache, PINDiskCache, SDWebImage 等缓存，都是基于文件系统的，即一个 Value 对应一个文件，通过文件读写来缓存数据。</p>
<p>FastImageCache 采用的是 mmap 将文件映射到内存。</p>
<p>NSURLCache、FBDiskCache 都是基于 SQLite 数据库的。SQLite 写入性能比直接写文件要高，但读取性能取决于数据大小：当单条数据小于 20K 时，数据越小 SQLite 读取性能越高；单条数据大于 20K 时，直接写为文件速度会更快一些。</p>
<p>所以磁盘缓存最好是把 SQLite 和文件存储结合起来：key-value 元数据保存在 SQLite 中，而 value 数据则根据大小不同选择 SQLite 或文件存储。YYDiskCache 就是采用的 SQLite 配合文件的存储方式，参数inlineThreshold,默认20KB,小于它存数据库,大于它存文件。</p>
<p>作者对比了<code>YYDiskCache</code>、<code>PINDiskCache</code>、<code>TMDiskCache</code>三种磁盘存储方式，得出的性能结果如下<br><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11-01.png?attname=" alt=""></p>
<p><code>YYCache</code>的优势包括</p>
<ul>
<li>LRU: 缓存支持 LRU (least-recently-used) 淘汰算法。</li>
<li>缓存控制: 支持多种缓存控制方法：总数量、总大小、存活时间、空闲空间。</li>
<li>兼容性: API 基本和 NSCache 保持一致, 所有方法都是线程安全的。</li>
<li>内存缓存<ul>
<li>对象释放控制: 对象的释放(release) 可以配置为同步或异步进行，可以配置在主线程或后台线程进行。</li>
<li>自动清空: 当收到内存警告或 App 进入后台时，缓存可以配置为自动清空。</li>
</ul>
</li>
<li>磁盘缓存<ul>
<li>可定制性: 磁盘缓存支持自定义的归档解档方法，以支持那些没有实现 NSCoding 协议的对象。</li>
<li>存储类型控制: 磁盘缓存支持对每个对象的存储类型 (SQLite/文件) 进行自动或手动控制，以获得更高的存取性能。</li>
</ul>
</li>
</ul>
<h4 id="u90E8_u5206_u65B9_u6CD5_u4F7F_u7528"><a href="#u90E8_u5206_u65B9_u6CD5_u4F7F_u7528" class="headerlink" title="部分方法使用"></a>部分方法使用</h4><p><code>- (BOOL)containsObjectForKey:(NSString *)key;</code></p>
<p>返回一个布尔值,指示是否一个给定的关键是在缓存中。这种方法可能会阻塞调用线程,直到文件读取完成。</p>
<p><br><br><code>- (void)containsObjectForKey:(NSString *)key withBlock:(void ( ^ ) ( NSString *key , BOOL contains ))block</code></p>
<p>返回一个布尔值表示的块是否一个给定的关键字在缓存中。该方法立即返回,调用时在后台通过块队列操作完成。</p>
<p><code>- (instancetype)initWithPath:(NSString *)path</code></p>
<p>根据指定的名称创建一个新的实例。具有相同名称的多个实例将使缓存不稳定。</p>
<p><code>- (void)objectForKey:(NSString *)key withBlock:(void ( ^ ) ( NSString *key , id&lt;NSCoding&gt; object ))block</code></p>
<p>返回给定的键相关联的值。该方法立即返回,调用时在后台通过块队列操作完成。</p>
<p><code>- (void)removeObjectForKey:(NSString *)key withBlock:(void ( ^ ) ( NSString *key ))block</code></p>
<p>在缓存中移除指定键的值。该方法立即返回,调用时在后台通过块队列操作完成。</p>
<p><code>- (void)removeAllObjects</code></p>
<p>清空缓存。这种方法可能会阻塞调用线程,直到文件删除了。</p>
<p><code>- (void)removeAllObjectsWithBlock:(void(^)(void))block;</code><br>清空缓存。该方法立即返回，调用时在后台通过块队列操作完成。</p>
<p><a href="http://blog.ibireme.com/2015/10/26/yycache/" target="_blank" rel="external">YYCache 设计思路与技术细节</a>  这篇文章作者讲述了部分设计思路和实现细节，可以看看</p>
<h2 id="YYImage"><a href="#YYImage" class="headerlink" title="YYImage"></a>YYImage</h2><h4 id="u5B89_u88C5-2"><a href="#u5B89_u88C5-2" class="headerlink" title="安装"></a>安装</h4><h6 id="CocoaPods-3"><a href="#CocoaPods-3" class="headerlink" title="CocoaPods"></a>CocoaPods</h6><blockquote>
<ol>
<li>将 cocoapods 更新至最新版本.</li>
<li>在 Podfile 中添加 pod ‘YYImage’</li>
<li>执行 pod install 或 pod update</li>
<li>导入 <code>&lt;YYImage/YYImage.h&gt;</code></li>
<li>注意：pod 配置并没有包含 WebP 组件, 如果你需要支持 WebP，可以在 Podfile 中添加 pod ‘YYImage/WebP’。你可以调用 YYImageWebPAvailable() 来检查一下 WebP 组件是否被正确安装</li>
</ol>
</blockquote>
<h6 id="Carthage-3"><a href="#Carthage-3" class="headerlink" title="Carthage"></a>Carthage</h6><blockquote>
<ol>
<li>在 Cartfile 中添加 github “ibireme/YYImage”。</li>
<li>执行 carthage update –platform ios 并将生成的 framework 添加到你的工程。</li>
<li>导入 <code>&lt;YYImage/YYImage.h&gt;</code></li>
<li>注意：carthage framework 并没有包含 WebP 组件。如果你需要支持 WebP，可以用 CocoaPods 安装，或者手动安装。</li>
</ol>
</blockquote>
<h6 id="u624B_u52A8_u5B89_u88C5-3"><a href="#u624B_u52A8_u5B89_u88C5-3" class="headerlink" title="手动安装"></a>手动安装</h6><blockquote>
<ol>
<li>下载 YYImage 文件夹内的所有内容</li>
<li>将 YYImage 内的源文件添加(拖放)到你的工程<br>3 . 链接以下 frameworks:</li>
</ol>
<ul>
<li>UIKit</li>
<li>CoreFoundation</li>
<li>QuartzCore</li>
<li>AssetsLibrary</li>
<li>ImageIO</li>
<li>Accelerate</li>
<li>MobileCoreServices</li>
<li>libz</li>
</ul>
<p>4 . 导入 <code>YYImage.h</code></p>
<p> 5 .  注意：如果你需要支持 WebP，可以将 Vendor/WebP.framework(静态库) 加入你的工程。你可以调用 YYImageWebPAvailable() 来检查一下 WebP 组件是否被正确安装</p>
</blockquote>
<p>提供的演示Demo地址: <a href="https://github.com/ibireme/YYImage" target="_blank" rel="external">https://github.com/ibireme/YYImage</a></p>
<h5 id="u7279_u6027_3A"><a href="#u7279_u6027_3A" class="headerlink" title="特性:"></a>特性:</h5><ul>
<li>支持以下类型动画图像的播放/编码/解码:<ul>
<li>WebP, APNG, GIF。</li>
</ul>
</li>
<li>支持以下类型静态图像的显示/编码/解码:<ul>
<li>WebP, PNG, GIF, JPEG, JP2, TIFF, BMP, ICO, ICNS。</li>
</ul>
</li>
<li>支持以下类型图片的渐进式/逐行扫描/隔行扫描解码:<br>  *PNG, GIF, JPEG, BMP。</li>
<li>支持多张图片构成的帧动画播放，支持单张图片的 sprite sheet 动画。</li>
<li>高效的动态内存缓存管理，以保证高性能低内存的动画播放。</li>
<li>完全兼容 UIImage 和 UIImageView，使用方便。</li>
<li>保留可扩展的接口，以支持自定义动画。</li>
<li>每个类和方法都有完善的文档注释。</li>
</ul>
<p>图片本身有 3 种常见的编码方式</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_30.gif?attname=" alt=""><br><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_31.gif?attname=" alt=""><br><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_32.gif?attname=" alt=""></p>
<p>第一种baseline,即逐行扫描。默认情况下JPEG、PNG、GIF 都是这种保存方式</p>
<p>第二种interaced,即隔行扫描。PNG 和 GIF 在保存时可以选择这种格式</p>
<p>第三种是progressive,即渐进式。JPEG 在保存时可以选择这种方式。</p>
<p>在下载图片时，首先用 <code>CGImageSourceCreateIncremental(NULL)</code> 创建一个空的图片源，随后在获得新数据时调用<br><code>CGImageSourceUpdateData(data, false)</code> 来更新图片源，最后在用 <code>CGImageSourceCreateImageAtIndex()</code> 创建图片来显示。</p>
<h4 id="u90E8_u5206_u65B9_u6CD5_u4F7F_u7528-1"><a href="#u90E8_u5206_u65B9_u6CD5_u4F7F_u7528-1" class="headerlink" title="部分方法使用"></a>部分方法使用</h4><h6 id="u663E_u793A_u52A8_u753B_u7C7B_u578B_u7684_u56FE_u7247"><a href="#u663E_u793A_u52A8_u753B_u7C7B_u578B_u7684_u56FE_u7247" class="headerlink" title="显示动画类型的图片"></a>显示动画类型的图片</h6><p><code>UIImage *image = [YYImage imageNamed:@&quot;ani.gif&quot;];</code></p>
<p><code>UIImageView *imageView = [[YYAnimatedImageView alloc]initWithImage:image];</code></p>
<p><code>[self.view addSubView:imageView];</code></p>
<h6 id="u64AD_u653E_u5E27_u52A8_u753B"><a href="#u64AD_u653E_u5E27_u52A8_u753B" class="headerlink" title="播放帧动画"></a>播放帧动画</h6><p><code>NSArray *paths = @[@&quot;/ani/frame1.png&quot;, @&quot;/ani/frame2.png&quot;, @&quot;/ani/frame3.png&quot;];</code></p>
<p><code>NSArray *times = @[@0.1, @0.2, @0.1];</code></p>
<p><code>UIImage *image = [YYFrameImage alloc] initWithImagePaths:paths frameDurations:times repeats:YES];</code></p>
<p><code>UIImageView *imageView = [YYAnimatedImageView alloc]</code>initWithImage:image];</p>
<p><code>[self.view addSubView:imageView];</code></p>
<h6 id="u64AD_u653E_sprite_sheet__u52A8_u753B"><a href="#u64AD_u653E_sprite_sheet__u52A8_u753B" class="headerlink" title="播放 sprite sheet 动画"></a>播放 sprite sheet 动画</h6><p><code>UIImage *spriteSheet = [UIImage imageNamed:@&quot;sprite-sheet&quot;];</code></p>
<p><code>NSMutableArray *contentRects = [NSMutableArray new];</code></p>
<p><code>NSMutableArray *durations = [NSMutableArray new];</code></p>
<p><code>for (int j = 0; j &lt; 12; j++) {</code></p>
<p>   <code>for (int i = 0; i &lt; 8; i++) {</code></p>
<pre><code>CGRect rect;
rect.size = CGSizeMake(img.size.width / 8, img.size.height / 12);
rect.origin.x = img.size.width / 8 * i;
rect.origin.y = img.size.height / 12 * j;
[contentRects addObject:[NSValue valueWithCGRect:rect]];
[durations addObject:@(1 / 60.0)];
</code></pre><p>   <code>}</code><br><code>}</code></p>
<p><code>YYSpriteSheetImage *sprite;</code><br><code>sprite = [[YYSpriteSheetImage alloc] initWithSpriteSheetImage:img
                                                contentRects:contentRects
                                              frameDurations:durations
                                                   loopCount:0];</code></p>
<p><code>YYAnimatedImageView *imageView = [YYAnimatedImageView new];</code></p>
<p><code>imageView.size = CGSizeMake(img.size.width / 8, img.size.height / 12);</code></p>
<p><code>imageView.image = sprite;</code></p>
<p><code>[self.view addSubView:imageView];</code></p>
<h6 id="u52A8_u753B_u64AD_u653E_u63A7_u5236"><a href="#u52A8_u753B_u64AD_u653E_u63A7_u5236" class="headerlink" title="动画播放控制"></a>动画播放控制</h6><p><code>YYAnimatedImageView *imageView = ...;</code></p>
<p>// 暂停:</p>
<p><code>[imageView stopAnimating];</code></p>
<p>// 播放:</p>
<p><code>[imageView startAnimating];</code></p>
<p>// 设置播放进度:</p>
<p><code>imageView.currentAnimatedImageIndex = 12;</code></p>
<p>// 获取播放状态:</p>
<p><code>image.currentIsPlayingAnimation;</code></p>
<h6 id="u56FE_u7247_u89E3_u7801"><a href="#u56FE_u7247_u89E3_u7801" class="headerlink" title="图片解码"></a>图片解码</h6><p>// 解码单帧图片:</p>
<p><code>NSData *data = [NSData dataWithContentOfFile:@&quot;/tmp/image.webp&quot;];</code></p>
<p><code>YYImageDecoder *decoder = [YYImageDecoder decoderWithData:data scale:2.0];</code></p>
<p><code>UIImage image = [decoder frameAtIndex:0 decodeForDisplay:YES].image;</code></p>
<p>// 渐进式图片解码 (可用于图片下载显示):</p>
<p><code>NSMutableData *data = [NSMutableData new];</code></p>
<p><code>YYImageDecoder *decoder = [[YYImageDecoder alloc] initWithScale:2.0];</code></p>
<p><code>while(newDataArrived) {</code></p>
<p>   <code>[data appendData:newData];</code></p>
<p>   <code>[decoder updateData:data final:NO];</code></p>
<p>   <code>if (decoder.frameCount &gt; 0) {</code></p>
<pre><code>`` UIImage image = [decoder frameAtIndex:0 decodeForDisplay:YES].image;``

 // progressive display...
</code></pre><p>  <code>}</code><br><code>}</code></p>
<p><code>[decoder updateData:data final:YES];</code><br><code>UIImage image = [decoder frameAtIndex:0 decodeForDisplay:YES].image;</code></p>
<p><code>// final display...</code></p>
<h6 id="u56FE_u7247_u7F16_u7801"><a href="#u56FE_u7247_u7F16_u7801" class="headerlink" title="图片编码"></a>图片编码</h6><p>// 编码静态图 (支持各种常见图片格式):</p>
<p><code>YYImageEncoder *jpegEncoder = [[YYImageEncoder alloc] initWithType:YYImageTypeJPEG];</code></p>
<p><code>jpegEncoder.quality = 0.9;</code></p>
<p><code>[jpegEncoder addImage:image duration:0];</code></p>
<p><code>NSData jpegData = [jpegEncoder encode];</code></p>
<p>// 编码动态图 (支持 GIF/APNG/WebP):</p>
<p><code>YYImageEncoder *webpEncoder = [[YYImageEncoder alloc] initWithType:YYImageTypeWebP];</code></p>
<p><code>webpEncoder.loopCount = 5;</code></p>
<p><code>[webpEncoder addImage:image0 duration:0.1];</code></p>
<p><code>[webpEncoder addImage:image1 duration:0.15];</code></p>
<p><code>[webpEncoder addImage:image2 duration:0.2];</code></p>
<p><code>NSData webpData = [webpEncoder encode];</code></p>
<h6 id="u56FE_u7247_u7C7B_u578B_u63A2_u6D4B"><a href="#u56FE_u7247_u7C7B_u578B_u63A2_u6D4B" class="headerlink" title="图片类型探测"></a>图片类型探测</h6><p>// 获取图片类型</p>
<p><code>YYImageType type = YYImageDetectType(data);</code></p>
<p><code>if (type == YYImageTypePNG) ...</code></p>
<p>Demo展示效果如下</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016-05-11_20.gif?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016-05-11_21.gif?attname=" alt=""></p>
<p><a href="http://blog.ibireme.com/2015/11/02/mobile_image_benchmark/" target="_blank" rel="external">移动端图片格式调研</a></p>
<p><a href="http://blog.ibireme.com/2015/11/02/ios_image_tips/" target="_blank" rel="external">iOS 处理图片的一些小 Tip</a></p>
<p>这两篇文章是作者的相关解读。</p>
<h2 id="YYWebImage"><a href="#YYWebImage" class="headerlink" title="YYWebImage"></a>YYWebImage</h2><h4 id="u5B89_u88C5-3"><a href="#u5B89_u88C5-3" class="headerlink" title="安装"></a>安装</h4><h6 id="CocoaPods-4"><a href="#CocoaPods-4" class="headerlink" title="CocoaPods"></a>CocoaPods</h6><blockquote>
<ol>
<li>将 cocoapods 更新至最新版本</li>
<li>在 Podfile 中添加 pod ‘YYWebImage’</li>
<li>执行 pod install 或 pod update</li>
<li>导入 <code>&lt;YYWebImage/YYWebImage.h&gt;</code></li>
<li>注意：pod 配置并没有包含 WebP 组件, 如果你需要支持 WebP，可以在 Podfile 中添加 pod ‘YYImage/WebP’。你可以调用 YYImageWebPAvailable() 来检查一下 WebP 组件是否被正确安装</li>
</ol>
</blockquote>
<h6 id="Carthage-4"><a href="#Carthage-4" class="headerlink" title="Carthage"></a>Carthage</h6><blockquote>
<ol>
<li>在 Cartfile 中添加 github “ibireme/YYWebImage”</li>
<li>执行 carthage update –platform ios 并将生成的 framework 添加到你的工程。</li>
<li>导入 <code>&lt;YYWebImage/YYWebImage.h&gt;</code></li>
<li>注意: carthage framework 并没有包含 webp 组件。如果你需要支持 WebP，可以用 CocoaPods 安装，或者手动安装</li>
</ol>
</blockquote>
<h6 id="u624B_u52A8_u5B89_u88C5-4"><a href="#u624B_u52A8_u5B89_u88C5-4" class="headerlink" title="手动安装"></a>手动安装</h6><blockquote>
<ol>
<li>下载 YYWebImage 文件夹内的所有内容。</li>
<li>将 YYWebImage 内的源文件添加(拖放)到你的工程。</li>
<li>链接以下 frameworks:<ul>
<li>UIKit</li>
<li>CoreFoundation</li>
<li>QuartzCore</li>
<li>AssetsLibrary</li>
<li>ImageIO</li>
<li>Accelerate</li>
<li>MobileCoreServices</li>
<li>sqlite3</li>
<li>libz</li>
</ul>
</li>
</ol>
<p>4.导入 YYWebImage.h。</p>
<p>5.注意：如果你需要支持 WebP，可以将 Vendor/WebP.framework(静态库) 加入你的工程。你可以调用 YYImageWebPAvailable() 来检查一下 WebP 组件是否被正确安装</p>
</blockquote>
<p>提供的Demo演示地址: <a href="https://github.com/ibireme/YYWebImage" target="_blank" rel="external">https://github.com/ibireme/YYWebImage</a></p>
<p>YYWebImage是一个异步图片加载框架，目的是为了试图替代<code>SDWebImage</code>、<code>PINRemoteImage</code>、<code>FLAnimatedImage</code> 等开源框架。支持这些开源框架的大部分功能，同时增加了大量新特性、并且有不小的性能提升。其底层用 YYCache 实现了内存和磁盘缓存, 用 YYImage 实现了 WebP/APNG/GIF 动图的解码和播放。</p>
<h4 id="u76F8_u5173_u7279_u6027"><a href="#u76F8_u5173_u7279_u6027" class="headerlink" title="相关特性"></a>相关特性</h4><ul>
<li>异步的图片加载，支持 HTTP 和本地文件。</li>
<li>支持 GIF、APNG、WebP 动画（动态缓存，低内存占用）。</li>
<li>支持逐行扫描、隔行扫描、渐进式图像加载。</li>
<li>UIImageView、UIButton、MKAnnotationView、CALayer 的 Category 方法支持。</li>
<li>常见图片处理：模糊、圆角、大小调整、裁切、旋转、色调等。</li>
<li>高性能的内存和磁盘缓存。</li>
<li>高性能的图片设置方式，以避免主线程阻塞。</li>
<li>每个类和方法都有完善的文档注释。</li>
</ul>
<h4 id="u90E8_u5206_u65B9_u6CD5_u4F7F_u7528-2"><a href="#u90E8_u5206_u65B9_u6CD5_u4F7F_u7528-2" class="headerlink" title="部分方法使用"></a>部分方法使用</h4><h6 id="u4ECE_URL__u52A0_u8F7D_u56FE_u7247"><a href="#u4ECE_URL__u52A0_u8F7D_u56FE_u7247" class="headerlink" title="从 URL 加载图片"></a>从 URL 加载图片</h6><p>// 加载网络图片</p>
<p><code>imageView.yy_imageURL = [NSURL URLWithString:@&quot;http://github.com/logo.png&quot;];</code></p>
<p>// 加载本地图片</p>
<p><code>imageView.yy_imageURL = [NSURL fileURLWithPath:@&quot;/tmp/logo.png&quot;];</code></p>
<h6 id="u52A0_u8F7D_u52A8_u56FE"><a href="#u52A0_u8F7D_u52A8_u56FE" class="headerlink" title="加载动图"></a>加载动图</h6><p>// 只需要把 <code>UIImageView</code> 替换为 <code>YYAnimatedImageView</code> 即可。</p>
<p><code>UIImageView *imageView = [YYAnimatedImageView new];</code></p>
<p><code>imageView.yy_imageURL = [NSURL URLWithString:@&quot;http://github.com/ani.webp&quot;];</code></p>
<h4 id="u6E10_u8FDB_u5F0F_u56FE_u7247_u52A0_u8F7D"><a href="#u6E10_u8FDB_u5F0F_u56FE_u7247_u52A0_u8F7D" class="headerlink" title="渐进式图片加载"></a>渐进式图片加载</h4><p>// 渐进式：边下载边显示</p>
<ul>
<li>[imageView yy_setImageWithURL:url options:YYWebImageOptionProgressive];</li>
</ul>
<p>// 渐进式加载，增加模糊效果和渐变动画</p>
<ul>
<li>[imageView yy_setImageWithURL:url options:YYWebImageOptionProgressiveBlur ｜ YYWebImageOptionSetImageWithFadeAnimation];</li>
</ul>
<h4 id="u52A0_u8F7D_u3001_u5904_u7406_u56FE_u7247"><a href="#u52A0_u8F7D_u3001_u5904_u7406_u56FE_u7247" class="headerlink" title="加载、处理图片"></a>加载、处理图片</h4><ul>
<li><ol>
<li>下载图片</li>
</ol>
</li>
<li><ol>
<li>获得图片下载进度</li>
</ol>
</li>
<li><ol>
<li>调整图片大小、加圆角</li>
</ol>
</li>
<li><ol>
<li>显示图片时增加一个淡入动画，以获得更好的用户体验</li>
</ol>
</li>
</ul>
<p><code>[imageView yy_setImageWithURL:url</code></p>
<p><code>placeholder:nil</code></p>
<pre><code>options:YYWebImageOptionSetImageWithFadeAnimation
progress:^(NSInteger receivedSize, NSInteger expectedSize) {
    progress = (float)receivedSize / expectedSize;
}
transform:^UIImage *(UIImage *image, NSURL *url) {
    image = [image yy_imageByResizeToSize:CGSizeMake(100, 100) contentMode:UIViewContentModeCenter];
    return [image yy_imageByRoundCornerRadius:10];
}
completion:^(UIImage *image, NSURL *url, YYWebImageFromType from, YYWebImageStage stage, NSError *error) {
    if (from == YYWebImageFromDiskCache) {
        NSLog(@&quot;load from disk cache&quot;);
    }
}];
</code></pre><h4 id="u56FE_u7247_u7F13_u5B58"><a href="#u56FE_u7247_u7F13_u5B58" class="headerlink" title="图片缓存"></a>图片缓存</h4><p><code>YYImageCache *cache = [YYWebImageManager sharedManager].cache;</code></p>
<p>// 获取缓存大小</p>
<p><code>cache.memoryCache.totalCost;</code></p>
<p><code>cache.memoryCache.totalCount;</code></p>
<p><code>cache.diskCache.totalCost;</code></p>
<p><code>cache.diskCache.totalCount;</code></p>
<p>// 清空缓存</p>
<p><code>[cache.memoryCache removeAllObjects];</code></p>
<p><code>[cache.diskCache removeAllObjects];</code></p>
<p>// 清空磁盘缓存，带进度回调</p>
<p><code>[cache.diskCache removeAllObjectsWithProgressBlock:^(int</code></p>
<p><code>removedCount, int totalCount) {</code></p>
<pre><code>// progress
</code></pre><p><code>} endBlock:^(BOOL error) {</code></p>
<pre><code>// end
</code></pre><p><code>}];</code></p>
<h2 id="YYText"><a href="#YYText" class="headerlink" title="YYText"></a>YYText</h2><h4 id="u5B89_u88C5-4"><a href="#u5B89_u88C5-4" class="headerlink" title="安装"></a>安装</h4><h6 id="CocoaPods-5"><a href="#CocoaPods-5" class="headerlink" title="CocoaPods"></a>CocoaPods</h6><blockquote>
<ol>
<li>在 Podfile 中添加 pod ‘YYText’</li>
<li>执行 pod install 或 pod update</li>
<li>导入 <code>&lt;YYText/YYText.h&gt;</code></li>
</ol>
</blockquote>
<h6 id="Carthage-5"><a href="#Carthage-5" class="headerlink" title="Carthage"></a>Carthage</h6><blockquote>
<ol>
<li>在 Cartfile 中添加 github “ibireme/YYText”</li>
<li>执行 carthage update –platform ios 并将生成的 framework 添加到你的工程</li>
<li>导入 <code>&lt;YYText/YYText.h&gt;</code></li>
</ol>
</blockquote>
<h6 id="u624B_u52A8_u5B89_u88C5-5"><a href="#u624B_u52A8_u5B89_u88C5-5" class="headerlink" title="手动安装"></a>手动安装</h6><blockquote>
<ol>
<li>下载 YYText 文件夹内的所有内容</li>
<li>将 YYText 内的源文件添加(拖放)到你的工程</li>
<li>链接以下 frameworks:<ul>
<li>UIKit</li>
<li>CoreFoundation</li>
<li>CoreText</li>
<li>QuartzCore</li>
<li>Accelerate</li>
<li>MobileCoreServices</li>
</ul>
</li>
<li>导入 YYText.h</li>
</ol>
</blockquote>
<p>提供Demo地址:<a href="https://github.com/ibireme/YYText" target="_blank" rel="external">https://github.com/ibireme/YYText</a></p>
<p>YYText是功能强大的富文本编辑与显示框架</p>
<h4 id="u76F8_u5173_u7279_u6027-1"><a href="#u76F8_u5173_u7279_u6027-1" class="headerlink" title="相关特性"></a>相关特性</h4><ul>
<li>API 兼容 UILabel 和 UITextView</li>
<li>支持高性能的异步排版和渲染</li>
<li>扩展了 CoreText 的属性以支持更多文字效果</li>
<li>支持 UIImage、UIView、CALayer 作为图文混排元素</li>
<li>支持添加自定义样式的、可点击的文本高亮范围</li>
<li>支持自定义文本解析 (内置简单的 Markdown/表情解析)</li>
<li>支持文本容器路径、内部留空路径的控制</li>
<li>支持文字竖排版，可用于编辑和显示中日韩文本</li>
<li>支持图片和富文本的复制粘贴</li>
<li>文本编辑时，支持富文本占位符</li>
<li>支持自定义键盘视图</li>
<li>撤销和重做次数的控制</li>
<li>富文本的序列化与反序列化支持</li>
<li>支持多语言，支持 VoiceOver</li>
<li>支持 Interface Builder</li>
<li>全部代码都有文档注释</li>
</ul>
<h4 id="u5DF2_u77E5_u95EE_u9898"><a href="#u5DF2_u77E5_u95EE_u9898" class="headerlink" title="已知问题"></a>已知问题</h4><ul>
<li>YYText 并不能支持所有 CoreText/TextKit 的属性，比如 NSBackgroundColor、NSStrikethrough、NSUnderline、NSAttachment、NSLink 等，但 YYText 中基本都有对应属性作为替代。</li>
<li>YYTextView 未实现局部刷新，所以在输入和编辑大量的文本（比如超过大概五千个汉字、或大概一万个英文字符）时会出现较明显的卡顿现象。</li>
<li>竖排版时，添加 exclusionPaths 在少数情况下可能会导致文本显示空白。</li>
<li>当添加了非矩形的 textContainerPath，并且有嵌入大于文本排版方向宽度的 RunDelegate 时，RunDelegate 之后的文字会无法显示。这是 CoreText 的 Bug（或者说是 Feature）。</li>
</ul>
<h5 id="u90E8_u5206_u6548_u679C_u56FE"><a href="#u90E8_u5206_u6548_u679C_u56FE" class="headerlink" title="部分效果图"></a>部分效果图</h5><p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_40.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_41.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_42.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_43.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_44.png?attname=" alt=""></p>
<h4 id="u90E8_u5206_u4F7F_u7528_u65B9_u6CD5-1"><a href="#u90E8_u5206_u4F7F_u7528_u65B9_u6CD5-1" class="headerlink" title="部分使用方法"></a>部分使用方法</h4><p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_45.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_46.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_47.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_48.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_49.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_50.png?attname=" alt=""></p>
<h2 id="YYKeyboardManager"><a href="#YYKeyboardManager" class="headerlink" title="YYKeyboardManager"></a>YYKeyboardManager</h2><h4 id="u5B89_u88C5-5"><a href="#u5B89_u88C5-5" class="headerlink" title="安装"></a>安装</h4><h6 id="CocoaPods-6"><a href="#CocoaPods-6" class="headerlink" title="CocoaPods"></a>CocoaPods</h6><blockquote>
<ol>
<li>在 Podfile 中添加 pod ‘YYKeyboardManager’</li>
<li>执行 pod install 或 pod update</li>
<li>导入 <code>&lt;YYKeyboardManager/YYKeyboardManager.h&gt;</code></li>
</ol>
</blockquote>
<h6 id="Carthage-6"><a href="#Carthage-6" class="headerlink" title="Carthage"></a>Carthage</h6><blockquote>
<ol>
<li>在 Cartfile 中添加 github “ibireme/YYKeyboardManager”</li>
<li>执行 carthage update –platform ios 并将生成的 framework 添加到你的工程</li>
<li>导入 <code>&lt;YYKeyboardManager/YYKeyboardManager.h&gt;</code></li>
</ol>
</blockquote>
<h6 id="u624B_u52A8_u5B89_u88C5-6"><a href="#u624B_u52A8_u5B89_u88C5-6" class="headerlink" title="手动安装"></a>手动安装</h6><blockquote>
<ol>
<li>下载 YYKeyboardManager 文件夹内的所有内容</li>
<li>将 YYKeyboardManager 内的源文件添加(拖放)到你的工程</li>
<li>导入 YYKeyboardManager.h</li>
</ol>
</blockquote>
<p>提供的Demo地址:<a href="https://github.com/ibireme/YYKeyboardManager" target="_blank" rel="external">https://github.com/ibireme/YYKeyboardManager</a></p>
<p>YYKeyboardManager是一个iOS键盘监听管理工具类。兼容 iPhone / iPad / iPod，兼容 iOS 6 / 7 / 8 / 9， 并且能很好的处理屏幕旋转。我之前一直使用的监听键盘工具主要是TPKeyboardAvoiding、IQKeyboardManager和自己写的一个工具类，大体可以满足需求。</p>
<h4 id="u4F7F_u7528_u65B9_u6CD5"><a href="#u4F7F_u7528_u65B9_u6CD5" class="headerlink" title="使用方法"></a>使用方法</h4><p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_51.png?attname=" alt=""></p>
<h2 id="YYDispatchQueuePool"><a href="#YYDispatchQueuePool" class="headerlink" title="YYDispatchQueuePool"></a>YYDispatchQueuePool</h2><h6 id="u5B89_u88C5-6"><a href="#u5B89_u88C5-6" class="headerlink" title="安装"></a>安装</h6><h6 id="CocoaPods-7"><a href="#CocoaPods-7" class="headerlink" title="CocoaPods"></a>CocoaPods</h6><blockquote>
<ol>
<li>在 Podfile 中添加 pod ‘YYDispatchQueuePool’</li>
<li>执行 pod install 或 pod update</li>
<li>导入 <code>&lt;YYDispatchQueuePool/YYDispatchQueuePool.h&gt;</code></li>
</ol>
</blockquote>
<h6 id="Carthage-7"><a href="#Carthage-7" class="headerlink" title="Carthage"></a>Carthage</h6><blockquote>
<ol>
<li>在 Cartfile 中添加 github “ibireme/YYDispatchQueuePool”</li>
<li>执行 carthage update –platform ios 并将生成的 framework 添加到你的工程</li>
<li>导入 <code>&lt;YYDispatchQueuePool/YYDispatchQueuePool.h&gt;</code></li>
</ol>
</blockquote>
<h6 id="u624B_u52A8_u5B89_u88C5-7"><a href="#u624B_u52A8_u5B89_u88C5-7" class="headerlink" title="手动安装"></a>手动安装</h6><blockquote>
<ol>
<li>下载 YYDispatchQueuePool 文件夹内的所有内容</li>
<li>将 YYDispatchQueuePool 内的源文件添加(拖放)到你的工程</li>
<li>导入 YYDispatchQueuePool.h</li>
</ol>
</blockquote>
<p>YYDispatchQueuePool是iOS全局并发队列管理工具。</p>
<p>提供的下载地址: <a href="https://github.com/ibireme/YYDispatchQueuePool" target="_blank" rel="external">https://github.com/ibireme/YYDispatchQueuePool</a></p>
<h4 id="u4F7F_u7528_u65B9_u6CD5-1"><a href="#u4F7F_u7528_u65B9_u6CD5-1" class="headerlink" title="使用方法"></a>使用方法</h4><p>// 从全局的 queue pool 中获取一个 queue</p>
<p><code>dispatch_queue_t queue = YYDispatchQueueGetForQOS(NSQualityOfServiceUtility);</code></p>
<p>// 创建一个新的 serial queue pool</p>
<p><code>YYDispatchQueuePool *pool = [[YYDispatchQueuePool alloc] initWithName:@&quot;file.read&quot; queueCount:5 qos:NSQualityOfServiceBackground];</code></p>
<p><code>dispatch_queue_t queue = [pool queue];</code></p>
<h2 id="YYAsyncLayer"><a href="#YYAsyncLayer" class="headerlink" title="YYAsyncLayer"></a>YYAsyncLayer</h2><h4 id="u5B89_u88C5-7"><a href="#u5B89_u88C5-7" class="headerlink" title="安装"></a>安装</h4><h6 id="CocoaPods-8"><a href="#CocoaPods-8" class="headerlink" title="CocoaPods"></a>CocoaPods</h6><blockquote>
<ol>
<li>在 Podfile 中添加 pod ‘YYAsyncLayer’</li>
<li>执行 pod install 或 pod update</li>
<li>导入 <code>&lt;YYAsyncLayer/YYAsyncLayer.h&gt;</code></li>
</ol>
</blockquote>
<h6 id="Carthage-8"><a href="#Carthage-8" class="headerlink" title="Carthage"></a>Carthage</h6><blockquote>
<ol>
<li>在 Cartfile 中添加 github “ibireme/YYAsyncLayer”。</li>
<li>执行 carthage update –platform ios 并将生成的 framework 添加到你的工程。</li>
<li>导入 <code>&lt;YYAsyncLayer/YYAsyncLayer.h&gt;</code></li>
</ol>
</blockquote>
<h6 id="u624B_u52A8_u5B89_u88C5-8"><a href="#u624B_u52A8_u5B89_u88C5-8" class="headerlink" title="手动安装"></a>手动安装</h6><blockquote>
<ol>
<li>下载 YYAsyncLayer 文件夹内的所有内容。</li>
<li>将 YYAsyncLayer 内的源文件添加(拖放)到你的工程。</li>
<li>导入 YYAsyncLayer.h。</li>
</ol>
</blockquote>
<p>YYAsyncLayer是iOS异步绘制与显示的工具类。</p>
<p>提供的下载地址: <a href="https://github.com/ibireme/YYAsyncLayer" target="_blank" rel="external">https://github.com/ibireme/YYAsyncLayer</a></p>
<h4 id="u7B80_u5355_u4F7F_u7528_u65B9_u6CD5"><a href="#u7B80_u5355_u4F7F_u7528_u65B9_u6CD5" class="headerlink" title="简单使用方法"></a>简单使用方法</h4><p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_55.png?attname=" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_11_56.png?attname=" alt=""></p>
<h2 id="YYCategories"><a href="#YYCategories" class="headerlink" title="YYCategories"></a>YYCategories</h2><h4 id="u5B89_u88C5-8"><a href="#u5B89_u88C5-8" class="headerlink" title="安装"></a>安装</h4><h6 id="CocoaPods-9"><a href="#CocoaPods-9" class="headerlink" title="CocoaPods"></a>CocoaPods</h6><blockquote>
<ol>
<li>在 Podfile 中添加 pod ‘YYCategories’。</li>
<li>执行 pod install 或 pod update。</li>
<li>导入 <code>&lt;YYCategories/YYCategories.h&gt;</code></li>
</ol>
</blockquote>
<p>######Carthage</p>
<blockquote>
<ol>
<li>在 Cartfile 中添加 github “ibireme/YYCategories”。</li>
<li>执行 carthage update –platform ios 并将生成的 framework 添加到你的工程。</li>
<li>导入 <code>&lt;YYCategories/YYCategories.h&gt;</code></li>
</ol>
</blockquote>
<h6 id="u624B_u52A8_u5B89_u88C5-9"><a href="#u624B_u52A8_u5B89_u88C5-9" class="headerlink" title="手动安装"></a>手动安装</h6><blockquote>
<ol>
<li>下载 YYCategories 文件夹内的所有内容。</li>
<li>将 YYCategories 内的源文件添加(拖放)到你的工程。</li>
<li>为 NSObject+YYAddForARC.m 和 NSThread+YYAdd.m 添加编译参数 -fno-objc-arc</li>
<li>链接以下 frameworks:<ul>
<li>UIKit</li>
<li>CoreGraphics</li>
<li>QuartzCore</li>
<li>Accelerate</li>
<li>ImageIO</li>
<li>CoreText</li>
<li>CoreFoundation</li>
<li>libz</li>
</ul>
</li>
<li>导入 YYCategories.h。</li>
</ol>
</blockquote>
<p>YYCategories是功能丰富的 Category 类型工具库。</p>
<p>提供的下载地址:<a href="https://github.com/ibireme/YYCategories" target="_blank" rel="external">https://github.com/ibireme/YYCategories</a></p>
<hr>
<p>以上，<code>YYDispatchQueuePool</code>和<code>YYAsyncLayer</code>这两个工具类并没有花时间好好去研究，使用方法只是照搬过来，对于文中作者所讲的鉴于水平有限仍然有些疑惑，以后有时间再去研究。</p>
<p>YYKit包含的知识容量太过庞大，知识体系要求也更为全面，在研究之初对于文中的很多点并没有直观的认识，现在再去通读一遍感受也更为真切，更为深刻的认识只能在以后项目使用中再去体会！</p>
<hr>
<p>如有任何疑问或问题请联系我:fishnewsdream@gmail.com,欢迎交流，共同提高！</p>
<p>Objective-C/Swift技术开发交流群201556264，讨论何种技术并不受限，欢迎各位大牛百家争鸣！</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">刚刚在线工作室</a>，欢迎关注或提出建设性意见！</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">刚刚在线论坛</a>, 欢迎踊跃提问或解答！</p>
<p>如有转载，请注明出处，谢谢！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/YYKit/">YYKit</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/OC/">OC</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-iOS可复用且高度解耦的用户统计实现" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/05/03/iOS可复用且高度解耦的用户统计实现/" class="article-date">
  	<time datetime="2016-05-02T16:00:00.000Z" itemprop="datePublished">2016-05-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/03/iOS可复用且高度解耦的用户统计实现/">iOS可复用且高度解耦的用户统计实现</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <video width="498" height="510 " src="http://7xqjid.com1.z0.glb.clouddn.com/2016_04_14.mp4 " poster=" " controls="controls"><br><br></video>

<p><br></p>
<p>说好的两篇的。本文接上篇博文RunTime机制及使用梳理。很久以前看到一篇类似的文章，不知道是不是这一篇。</p>
<hr>
<p>用户行为统计(User Behavior Statistics, UBS)一直是移动互联网产品中必不可少的环节，也俗称埋点。在保证移动端流量不会受较大影响的前提下，PM们总是希望埋点覆盖面越广越好。目前常规的做法是将埋点代码封装成工具类，但凡工程中需要埋点(如点击事件、页面跳转)的地方都插入埋点代码。一旦项目越来越复杂，你会发现埋点的代码散落在程序的各个角落，不利于维护以及复用。本文旨在探讨利用iOS的运行时机制实现一种可复、解耦、容易维护的用户统计方案。探讨毕竟是探讨，欢迎到在简书留言讨论。本文虽有些长却是用心之作，希望你有耐心看完。</p>
<p>注：本文需要一些iOS的Runtime基础<br>该方案的完成将会用到以下知识：</p>
<p><code>Method Swizzling(Hook)</code></p>
<p>单元测试</p>
<h4 id="u4E00_u3001_u5E38_u89C4_u57CB_u70B9_u505A_u6CD5"><a href="#u4E00_u3001_u5E38_u89C4_u57CB_u70B9_u505A_u6CD5" class="headerlink" title="一、常规埋点做法"></a>一、常规埋点做法</h4><p>接着开头的话题，我们先回顾一下主流的埋点是怎么做的。我粗糙地将埋点分为两种：1、页面统计，包括页面停留时间、页面进入次数；2、交互事件统计，包括单击、双击、手势交互等。</p>
<h6 id="1_29_u5E38_u89C4_u9875_u9762_u7EDF_u8BA1_u57CB_u70B9"><a href="#1_29_u5E38_u89C4_u9875_u9762_u7EDF_u8BA1_u57CB_u70B9" class="headerlink" title="1)常规页面统计埋点"></a>1)常规页面统计埋点</h6><p>以统计页面进入次数为例，最简单粗暴的做法是在所有页面的<code>viewDid</code>ppear1:以及<code>viewDidDisappear</code>:中分别埋点，将自己对应的pageID上传给服务端。代码大概长酱紫：</p>
<p><code>@implementation HomeViewController</code></p>
<p><code>- (void)viewDidAppear:(BOOL)animated</code></p>
<p><code>{</code></p>
<p>   <code>[super viewWillAppear:animated];</code></p>
<p>   <code>[WUserStatistics sendEventToServer:@&quot;PAGE_EVENT_HOME_ENTER&quot;];</code><br><code>}</code></p>
<p><code>- (void)viewDidDisappear:(BOOL)animated</code></p>
<p><code>{</code></p>
<p>   <code>[super viewDidDisappear:animated];</code></p>
<p>   <code>[WUserStatistics sendEventToServer:@&quot;PAGE_EVENT_HOME_LEAVE&quot;];</code></p>
<p><code>}</code></p>
<p><code>@end</code></p>
<p><code>+[WUserStatistics sendEventToServer:]</code>封装网络请求，将ID上传给服务器。上述方案有以下弊端：</p>
<p>1、复用性差。这部分埋点代码很难给其他项目复用<br>2、工作量大。尤其当页面较多时，需要修改的代码较多<br>3、引入“脏代码”，不易维护<br>第3点提到的“脏代码”意思是用户行为分析这种业务其实跟主业务没太大关系，不应该保持如此高的耦合度，因为这些代码会干扰我们对项目主业务的维护。这个我个人看法。</p>
<p>2)常规交互事件埋点<br>常规做法一般在交互事件的selector中获取该事件的ID并上传给服务端，代码大概长酱紫：</p>
<p><code>- (IBAction)onFavBtnPressed:(id)sender</code></p>
<p><code>{</code></p>
<p>   <code>[WUserStatistics sendEventToServer:@&quot;CTRL_EVENT_HOME_FAV&quot;];</code></p>
<p>   <code>//...do other things</code></p>
<p><code>}</code></p>
<p>稍微大一点的APP如果采用这种方式，那诸如此类的埋点代码将遍地都是。它的缺点参考页面统计埋点部分，其复用性基本为零，也就是在新项目中根本无法复用埋点代码。</p>
<p>小总结一下，采用常规的做法虽然直观方便，但在可复用性、可维护性等方面有所欠缺。在我看来，借助运行时可以很好地避开这些缺点。</p>
<h4 id="u4E8C_u3001Method_Swizzling_u3001Hook_u4E0E_u4EE3_u7801_u6CE8_u5165"><a href="#u4E8C_u3001Method_Swizzling_u3001Hook_u4E0E_u4EE3_u7801_u6CE8_u5165" class="headerlink" title="二、Method Swizzling、Hook与代码注入"></a>二、Method Swizzling、Hook与代码注入</h4><p>由于Runtime知识不属于本文的重点，这里只简单介绍。</p>
<p>在iOS中，我们可以在运行时替换两个方法的实现，达到“勾住”某个方法并注入代码的目的。具体做法是:</p>
<p>重载类的<code>+(void)load</code>方法，在程序加载到内存时利用Runtime的<code>method_exchangeImplementations</code>等接口将方法(设为M)的实现互相交换。当方法M被调用时就会被勾住(Hook)，执行我们的方法。<br>这种技术也称为<code>Method Swizzling</code>，属于面向切面编程(Aspect-Oriented Programming)的一种实现。对应的类是Aspects。</p>
<p>替换两个方法的实现，代码一般长酱紫：</p>
<p><code>@interface WHookUtility : NSObject</code></p>
<p><code>+ (void)swizzlingInClass:(Class)cls originalSelector:(SEL)originalSelector swizzledSelector:(SEL)swizzledSelector;</code></p>
<p><code>@end</code></p>
<p><code>@implementation WHookUtility</code></p>
<p><code>+ (void)swizzlingInClass:(Class)cls originalSelector:(SEL)originalSelector swizzledSelector:(SEL)swizzledSelector{</code></p>
<p>   <code>Class class = cls;</code></p>
<p>   <code>Method originalMethod = class_getInstanceMethod(class, originalSelector);</code></p>
<p>   <code>Method swizzledMethod = class_getInstanceMethod(class, swizzledSelector);</code></p>
<pre><code>` BOOL didAddMethod =`
` class_addMethod(class,
                originalSelector,
                method_getImplementation(swizzledMethod),
                method_getTypeEncoding(swizzledMethod));`
</code></pre><p>   <code>if (didAddMethod) {</code></p>
<pre><code>    ` class_replaceMethod(class,
                        swizzledSelector,
                        method_getImplementation(originalMethod),
                        method_getTypeEncoding(originalMethod));`
} else {
    method_exchangeImplementations(originalMethod, swizzledMethod);
}
</code></pre><p>}<br>@end<br>这个WHookUtility工具类下文会用到。比如现在我们要勾住UIViewController的viewWillAppear:方法，可以这样做：</p>
<p><code>@implementation UIViewController (userStastistics)</code></p>
<p><code>+ (void)load {</code></p>
<p>   <code>static dispatch_once_t onceToken;</code></p>
<p>   <code>dispatch_once(&amp;onceToken, ^{</code></p>
<pre><code>`SEL originalSelector = @selector(viewWillAppear:);`

`SEL swizzledSelector = @selector(swiz_viewWillAppear:);`

`[WHookUtility swizzlingInClass:[self class] originalSelector:originalSelector swizzledSelector:swizzledSelector];`
</code></pre><p><code>});</code><br><code>}</code></p>
<p><code>#pragma mark - Method Swizzling</code></p>
<p><code>- (void)swiz_viewWillAppear:(BOOL)animated</code><br><code>{</code></p>
<pre><code>`NSLog(@&quot;...............&quot;);`

`[self swiz_viewWillAppear:animated];`
</code></pre><p><code>}</code><br><code>@end</code></p>
<p>更多关于Runtime、method swizzling、面向切面编程的介绍请参考这里</p>
<h4 id="u4E09_u3001_u57FA_u4E8E_u8FD0_u884C_u65F6_u7684_u57CB_u70B9_u65B9_u6848"><a href="#u4E09_u3001_u57FA_u4E8E_u8FD0_u884C_u65F6_u7684_u57CB_u70B9_u65B9_u6848" class="headerlink" title="三、基于运行时的埋点方案"></a>三、基于运行时的埋点方案</h4><p>为了便于下文叙述，先引入一个简单的项目，共有两个页面(HomeViewController，DetailViewController)，如下：</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_03_04.gif?attname=" alt=""></p>
<p>需求是:</p>
<p>统计两个页面的展示与离开次数<br>统计收藏、分享单击事件的次数<br>对现有工程代码影响越小越好</p>
<p>1)统计两个页面的展示与离开次数</p>
<p>这部分应该比较直观了，摒弃掉在每个controller中埋点的方式，我们对UIViewController添加category从而Hook到viewWillAppear:与viewWillDisappear:。在这两个方法中注入埋点代码：</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_03_05.png?attname=" alt=""></p>
<p>这时候问题来了，项目中每个页面都会有自己的页面事件编号(pageEventID)，此处的埋点代码如何知道要发送什么pageEventID给服务端呢？轻松祭出if-else神器：</p>
<p><code>- (NSString *)pageEventID:(BOOL)bEnterPage</code><br><code>{</code></p>
<p>``<br>    NSString *selfClassName = NSStringFromClass([self class]);</p>
<pre><code>NSString *pageEventID = nil;

if ([selfClassName isEqualToString:@&quot;HomeViewController&quot;]) {

    pageEventID = bEnterPage ? @&quot;EVENT_HOME_ENTER_PAGE&quot; : @&quot;EVENT_HOME_LEAVE_PAGE&quot;;

} else if ([selfClassName isEqualToString:@&quot;DetailViewController&quot;]) {

    pageEventID = bEnterPage ? @&quot;EVENT_DETAIL_ENTER_PAGE&quot; : @&quot;EVENT_DETAIL_LEAVE_PAGE&quot;;
}
//else if (&lt;#expression#&gt;)...
``
</code></pre><p><code>}</code></p>
<p>当然，我们可以有更优雅的方式，比如用一个配置表替代上面一长串的if判断，这样无论页面数怎么增加，代码始终是那么一小段。我们新建一个WGlobalUserStatisticsConfig.plist的配置表来存放每个页面在进入以及离开时的pageEventID，结构如下：</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_03_06.png?attname=" alt=""><br>)</p>
<p>因此，页面进出统计中获取pageEventID的代码始终是以下这几句：</p>
<p><code>- (NSString *)pageEventID:(BOOL)bEnterPage</code><br><code>{</code></p>
<p>  <code>NSDictionary *configDict = [self dictionaryFromUserStatisticsConfigPlist];</code></p>
<p>  <code>NSString *selfClassName = NSStringFromClass([self class]);</code></p>
<p>  <code>return configDict[selfClassName][@&quot;PageEventIDs&quot;][bEnterPage ? @&quot;Enter&quot; : @&quot;Leave&quot;];</code></p>
<p><code>}</code></p>
<p><code>- (NSDictionary *)dictionaryFromUserStatisticsConfigPlist</code><br><code>{</code></p>
<p>   <code>NSString *filePath = [[NSBundle mainBundle] pathForResource:@&quot;WGlobalUserStatisticsConfig&quot; ofType:@&quot;plist&quot;];</code></p>
<p>   <code>NSDictionary *dic = [NSDictionary dictionaryWithContentsOfFile:filePath];</code></p>
<p>   <code>return dic;</code><br><code>}</code></p>
<p>效果如下：</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_03_07.gif?attname=" alt=""></p>
<p>以上就是完成了页面进出统计的埋点，并且达到了我们的第三点预期：对现有代码基本无影响。通过Method Swizzling的方式现有的工程甚至不需要import任何文件！后期代码变动时需要维护的仅仅是plist配置表。</p>
<p>2)统计收藏、分享单击事件的次数<br>与上一节思路一致，要做到解耦显然需要通过category+hook来实现。本文demo中收藏跟分享都是UIButton类型，可以考虑添加UIButton的catogory。但更好的方式是添加UIControl的category，这样可以让埋点代码覆盖到所有UIControl的子类中去，比如button、switch、segment等，提高复用性。<br>既然要hook，那就要清楚到底要hookUIControl的哪(几)个方法，只有部分方法是满足埋点需求的，最好是所hook的方法能提供target、actionName等信息。这是个尝试的过程。<br>UIControl的方法列表有以下：</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2015_05_03_08.png?attname=" alt=""></p>
<p>通过观察方法名和参数，我们有理由怀疑是倒数第二个，因其携带了不少貌似有价值的信息：</p>
<p><code>- (void)sendAction:(SEL)action to:(nullable id)target forEvent:(nullable UIEvent *)event;</code></p>
<p>于是写出测试代码看看：</p>
<p><code>@implementation UIControl (userStastistics)</code></p>
<p><code>+ (void)load {</code> </p>
<p><code>static dispatch_once_t onceToken;
    dispatch_once(&amp;onceToken, ^{
        SEL originalSelector = @selector(sendAction:to:forEvent:);
        SEL swizzledSelector = @selector(swiz_sendAction:to:forEvent:);
        [WHookUtility swizzlingInClass:[self class] originalSelector:originalSelector swizzledSelector:swizzledSelector];
    });</code><br><code>}</code></p>
<p><code>#pragma mark - Method Swizzling</code></p>
<p><code>- (void)swiz_sendAction:(SEL)action to:(id)target forEvent:(UIEvent *)event;</code></p>
<p><code>{</code><br>    //插入埋点代码</p>
<p>   <code>[self performUserStastisticsAction:action to:target forEvent:event];</code></p>
<pre><code>`[self swiz_sendAction:action to:target forEvent:event];`
</code></pre><p><code>}</code></p>
<p><code>- (void)performUserStastisticsAction:(SEL)action to:(id)target forEvent:(UIEvent *)event;</code></p>
<p><code>{</code></p>
<p>   <code>NSLog(@&quot;\n***hook success.\n[1]action:%@\n[2]target:%@ \n[3]event:%ld&quot;, NSStringFromSelector(action), target, (long)event);</code></p>
<p><code>}</code></p>
<p><code>@end</code></p>
<p>Log如下图：</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2015_05_03_09.png?attname=" alt=""></p>
<p>可以看到，通过category+method swizzling的方式在没有修改现有工程任何代码的情况下已经成功Hook到所有点击事件，在Hook代码中我们知道了一个点击事件的target也就是ViewController，也知道了点击事件的响应函数名，知道了点击的TouchSet。这些信息已经能满足埋点需求了。<br>与页面统计埋点类似，我们同样采用plist配置表的方式避免一大长串的if-else判断：</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2015_05_03_10.png?attname=" alt=""></p>
<p>有了这张配置表就很容易得到某次单击事件的事件ID(ControlEventID)：</p>
<p><code>NSString *actionString = NSStringFromSelector(action);</code></p>
<p>//获取SEL string</p>
<p><code>NSString *targetName = NSStringFromClass([target class]);</code></p>
<p>//viewController name</p>
<p><code>NSDictionary *configDict = [self dictionaryFromUserStatisticsConfigPlist];</code></p>
<p><code>eventID = configDict[targetName][@&quot;ControlEventIDs&quot;][actionString];</code></p>
<p>事实上，我把某个页面单元的所有事件ID分成了两类：页面事件ID(PageEventIDs，页面的进出等)、交互事件ID(ControlEventIDs，单击、双击、手势等)。分类有助于下文使用单元测试(Unit Test)进行自动化后期维护。<br>埋点效果如图：</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2015_05_03_11.png?attname=" alt=""></p>
<p>到这里先做了阶段性的总结，本文提出的思路有以下优越性：</p>
<p>与工程代码基本解耦，避免引入“脏代码”<br>即使后期工程代码发生重构，需要修改的仅仅是plist配置表<br>维护配置表比维护散落在工程各个角落的代码简单</p>
<p>四、基于单元测试的后期维护<br>俗话说，创业难守业更难。前面的思路基本可以完成初步的埋点需求。但是在实际项目中代码重构是很频繁的。这意味着在多人协作开发、代码重构频繁的项目中响应事件方法甚至页面名称都可能被改掉，造成事件ID获取不到导致埋点失效。<br>代码变动的情况无非以下几种(这里只介绍响应事件发生改变的情况)：</p>
<p>1、响应事件方法名称改变或者删除<br>比如收藏事件原先是onFavBtnPressed:，之后被改成onFavouriteBtnPressed:。代码发生变动但是plist配置表中由于开发人员疏忽忘记同步修改了。这种疏忽在开发压力大进度赶的情况下是有很大概率发生的。由于代码与配置表不匹配将导致eventID为nil。在这种情况下单元测试就很有必要了，使用完备的测试用例能在发版前检测到这种不匹配情况从而避免埋点失效。<br>在单元测试中我们首先读取plist配置文件，遍历所有的页面。在一个页面内遍历所有的ControlEventIDs，对每个响应函数名进行respondsToSelector:判断：</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2015_05_03_12.png?attname=" alt=""></p>
<p>单测代码如下：</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_03_19.png?attname=" alt=""></p>
<p>我们来测试一下，如果把HomeViewController的onFavBtnPressed:改成onMyFavBtnPressed:后单元测试的结果就是：</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2015_05_03_13.png?attname=" alt=""></p>
<p>这种改变给单测轻松捕捉到了，</p>
<p>只要XCTAssert的log够详细，维护起来其实相当轻松的。<br>上图中的log已经明确指出-[HomeViewController onFavBtnPressed:]方法发生了改变。</p>
<p>2、代码中新增了响应事件<br>这种情况常见于新版本中有新的埋点需求。如果代码中新增了响应事件并且该响应事件是在PM要求的埋点列表中，但是plist有可能会漏掉该事件。这种情况是比较棘手的。上一种情况是基于plist列表去校验代码，这里就要反过来，根据代码去校验plist是否有缺失。但问题来了，一个项目中响应函数往往是非常多的，并不是任何响应函数都需要埋点。需要埋点的响应函数与其他响应函数并没有区别。<br>对于这种情况，一种方式是加强code review避免忘记往配置表中添加埋点(这简直就是废话)；一种是：要求埋点响应函数的方法名中包含约定的字符串，比如收藏事件的方法名为onFavBtnPressed_UA:表示这个事件是需要埋点的。然后在单元测试中使用运行时APIclass_copyMethodList取出标记了_UA的所有函数，随后到plist中校验是否存在。不存在则表示测试用例不通过，提示开发人员校验。</p>
<p>代码略。如果对单元测试不熟悉，可以参考单元测试</p>
<p>小总结：<br>合理的单元测试可以为本文方案的后期维护减轻相当大的负担，测试用例的完备性很重要，需要用心设计考虑周全。</p>
<p>五、结语<br>以上就是结合运行时所设计出的用户统计思路全部内容。应该说该方案的可复用性与解耦程度都是不错的，既适合于新建的工程，也适合于已经创建的工程。看起来内容多，其实总结起来无非几个步骤：plist配置表+Hook+单元测试。利用Method Swizzling把埋点代码集中管理其实也是合理的，有利于专人开发、跟踪及维护。当然以上思路只考虑简单的情形，更复杂的情况就需要变通了，但总体思路就是如此。<br>思路可能不完美，但作为一种尝试也未尝不可。路都是走出来的。</p>
<p>本文demo地址：<a href="https://github.com/weng1250/UserStatisticsWithRuntime" target="_blank" rel="external">https://github.com/weng1250/UserStatisticsWithRuntime</a></p>
<p><br></p>
<blockquote>
<p>本文系转载</p>
<p>作者：编程小翁 </p>
<p>来源：<a href="http://www.jianshu.com/p/0497afdad36d" target="_blank" rel="external">http://www.jianshu.com/p/0497afdad36d</a></p>
</blockquote>
<hr>
<p>如有任何疑问或问题请联系我:fishnewsdream@gmail.com,欢迎交流，共同提高！</p>
<p>Objective-C/Swift技术开发交流群201556264，讨论何种技术并不受限，欢迎各位大牛百家争鸣！</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">刚刚在线工作室</a>，欢迎关注或提出建设性意见！</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">刚刚在线论坛</a>, 欢迎踊跃提问或解答！</p>
<p>如有转载，请注明出处，谢谢！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Aspects-转载/">Aspects,转载</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/进阶/">进阶</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Runtime机制及使用梳理" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/05/03/Runtime机制及使用梳理/" class="article-date">
  	<time datetime="2016-05-02T16:00:00.000Z" itemprop="datePublished">2016-05-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/03/Runtime机制及使用梳理/">RunTime机制及使用梳理</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <video width="498" height="510 " src="http://7xqjid.com1.z0.glb.clouddn.com/2016_04_14.mp4 " poster=" " controls="controls"><br><br></video>

<p><br></p>
<p>从接触iOS至今，关于RunTime少说也集中研究了十几次。如果只把它作为会用的话，其实根本不需要花太多时间。上周团队里有小伙伴分享了RunTime，觉得很不错，每次都会有收获。书写长篇技术博文极其浪费时间，在此我就转载两篇觉得不错的文章了，没这么多的时间，重要的是也无法写的更好！</p>
<blockquote>
</blockquote>
<p>相比“凌波微步”的swift，Object-C被誉为“如来神掌”。传说Runtime就是支持这“如来神掌”说法的最好体现。听起来总是这么的神秘高级，于是总能在各个论坛看到碎片资料，时间一长总记不住哪里是哪里，每次都要打开还几个网页。这中记不住显然是知识体系还不完整重要体现。还是自己从Runtime的思想到动手代码呈现上做出总结尚为上策。</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_03_01.png?attname=" alt=""></p>
<h4 id="u4E00-_u57FA_u672C_u6982_u5FF5"><a href="#u4E00-_u57FA_u672C_u6982_u5FF5" class="headerlink" title="一.基本概念"></a>一.基本概念</h4><blockquote>
<ul>
<li>RunTime简称运行时,就是系统在运行的时候的一些机制，其中最主要的是消息机制。</li>
<li>对于C语言，函数的调用在编译的时候会决定调用哪个函数（ C语言的函数调用请看这里 ）。编译完成之后直接顺序执行，无任何二义性。</li>
<li>OC的函数调用成为消息发送。属于动态调用过程。在编译的时候并不能决定真正调用哪个函数（事实证明，在编 译阶段，OC可以调用任何函数，即使这个函数并未实现，只要申明过就不会报错。而C语言在编译阶段就会报错）。</li>
<li>只有在真正运行的时候才会根据函数的名称找 到对应的函数来调用。</li>
</ul>
</blockquote>
<p>官网文档还提供关于传统和现代版本Runtime的说明</p>
<blockquote>
<ul>
<li>In the legacy runtime, if you change the layout of instance variables in a class, you must recompile classes that inherit from it.</li>
<li>In the modern runtime, if you change the layout of instance variables in a class, you do not have to recompile classes that inherit from it.<br>In addition, the modern runtime supports instance variable synthesis for declared properties (see Declared Properties in The Objective-C Programming Language).</li>
</ul>
</blockquote>
<h4 id="u4E8C-_u77E5_u6653OC_u7684_u65B9_u6CD5_u8C03_u7528_u5728Runtime_u4E2D_u5177_u4F53_u7684_u5B9E_u73B0"><a href="#u4E8C-_u77E5_u6653OC_u7684_u65B9_u6CD5_u8C03_u7528_u5728Runtime_u4E2D_u5177_u4F53_u7684_u5B9E_u73B0" class="headerlink" title="二.知晓OC的方法调用在Runtime中具体的实现"></a>二.知晓OC的方法调用在Runtime中具体的实现</h4><h6 id="1-OC_u4EE3_u7801_u8C03_u7528_u4E00_u4E2A_u65B9_u6CD5"><a href="#1-OC_u4EE3_u7801_u8C03_u7528_u4E00_u4E2A_u65B9_u6CD5" class="headerlink" title="1.OC代码调用一个方法"></a>1.OC代码调用一个方法</h6><p><code>[self.loginBt login];</code></p>
<h6 id="2-_u5728_u7F16_u8BD1_u65F6RunTime_u4F1A_u5C06_u4E0A_u8FF0_u4EE3_u7801_u8F6C_u5316_u6210_5B_u53D1_u9001_u6D88_u606F_5D"><a href="#2-_u5728_u7F16_u8BD1_u65F6RunTime_u4F1A_u5C06_u4E0A_u8FF0_u4EE3_u7801_u8F6C_u5316_u6210_5B_u53D1_u9001_u6D88_u606F_5D" class="headerlink" title="2.在编译时RunTime会将上述代码转化成[发送消息]"></a>2.在编译时RunTime会将上述代码转化成[发送消息]</h6><p><code>objc_msgSend(self.loginB,@selector(login));</code></p>
<h3 id="u4E09-_u5E38_u89C1_u7684_u4F5C_u7528"><a href="#u4E09-_u5E38_u89C1_u7684_u4F5C_u7528" class="headerlink" title="三.常见的作用"></a>三.常见的作用</h3><p>既然是“如来神掌”，简直可以无法无天啦，当街拦下一个人问道“这是马还是鹿啊？”，那人看是Runtime大人惧怕道“Runtime大人，您说是马就是马，是鹿就是鹿~”。Runtime大快“wow哈哈哈~，见你乖巧，我也不为难于你。你缺头驴是吧？，本大人现在造一头送于你，迁回家便是！喔~哈哈哈”。<br>呵呵，扯远了，回到Runtime作用上。无所不能的事情就不一一介绍了，梳理下较为可能用的几个地方：</p>
<blockquote>
<ul>
<li><ol>
<li>动态的添加对象的成员变量和方法</li>
</ol>
</li>
<li><ol>
<li>动态交换两个方法的实现</li>
</ol>
</li>
<li><ol>
<li>实现分类也可以添加属性</li>
</ol>
</li>
<li><ol>
<li>实现NSCoding的自动归档和解档</li>
</ol>
</li>
<li><ol>
<li>实现字典转模型的自动转换</li>
</ol>
</li>
</ul>
</blockquote>
<h4 id="u56DB-_u7F16_u5199_u4EE3_u7801_u5B9E_u73B0"><a href="#u56DB-_u7F16_u5199_u4EE3_u7801_u5B9E_u73B0" class="headerlink" title="四.编写代码实现"></a>四.编写代码实现</h4><h5 id="1-__u52A8_u6001_u53D8_u91CF_u63A7_u5236"><a href="#1-__u52A8_u6001_u53D8_u91CF_u63A7_u5236" class="headerlink" title="1. 动态变量控制"></a>1. 动态变量控制</h5><h6 id="1_uFF09Sense_uFF1A"><a href="#1_uFF09Sense_uFF1A" class="headerlink" title="1）Sense："></a>1）Sense：</h6><p><code>Teacher: What&#39;s your name?</code></p>
<p><code>XiaoMing: My name is XiaoMing.</code></p>
<p><code>Teacher: Pardon?</code></p>
<p><code>XiaoMing: My name is __</code></p>
<p>在程序当中，假设XiaoMing的name原来的值为XiaoMing，后来被Runtime偷换了一个名字叫Minggo。那么，Runtime是如何做到的呢？</p>
<h6 id="2_uFF09Step_uFF1A"><a href="#2_uFF09Step_uFF1A" class="headerlink" title="2）Step："></a>2）Step：</h6><p>①动态获取XiaoMing类中的所有属性[当然包括私有]</p>
<p><code>Ivar *ivar = class_copyIvarList([self.xiaoMing class], &amp;count);</code></p>
<p>②遍历属性找到对应name字段</p>
<p><code>const char *varName = ivar_getName(var);</code></p>
<p>③修改对应的字段值成Minggo</p>
<p><code>object_setIvar(self.xiaoMing, var, @&quot;Minggo&quot;);</code></p>
<h6 id="3_uFF09Show_Code_uFF1A"><a href="#3_uFF09Show_Code_uFF1A" class="headerlink" title="3）Show Code："></a>3）Show Code：</h6><p><code>-(void)answer{</code></p>
<pre><code>unsigned int count = 0;

Ivar *ivar = class_copyIvarList([self.xiaoMing class], &amp;count);

for (int i = 0; i&lt;count; i++) {

    Ivar var = ivar[i];

    const char *varName = ivar_getName(var);

    NSString *name = [NSString stringWithUTF8String:varName];

    if ([name isEqualToString:@&quot;_englishName&quot;]) {

        object_setIvar(self.xiaoMing, var, @&quot;Minggo&quot;);

        break;
    }
}
NSLog(@&quot;XiaoMing first answer is %@&quot;,self.xiaoMing.englishName);

self.nameTf.text = self.xiaoMing.englishName;
</code></pre><p><code>}</code></p>
<h5 id="2-__u52A8_u6001_u4EA4_u6362_u65B9_u6CD5"><a href="#2-__u52A8_u6001_u4EA4_u6362_u65B9_u6CD5" class="headerlink" title="2. 动态交换方法"></a>2. 动态交换方法</h5><h6 id="1_uFF09Sense_uFF1A-1"><a href="#1_uFF09Sense_uFF1A-1" class="headerlink" title="1）Sense："></a>1）Sense：</h6><p><code>Teacher: What&#39;s your name?</code></p>
<p><code>XiaoMing: My name is XiaoMing.</code></p>
<p><code>Teacher: Pardon?</code></p>
<p><code>XiaoMing: My name is __</code></p>
<p>在程序当中，假设XiaoMing的第一次回答为firstSay，后来被Runtime交换了一个名字叫secondSay的方法，最终再调用firstSay的时候，其实是调用了secondSay的实现。那么，Runtime是如何做到的呢？</p>
<p>######2）Step：</p>
<p>①动态找到firstSay和secondSay方法</p>
<p><code>Method m1 = class_getInstanceMethod([self.xiaoMing class], @selector(firstSay));</code> </p>
<p><code>Method m2 = class_getInstanceMethod([self.xiaoMing class], @selector(secondSay));</code></p>
<p>②交换两个方法</p>
<p><code>method_exchangeImplementations(m1, m2);</code></p>
<h6 id="3_uFF09Show_Code_uFF1A-1"><a href="#3_uFF09Show_Code_uFF1A-1" class="headerlink" title="3）Show Code："></a>3）Show Code：</h6><p><code>-(void)answer{</code></p>
<pre><code>Method m1 = class_getInstanceMethod([self.xiaoMing class], @selector(firstSay));
Method m2 = class_getInstanceMethod([self.xiaoMing class], @selector(secondSay));

method_exchangeImplementations(m1, m2);
NSString *secondName = [self.xiaoMing firstSay];

self.nameTf.text = secondName;
NSLog(@&quot;XiaoMing:My name is %@&quot;,secondName);
</code></pre><p> <code>}</code></p>
<h5 id="3-__u52A8_u6001_u6DFB_u52A0_u65B9_u6CD5"><a href="#3-__u52A8_u6001_u6DFB_u52A0_u65B9_u6CD5" class="headerlink" title="3. 动态添加方法"></a>3. 动态添加方法</h5><h6 id="1_uFF09Sense_uFF1A-2"><a href="#1_uFF09Sense_uFF1A-2" class="headerlink" title="1）Sense："></a>1）Sense：</h6><p><code>Teacher: Where is LiLei from?</code></p>
<p><code>XiaoMing: I don&#39;t know.</code></p>
<p><code>Teacher: Guess?.</code></p>
<p><code>LiHua: He is from __</code></p>
<p>在程序当中，假设XiaoMing的中没有guess这个方法，后来被Runtime添加一个名字叫guess的方法，最终再调用guess方法做出相应。那么，Runtime是如何做到的呢？</p>
<p>2）Step：</p>
<p>①动态给XiaoMing类中添加guess方法：</p>
<p><code>class_addMethod([self.xiaoMing class], @selector(guess), (IMP)guessAnswer, &quot;v@:&quot;);</code></p>
<p>这里参数地方说明一下： (IMP)guessAnswer 意思是guessAnswer的地址指针; “v@:” 意思是，v代表无返回值void，如果是i则代表int；@代表 id sel; : 代表 SEL _cmd; “v@:@@” 意思是，两个参数的没有返回值。</p>
<p>②调用guess方法响应事件：</p>
<p><code>[self.xiaoMing performSelector:@selector(guess)];</code> </p>
<p>③编写guessAnswer的实现：</p>
<p><code>void guessAnswer(id self,SEL _cmd){</code></p>
<pre><code>NSLog(@&quot;He is from GuangTong&quot;); 
</code></pre><p><code>}</code></p>
<p>这个有两个地方留意一下： 1.void的前面没有+、-号，因为只是C的代码。 2.必须有两个指定参数(id self,SEL _cmd)</p>
<p>3）Show Code：</p>
<p><code>-(void)answer{</code></p>
<pre><code>class_addMethod([self.xiaoMing class], @selector(guess), (IMP)guessAnswer, &quot;v@:&quot;);

if ([self.xiaoMing respondsToSelector:@selector(guess)]) {

    [self.xiaoMing performSelector:@selector(guess)];

} else{
    NSLog(@&quot;Sorry,I don&apos;t know&quot;);
}
self.cityTf.text = @&quot;GuangTong&quot;;
</code></pre><p><code>}</code></p>
<p><code>void guessAnswer(id self,SEL _cmd){</code></p>
<pre><code>NSLog(@&quot;He is from GuangTong&quot;);
</code></pre><p><code>}</code></p>
<h5 id="4-__u52A8_u6001_u4E3ACategory_u6269_u5C55_u52A0_u5C5E_u6027"><a href="#4-__u52A8_u6001_u4E3ACategory_u6269_u5C55_u52A0_u5C5E_u6027" class="headerlink" title="4. 动态为Category扩展加属性"></a>4. 动态为Category扩展加属性</h5><p>这一点上有两点要表达一下：第一，XCode运行你在Category的.h文件申明@Property，编译通过，但运行时如果没有Runtime处理，进行赋值取值，就马上报错。第二，这一点是iOS面试当中经常面到的问题：如何给扩展添加属性？。</p>
<h6 id="1_uFF09Sense_uFF1A-3"><a href="#1_uFF09Sense_uFF1A-3" class="headerlink" title="1）Sense："></a>1）Sense：</h6><p><code>Teacher: What&#39;s your Chinese name?</code></p>
<p><code>XiaoMing: I have no one.</code></p>
<p><code>LiHua: You should have one.</code></p>
<p><code>LiHua: Your Chinese name is __</code></p>
<p>在程序当中，假设XiaoMing的中没有chineseName这个属性，后来被Runtime添加一个名字叫chineseName的属性。那么，Runtime是如何做到的呢？</p>
<h6 id="2_uFF09Step_uFF1A-1"><a href="#2_uFF09Step_uFF1A-1" class="headerlink" title="2）Step："></a>2）Step：</h6><p>①申明chineseName属性</p>
<p> <code>#import &quot;XiaoMing.h&quot;</code></p>
<p><code>@interface XiaoMing (MutipleName)</code></p>
<p><code>@property(nonatomic,copy) NSString *chineseName;</code></p>
<p><code>@end</code></p>
<p>②动态添加属性和实现方法</p>
<p><code>#import &quot;XiaoMing+MutipleName.h&quot;</code></p>
<p><code>#import &lt;objc/runtime.h&gt;</code></p>
<p><code>@implementation XiaoMing (MutipleName)</code></p>
<p><code>char cName;</code></p>
<p><code>-(void)setChineseName:(NSString *) chineseName{</code></p>
<p> <code>objc_setAssociatedObject(self, &amp;cName, chineseName, OBJC_ASSOCIATION_COPY_NONATOMIC);</code></p>
<p><code>}</code></p>
<p><code>-(NSString *)chineseName{</code></p>
<p>   <code>return objc_getAssociatedObject(self, &amp;cName);</code><br><code>}</code></p>
<p><code>@end</code> </p>
<p>③使用chineseName属性</p>
<p><code>-(void)answer{</code></p>
<p><code>NSLog(@&quot;My Chinese name is %@&quot;,self.xiaoMing.chineseName);</code></p>
<p>   <code>self.chineseNameTf.text = self.xiaoMing.chineseName;</code></p>
<p><code>}</code></p>
<p>3）Show Code：</p>
<p>上边就是最要的Code了。以下更精彩。</p>
<p>三.效果图更直观<br><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_03_02.gif?attname=" alt=""></p>
<p>四.源码下载地址更详细</p>
<p><a href="https://github.com/minggo620/iOSRuntimeLearn.git" target="_blank" rel="external">https://github.com/minggo620/iOSRuntimeLearn.git</a></p>
<blockquote>
<p>本文系转载</p>
<p>作者：minggo620</p>
<p>来源：<a href="https://github.com/minggo620/iOSRuntimeLearn" target="_blank" rel="external">https://github.com/minggo620/iOSRuntimeLearn</a></p>
</blockquote>
<hr>
<p>如有任何疑问或问题请联系我:fishnewsdream@gmail.com,欢迎交流，共同提高！</p>
<p>Objective-C/Swift技术开发交流群201556264，讨论何种技术并不受限，欢迎各位大牛百家争鸣！</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">刚刚在线工作室</a>，欢迎关注或提出建设性意见！</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">刚刚在线论坛</a>, 欢迎踊跃提问或解答！</p>
<p>如有转载，请注明出处，谢谢！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RunTime-转载/">RunTime,转载</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/进阶/">进阶</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-论地球仪打开的正确姿势" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/05/02/论地球仪打开的正确姿势/" class="article-date">
  	<time datetime="2016-05-01T16:00:00.000Z" itemprop="datePublished">2016-05-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/05/02/论地球仪打开的正确姿势/">论地球仪打开的正确姿势</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><video width="498" height="510 " src="http://7xqjid.com1.z0.glb.clouddn.com/2016_04_14.mp4 " poster=" " controls="controls"><br></video><br><br></p>
<p>刚冒雨去外面买了个地球仪，毕竟五一假期这就结束了，世界这么大，买个地球仪，你不但可以看看，还可以随便转转。刚就尝试了下随便转转，觉得效果还可以。这手感，这速度，这体验，没的说！<br><br><br><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_02.gif?attname=" alt=""><br><br><br><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_02_01.gif?attname=" alt=""><br><br></p>
<p>这不，打算去浪漫之都巴黎逛逛，不到5秒就到了，省时省力。这以后假期，地球仪可能就必不可少了，毕竟这酸爽，也是没谁了~</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016-05-02_02.gif?attname=" alt=""><br><br></p>
<p>网上这旅游攻略给的，对我而言参考价值也不大，严格意义上来说也没有我的区间，于是最终只能选择了朋友圈三日游了！<br><br><br><img src="http://7xqjid.com1.z0.glb.clouddn.com/2016_05_02_03.png?attname=" alt=""></p>
<p>出去旅行总要啪啪啪和拍拍拍的，这每天被刷屏的，以前没见过面的学姐又嫁人了，以前旅游时搭讪的姑娘又换男友了，以前的死党又勾搭起小姨了子了，以前的发小又感慨孩子难带了。曾经学校操场上聊过两句的姑娘一天走了五万多步，这是脚踩风火轮了吗；以前的班主任家门前的丁香花又开了，感情开了几个月了是吗；以前大学同窗又远涉重洋见了各种海外人士，感情装逼不累是吗！由衷的赞美现代科技，这些在现实中早已走失在人海，却还能偶尔无关痛痒的和对方分享彼此的诗和远方，这长久以往积攒了无数不再有交集的ID。在这个通讯如此便捷的时代，更换个手机号可能就再也联系不上对方了，坚定如我，每个月固定为不怎么用的手机号按时交话费，尽管也没什么卵用~</p>
<p>这每次假期快过完都有想重新再来一次的冲动，一鼓作气再而衰三而竭吗，连着三次才过瘾不是。如果人类跑步的速度可以超过光速的话，这回到过去重新开始还是可以憧憬一下的，不过这样如果人类转圈跑的话，岂不是有可能make love with self,这也变相解决了很多问题，估计单身狗的独木舟更加屹立不倒了。</p>
<p>虽说这几天放假，不过百度的运营公关估计也是没闲着。这几天黑百度的浪潮真是此起彼伏，脉脉上对百度的讨伐也是连绵不绝，夹杂着多少不会真正思考的人们。百度的确需要承担责任，但却没见一个媒体敢质疑医院和政府。也是，在天朝现有体制下，就个人而言可能随时得被约谈，就企业而言可能随时得准备背锅。现在的媒体人又有几个能做到公平、公正、客观的呢，前些日子余太的医院接收了一对被撞的环卫工人，被媒体大肆报道是驾驶人酒驾导致，事后却被证明这是环卫工人闯红灯所致。多少新闻是为了吸引眼球而满嘴跑火车，多少人所谓的“圣母”心其实就是人云亦云。现在网上的键盘侠如果每人支援我一块钱的话，估计我现在早已是亿万富翁了。昨晚看了场西甲联赛，那弹幕的精彩程度不亚于比赛本身，各种人身攻击，多半以对方母上为圆心，七大姑八大姨为半径开骂，这是人文素养的缺失！越来越认识到那些心理阴暗、满怀心计的人是因为智力不够，这与以前的认识大致相反。我相信足够聪明的、进化的更好的人，通常会倾向于选择正义、善良这些优良的品质！</p>
<p>现在感觉身体真是大不如前，尽管我还那么的，那么的年轻。很多年轻人通宵上网那跟玩似的，第二天依然溜得飞起。而现在晚睡一会就觉得第二天状态不好。以前一个同事没事就劝诫我说“看你能坚持几年”，没想到这么快就切身感受到了。时间无情的地方，不仅仅是让人衰老，重要的是，犯了错再也不能把原因归结为年轻了。都说年龄越大应该越沉稳了，现在已经实现一半了都，的确是越来越沉了~</p>
<p>又要起身去接余太回府了，讲真，怪浪费时间的，但是却浪费的值得！这大半夜的，听一些抒情悲怆的歌，总有一两句歌词切中要害，感同身受，脑海里翻涌的画面让我想起了旧时光，似曾相识~</p>
<p>平静的日子可能会不甘寂寞，但嘈杂的生活又扰人清幽。所以人生的每个阶段尽力就好，其他的，交给命运！</p>
<hr>
<p>如有任何疑问或问题请联系我:fishnewsdream@gmail.com,欢迎交流，共同提高！</p>
<p>Objective-C/Swift技术开发交流群201556264，讨论何种技术并不受限，欢迎各位大牛百家争鸣！</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">刚刚在线工作室</a>，欢迎关注或提出建设性意见！</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">刚刚在线论坛</a>, 欢迎踊跃提问或解答！</p>
<p>如有转载，请注明出处，谢谢！</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/随笔/">随笔</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2017 含笑饮砒霜
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>
<span id="busuanzi_container_page_pv">
  本文总阅读量<span id="busuanzi_value_page_pv"></span>次
</span>
</footer>

    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>