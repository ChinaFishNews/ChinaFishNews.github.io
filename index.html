<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>å«ç¬‘é¥®ç ’éœœ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="å«ç¬‘é¥®ç ’éœœ">
<meta property="og:url" content="http://chinafish.news/index.html">
<meta property="og:site_name" content="å«ç¬‘é¥®ç ’éœœ">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="å«ç¬‘é¥®ç ’éœœ">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="å«ç¬‘é¥®ç ’éœœ" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://tp1.sinaimg.cn/2185265952/180/5686790740/1" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">å«ç¬‘é¥®ç ’éœœ</a></h1>
		</hgroup>

		
		<p class="header-subtitle">å¦‚æœå¯ä»¥æ‰“é€ éå‡¡åº”ç”¨ ä¸ºä»€ä¹ˆè¦æ­¢æ­¥äºè¿‡å¾—å»</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>èœå•</li>
						<li>æ ‡ç­¾</li>
						
						<li>å‹æƒ…é“¾æ¥</li>
						
						
						<li>å…³äºæˆ‘</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">ä¸»é¡µ</a></li>
				        
							<li><a href="/archives">æ¦‚è§ˆ</a></li>
				        
							<li><a href="/categories/è¿›é˜¶">è¿›é˜¶</a></li>
				        
							<li><a href="/categories/OC">OC</a></li>
				        
							<li><a href="/categories/Swift">Swift</a></li>
				        
							<li><a href="/categories/éšç¬”">éšç¬”</a></li>
				        
							<li><a href="/categories/è½¬è½½">è½¬è½½</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/ChinaFishNews" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/2185265952/profile?topnav=1&wvr=6&is_all=1" title="weibo">weibo</a>
					        
								<a class="twitter" target="_blank" href="https://twitter.com/fishnewsdream" title="twitter">twitter</a>
					        
								<a class="linkedin" target="_blank" href="http://www.linkedin.com/in/æ–°é—»-ä½™-ab2b19101?trk=nav_responsive_tab_profile_pic" title="linkedin">linkedin</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/AVPlayerã€MoviePlayer/" style="font-size: 10px;">AVPlayerã€MoviePlayer</a> <a href="/tags/Asstrill-Shadowsocks-äº‘æ¢¯ï¼Œå£è™æ¼«æ­¥-Lattern-Firefly/" style="font-size: 10px;">Asstrill,Shadowsocks,äº‘æ¢¯ï¼Œå£è™æ¼«æ­¥,Lattern,Firefly</a> <a href="/tags/Autolayout/" style="font-size: 10px;">Autolayout</a> <a href="/tags/BugHD/" style="font-size: 10px;">BugHD</a> <a href="/tags/Cocoapods/" style="font-size: 10px;">Cocoapods</a> <a href="/tags/Coding-net/" style="font-size: 10px;">Coding.net</a> <a href="/tags/Core-Graphics/" style="font-size: 10px;">Core Graphics</a> <a href="/tags/Core-ML-Siri-AVFoundation/" style="font-size: 10px;">Core ML, Siri, AVFoundation</a> <a href="/tags/Core-ML-Vision-äººè„¸è¯†åˆ«/" style="font-size: 10px;">Core ML, Vision,äººè„¸è¯†åˆ«</a> <a href="/tags/Fabric/" style="font-size: 15px;">Fabric</a> <a href="/tags/Gitï¼ŒGitHub-å›æ»šï¼Œä»“åº“/" style="font-size: 10px;">Gitï¼ŒGitHub,å›æ»šï¼Œä»“åº“</a> <a href="/tags/Leaksï¼ŒAllocations-Time-Profiler/" style="font-size: 10px;">Leaksï¼ŒAllocations,Time Profiler</a> <a href="/tags/MMPDeepSleepPreventer-åå°æ— é™è¿è¡Œ/" style="font-size: 10px;">MMPDeepSleepPreventer,åå°æ— é™è¿è¡Œ</a> <a href="/tags/MarkDownã€Mouã€Macdown/" style="font-size: 10px;">MarkDownã€Mouã€Macdown</a> <a href="/tags/Openfire-Spark/" style="font-size: 10px;">Openfire,Spark</a> <a href="/tags/ReactiveCocoa-block/" style="font-size: 10px;">ReactiveCocoa,block</a> <a href="/tags/Reveal/" style="font-size: 10px;">Reveal</a> <a href="/tags/RunLoop-CFRunLoopRef/" style="font-size: 10px;">RunLoop,CFRunLoopRef</a> <a href="/tags/RunTime/" style="font-size: 10px;">RunTime</a> <a href="/tags/UITableView-ResponderChain/" style="font-size: 10px;">UITableView,ResponderChain</a> <a href="/tags/Vision-æ–‡å­—æ£€æµ‹ï¼ŒVNDetectTextRectanglesRequest/" style="font-size: 10px;">Vision,æ–‡å­—æ£€æµ‹ï¼ŒVNDetectTextRectanglesRequest</a> <a href="/tags/Vision-ç›®æ ‡è·Ÿè¸ªï¼ŒVNDetectedObjectObservation-VNSequenceRequestHandler/" style="font-size: 10px;">Vision,ç›®æ ‡è·Ÿè¸ªï¼ŒVNDetectedObjectObservation,VNSequenceRequestHandler</a> <a href="/tags/YYKit/" style="font-size: 10px;">YYKit</a> <a href="/tags/coremlTools-scikitLearn-Python-Anaconda/" style="font-size: 15px;">coremlTools,scikitLearn,Python,Anaconda</a> <a href="/tags/äººå·¥æ™ºèƒ½ï¼Œæœºå™¨å­¦ä¹ ï¼ŒCoreML-Vision/" style="font-size: 10px;">äººå·¥æ™ºèƒ½ï¼Œæœºå™¨å­¦ä¹ ï¼ŒCoreML, Vision</a> <a href="/tags/å…è¯ä¹¦ï¼Œå…æ•°æ®çº¿/" style="font-size: 10px;">å…è¯ä¹¦ï¼Œå…æ•°æ®çº¿</a> <a href="/tags/å¥‡å·§æ·«æŠ€/" style="font-size: 10px;">å¥‡å·§æ·«æŠ€</a> <a href="/tags/å¥‡æŠ€æ·«å·§/" style="font-size: 10px;">å¥‡æŠ€æ·«å·§</a> <a href="/tags/æ‹–å»¶ç—‡/" style="font-size: 10px;">æ‹–å»¶ç—‡</a> <a href="/tags/æ”¯ä»˜å®SDK/" style="font-size: 10px;">æ”¯ä»˜å®SDK</a> <a href="/tags/æœºå™¨å­¦ä¹ ï¼Œäººå·¥æ™ºèƒ½ï¼ŒCoreML-Vision-ARKit/" style="font-size: 10px;">æœºå™¨å­¦ä¹ ï¼Œäººå·¥æ™ºèƒ½ï¼ŒCoreML, Vision, ARKit</a> <a href="/tags/ç¯ä¿¡SDK/" style="font-size: 10px;">ç¯ä¿¡SDK</a> <a href="/tags/è£…é€¼ï¼Œç‰¹æŠ€/" style="font-size: 10px;">è£…é€¼ï¼Œç‰¹æŠ€</a> <a href="/tags/è¯ä¹¦ï¼ŒApplication-Loader/" style="font-size: 10px;">è¯ä¹¦ï¼ŒApplication Loader</a> <a href="/tags/è½¬è½½/" style="font-size: 20px;">è½¬è½½</a> <a href="/tags/é€†å‘å·¥ç¨‹/" style="font-size: 10px;">é€†å‘å·¥ç¨‹</a> <a href="/tags/éšç¬”/" style="font-size: 10px;">éšç¬”</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.devtang.com">å”å·§çš„åšå®¢</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.superqq.com">åˆšåˆšåœ¨çº¿</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://jj59.com">ä¹ä¹æ–‡ç« ç½‘</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cocoachina.com">CocoaChina</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.csdn.net/yiyaaixuexi/">å¿µèŒœçš„åšå®¢</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">14çº§æ¯•ä¸šç”Ÿ,ä¸“æ³¨äºiOSå¼€å‘ã€‚åˆ›å»ºObjective-Cã€SwiftæŠ€æœ¯å¼€å‘äº¤æµç¾¤201556264,æ¬¢è¿åŠ å…¥ï¼Œå…±åŒæé«˜!</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">å«ç¬‘é¥®ç ’éœœ</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://tp1.sinaimg.cn/2185265952/180/5686790740/1" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">å«ç¬‘é¥®ç ’éœœ</h1>
			</hgroup>
			
			<p class="header-subtitle">å¦‚æœå¯ä»¥æ‰“é€ éå‡¡åº”ç”¨ ä¸ºä»€ä¹ˆè¦æ­¢æ­¥äºè¿‡å¾—å»</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">ä¸»é¡µ</a></li>
		        
					<li><a href="/archives">æ¦‚è§ˆ</a></li>
		        
					<li><a href="/categories/è¿›é˜¶">è¿›é˜¶</a></li>
		        
					<li><a href="/categories/OC">OC</a></li>
		        
					<li><a href="/categories/Swift">Swift</a></li>
		        
					<li><a href="/categories/éšç¬”">éšç¬”</a></li>
		        
					<li><a href="/categories/è½¬è½½">è½¬è½½</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/ChinaFishNews" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/2185265952/profile?topnav=1&wvr=6&is_all=1" title="weibo">weibo</a>
			        
						<a class="twitter" target="_blank" href="https://twitter.com/fishnewsdream" title="twitter">twitter</a>
			        
						<a class="linkedin" target="_blank" href="http://www.linkedin.com/in/æ–°é—»-ä½™-ab2b19101?trk=nav_responsive_tab_profile_pic" title="linkedin">linkedin</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-RunTimeæ¢ç©¶" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/04/07/RunTimeæ¢ç©¶/" class="article-date">
  	<time datetime="2018-04-06T16:00:00.000Z" itemprop="datePublished">2018-04-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/07/RunTimeæ¢ç©¶/">RunTimeæ¢ç©¶</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><br></p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=538980932&auto=0&height=66"></iframe>

<p><code>RunTime</code>,å³è¿è¡Œæ—¶ï¼Œæ˜¯åŸºäº<code>C</code>è¯­è¨€çš„ä¸€å¥—<code>API</code>, ä¹Ÿè¢«ç§°ä¸º<code>iOS</code>ç³»ç»Ÿçš„é»‘é­”æ³•ï¼Œåœ¨å¼€å‘ä¸­å æ®ä¸¾è¶³è½»é‡çš„ä½œç”¨</p>
<p>è¿™é‡Œä»¥<code>objc_msgSend</code>å³æ¶ˆæ¯å‘é€ï¼Œä½œä¸ºåˆ‡å…¥ç‚¹</p>
<p>æ–°å»ºä¸€ä¸ªé¡¹ç›®</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_07_01.png" alt=""></p>
<p>æ§åˆ¶å™¨ä¸­è°ƒç”¨<code>Person</code>æ–¹æ³•</p>
<pre><code>Person * p = [[Person alloc] init];
[p eat];
</code></pre><p>å½“ç„¶è¿˜å¯ä»¥å†™æˆ</p>
<pre><code>Person * p = [Person alloc];
p = [p init];
[p performSelector:@selector(eat)];
</code></pre><p><code>OC</code>ä¸­è°ƒç”¨æ–¹æ³•ï¼Œå…¶å®å°±æ˜¯å‘è°ƒç”¨å¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œå³<code>iOS</code>çš„æ¶ˆæ¯æœºåˆ¶ï¼Œæ¯ä¸ªå¯¹è±¡ä¸­å…¶å®éƒ½æœ‰ä¸€å¼ æ˜ å°„è¡¨ï¼Œè¿™é‡Œçš„<code>@selector</code>å…¶å®æ˜¯æ–¹æ³•æ ‡è¯†<code>SEL</code>ï¼Œæ ¹æ®è¿™ä¸ªæ–¹æ³•æ ‡è¯†ä¼šæ‰¾åˆ°æ–¹æ³•å®ç°çš„æŒ‡é’ˆï¼Œå³<code>IMP</code>,å†æ ¹æ®<code>IMP</code>åœ°å€å€¼æ‰¾åˆ°å…·ä½“çš„ä»£ç å®ç°ï¼Œ<code>SEL</code>å’Œ<code>IMP</code>æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä¸Šé¢ä»£ç å¦‚æœä½¿ç”¨<code>RunTime</code>åº”è¯¥æ€ä¹ˆå†™ï¼Ÿ</p>
<p>è¦å…ˆå¯¼å…¥å¤´æ–‡ä»¶<code>#import &lt;objc/message.h&gt;</code>,å¹¶ä¸”åœ¨<code>Build Settings</code>ä¸­è®¾ç½®</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_07_03.png" alt=""></p>
<p>è¿™æ˜¯å› ä¸ºè‡ª<code>Xcode</code>5ä¹‹åï¼ŒğŸä¸å»ºè®®ä½¿ç”¨åº•å±‚å‡½æ•°ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯</p>
<pre><code>Person *p = objc_msgSend(Person.class, @selector(alloc));
p = objc_msgSend(p, @selector(init));
objc_msgSend(p, @selector(eat));
</code></pre><p>è¿™ä¹ˆå†™å…¶å®è¿˜å¯ä»¥å†æ·±å…¥ä¸€ç‚¹</p>
<pre><code>Person *p = objc_msgSend(objc_getClass(&quot;Person&quot;), sel_registerName(&quot;alloc&quot;));
p = objc_msgSend(p, sel_registerName(&quot;init&quot;));
objc_msgSend(p, sel_registerName(&quot;eat&quot;));
</code></pre><p><code>objc_getClass</code>å…¶å®å°±ç›¸å½“äº<code>OC</code>ä¸­çš„<code>NSClassFromString</code>ï¼Œ<code>sel_registerName</code>ç›¸å½“äº<code>OC</code>ä¸­çš„<code>NSSelectorFromString</code></p>
<p>å…¶å®ä¹Ÿå¯ä»¥å€ŸåŠ©æˆ‘ä»¬çš„<code>Clang</code>ç¼–è¯‘å™¨æŸ¥çœ‹æˆ‘ä»¬åº•å±‚ä»£ç çš„å®ç°</p>
<p>å¯ä»¥æ–°å»ºä¸€ä¸ª<code>macOS</code>çš„å‘½ä»¤è¡Œé¡¹ç›®,åœ¨<code>main.m</code>æ–‡ä»¶ä¸­ä¾ç„¶è°ƒç”¨ä¸Šé¢ä»£ç ï¼Œä½¿ç”¨<code>clang -rewrite-objc main.m</code>ä¼šç”Ÿæˆä¸€ä¸ª<code>main.cpp</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸‹ä¼šæ‰¾åˆ°æœ€ç»ˆçš„å®ç°ä»£ç </p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_07_02.png" alt=""></p>
<p>æˆ‘ä»¬åœ¨<code>objc/message.h</code>å’Œ<code>objc/runtime</code>æ–‡ä»¶ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç³»ç»Ÿç»™æˆ‘ä»¬æä¾›äº†ä¼—å¤šæ¥å£ï¼Œä¸‹é¢åˆ—ä¸¾éƒ¨åˆ†ï¼Œä»…åšè®°å½•ä½¿ç”¨</p>
<pre><code>// è·å–å®ä¾‹å¯¹è±¡çš„æ‰€å±çš„ç±»
Class object_getClass(id obj);

// è®¾ç½®å®ä¾‹å¯¹è±¡çš„æ‰€å±çš„ç±»
Class object_setClass(id obj, Class cls);

// è·å–å®ä¾‹å¯¹è±¡çš„æ‰€å±ç±»çš„ç±»å
const char *object_getClassName(id obj);

// è¿”å›æŒ‡å‘ç»™å®šå¯¹è±¡åˆ†é…çš„ä»»ä½•é¢å¤–å­—èŠ‚çš„æŒ‡é’ˆ
void *object_getIndexedIvars(id obj);

// è·å–å®ä¾‹å¯¹è±¡çš„æˆå‘˜å˜é‡
id object_getIvar(id obj, Ivar ivar);

// è®¾ç½®å®ä¾‹å¯¹è±¡çš„æˆå‘˜å˜é‡
 void object_setIvar(id obj, Ivar ivar, id value);

// ä¿®æ”¹ç±»å®ä¾‹çš„å®ä¾‹å˜é‡çš„å€¼
Ivar object_setInstanceVariable(id obj, const char *name, void     *value);

// è·å–å¯¹è±¡å®ä¾‹å˜é‡çš„å€¼
Ivar object_getInstanceVariable(id obj, const char *name, void     **outValue);

// è¿”å›æŒ‡å®šç±»çš„å…ƒç±»
id objc_getMetaClass(const char *name);

// è¿”å›æŒ‡å®šç±»çš„ç±»å®šä¹‰
id objc_lookUpClass(const char *name);

// è¿”å›å®ä¾‹å¯¹è±¡çš„ç±»
id objc_getClass(const char *name);

// è·å–å·²æ³¨å†Œçš„ç±»å®šä¹‰çš„åˆ—è¡¨
int objc_getClassList(Class *buffer, int bufferCount);

// åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘æ‰€æœ‰å·²æ³¨å†Œç±»çš„æŒ‡é’ˆåˆ—è¡¨
Class *objc_copyClassList(unsigned int *outCount);

// è·å–ç±»çš„ç±»å
const char *class_getName(Class cls);

// æ˜¯å¦æ˜¯å…ƒç±»
BOOL class_isMetaClass(Class cls);

// è·å–ç±»çš„çˆ¶ç±»
Class class_getSuperclass(Class cls);

// è®¾ç½®æ–°ç±»çš„çˆ¶ç±»
Class class_setSuperclass(Class cls, Class newSuper);

// ç±»çš„ç‰ˆæœ¬ä¿¡æ¯
int class_getVersion(Class cls);

// è®¾ç½®ç±»çš„ç‰ˆæœ¬ä¿¡æ¯
void class_setVersion(Class cls, int version);

// è·å–è¯¥ç±»å®ä¾‹å¯¹è±¡å¤§å°
size_t class_getInstanceSize(Class cls);

// è·å–ç±»ä¸­æŒ‡å®šåç§°å®ä¾‹å¯¹è±¡çš„ä¿¡æ¯
Ivar class_getInstanceVariable(Class cls, const char *name);

// è·å–ç±»æˆå‘˜å˜é‡çš„ä¿¡æ¯
Ivar class_getClassVariable(Class cls, const char *name);

// è·å–æ•´ä¸ªæˆå‘˜å˜é‡åˆ—è¡¨
Ivar *class_copyIvarList(Class cls, unsigned int *outCount);

// è·å–å®ä¾‹æ–¹æ³•.
Method class_getInstanceMethod(Class cls, SEL name);

// è·å–ç±»æ–¹æ³•.
Method class_getClassMethod(Class cls, SEL name);

// è¿”å›æ–¹æ³•çš„å…·ä½“å®ç°
IMP class_getMethodImplementation(Class cls, SEL name);

// è¿”å›æ–¹æ³•çš„å…·ä½“å®ç°
IMP class_getMethodImplementation_stret(Class cls, SEL name);

// æ£€æŸ¥ç±»æ˜¯å¦å“åº”æŒ‡å®šçš„æ¶ˆæ¯.
BOOL class_respondsToSelector(Class cls, SEL sel);

// è·å–ç±»æ–¹æ³•åˆ—è¡¨.
Method *class_copyMethodList(Class cls, unsigned int *outCount);

// æ£€æŸ¥ç±»æ˜¯å¦å®ç°äº†æŒ‡å®šåè®®ç±»çš„æ–¹æ³•.
BOOL class_conformsToProtocol(Class cls, Protocol *protocol);

// è¿”å›ç±»éµå®ˆçš„åè®®åˆ—è¡¨.
Protocol * __unsafe_unretained *class_copyProtocolList(Class cls,     unsigned int *outCount);

// è·å–æŒ‡å®šçš„å±æ€§
objc_property_t class_getProperty(Class cls, const char *name);

// è·å–å±æ€§åˆ—è¡¨
objc_property_t *class_copyPropertyList(Class cls, unsigned int     *outCount);

// åˆ›å»ºå®ä¾‹å¯¹è±¡
id class_createInstance(Class cls, size_t extraBytes);

// åœ¨æŒ‡å®šä½ç½®åˆ›å»ºç±»å®ä¾‹
id objc_constructInstance(Class cls, void *bytes);

// é”€æ¯ç±»å®ä¾‹
void *objc_destructInstance(id obj);

// åˆ›å»ºä¸€ä¸ªæ–°ç±»å’Œå…ƒç±»  (ClassPair:åŒ…å«ç±»å’Œå…ƒç±»)
Class objc_allocateClassPair(Class superclass, const char *name,     size_t extraBytes);

// åœ¨åº”ç”¨ä¸­æ³¨å†Œç”±objc_allocateClassPairåˆ›å»ºçš„ç±»
void objc_registerClassPair(Class cls);

// å¤åˆ¶ä¸€ä»½ç±»
Class objc_duplicateClass(Class original, const char *name,size_t     extraBytes);

// é”€æ¯ä¸€ä¸ªç±»åŠå…¶ç›¸å…³è”çš„ç±»
void objc_disposeClassPair(Class cls);

// æ·»åŠ æŸä¸ªç±»çš„æ–¹æ³•
BOOL class_addMethod(Class cls, SEL name, IMP imp,const char         *types);

// æ›¿æ¢æŸä¸ªç±»çš„æ–¹æ³•
IMP class_replaceMethod(Class cls, SEL name, IMP imp,const char     *types);

// æ·»åŠ æŸä¸ªç±»çš„å˜é‡,è¿™ä¸ªæ–¹æ³•åªèƒ½åœ¨objc_allocateClassPairå‡½æ•°ä¸objc_registerClassPairä¹‹é—´è°ƒç”¨
BOOL class_addIvar(Class cls, const char *name, size_t size,         uint8_t alignment, const char *types);

// æ·»åŠ æŸä¸ªç±»çš„åè®®
BOOL class_addProtocol(Class cls, Protocol *protocol);

// æ·»åŠ æŸä¸ªç±»çš„å±æ€§
 BOOL class_addProperty(Class cls, const char *name, const         objc_property_attribute_t *attributes, unsigned int attributeCount);

// æ›¿æ¢æŸä¸ªç±»çš„å±æ€§
void class_replaceProperty(Class cls, const char *name, const     objc_property_attribute_t *attributes, unsigned int attributeCount);

// é€šè¿‡æ–¹æ³•åè¿”å›æ–¹æ³•
SEL method_getName(Method m);

// è·å–æ–¹æ³•çš„å®ç°åœ°å€
IMP method_getImplementation(Method m);

// è·å–æ–¹æ³•å‚æ•°åˆ—è¡¨
unsigned int method_getNumberOfArguments(Method m);

// ä¿®æ”¹æ–¹æ³•å®ç°
IMP method_setImplementation(Method m, IMP imp) ;

// æ–¹æ³•äº¤æ¢
void method_exchangeImplementations(Method m1, Method m2) ;

// è¿è¡Œæ—¶ç»™åˆ†ç±»æ·»åŠ /åˆ é™¤å±æ€§
void objc_setAssociatedObject(id object, const void *key, id     value, objc_AssociationPolicy policy);
id objc_getAssociatedObject(id object, const void *key);
void objc_removeAssociatedObjects(id object);
</code></pre><p>å…·ä½“åˆ°å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸€äº›å¼€æ”¾ç»™æˆ‘ä»¬çš„æ¥å£æ¥å®ç°ç›¸åº”çš„åŠŸèƒ½ï¼Œä¸‹é¢åˆ—ä¸¾å‡ ä¸ªæ¡ˆä¾‹</p>
<p>æœªå®Œå¾…ç»­â€¦</p>
<p><a href="https://github.com/ChinaFishNews/RunTimeDemo" target="_blank" rel="external">RunTimeDemoä¸‹è½½</a></p>
<hr>
<p>å¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–é—®é¢˜è¯·è”ç³»æˆ‘:fishnewsdream@gmail.com,æ¬¢è¿äº¤æµï¼Œå…±åŒæé«˜ï¼</p>
<p>Objective-C/SwiftæŠ€æœ¯å¼€å‘äº¤æµç¾¤201556264ï¼Œè®¨è®ºä½•ç§æŠ€æœ¯å¹¶ä¸å—é™ï¼Œæ¬¢è¿å„ä½å¤§ç‰›ç™¾å®¶äº‰é¸£ï¼</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">åˆšåˆšåœ¨çº¿å·¥ä½œå®¤</a>ï¼Œæ¬¢è¿å…³æ³¨æˆ–æå‡ºå»ºè®¾æ€§æ„è§ï¼</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">åˆšåˆšåœ¨çº¿è®ºå›</a>, æ¬¢è¿è¸Šè·ƒæé—®æˆ–è§£ç­”ï¼</p>
<p>å¦‚æœ‰è½¬è½½ï¼Œè¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RunTime/">RunTime</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/OC/">OC</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-RunLoopæ¢ç©¶" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/03/29/RunLoopæ¢ç©¶/" class="article-date">
  	<time datetime="2018-03-28T16:00:00.000Z" itemprop="datePublished">2018-03-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/29/RunLoopæ¢ç©¶/">RunLoopæ¢ç©¶</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><br></p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=547893368&auto=0&height=66"></iframe>


<p>RunLoop,å³è¿è¡Œå¾ªç¯ï¼Œä½ éè¦å«å®ƒè·‘åœˆï¼Œä¹Ÿä¸æ˜¯ä¸å¯ä»¥</p>
<p>è¿™å“¥ä»¬åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªç¨‹åºçš„å…¥å£å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯åœ¨main.mæ–‡ä»¶ä¸­</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_03_30_01.png" alt=""></p>
<p>ç¨‹åºå¯åŠ¨é¦–å…ˆå°±ä¼šèµ°åˆ°è¿™é‡Œï¼Œè¿™é‡Œæœ‰ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œä¸€èˆ¬åœ¨åˆ›å»ºå¤§é‡ä¸´æ—¶å˜é‡çš„æ—¶å€™ä¼šæ‰‹åŠ¨åˆ›å»ºé‡Šæ”¾æ± ï¼Œè¿™é‡Œå°†æ•´ä¸ªç¨‹åºè¿è¡ŒæœŸé—´éƒ½ç½®äºè¿™ä¸ªé‡Šæ”¾æ± å†…ï¼Œç¨‹åºè¿è¡Œç»“æŸä¹‹æ—¶ï¼Œè‡ªåŠ¨é‡Šæ”¾æ± ç»“æŸï¼Œå†…å­˜å›æ”¶ã€‚è¿™ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± å†…ï¼Œå°±ä¸€å¥ä»£ç ï¼Œè¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè¿›å…¥<code>UIApplicationMain</code>å‡½æ•°å†…å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›å€¼æ˜¯<code>int</code>å‹ã€‚é‚£æˆ‘ä»¬æ¢ç§å†™æ³•</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_03_30_02.png" alt=""></p>
<p>è¿è¡Œèµ·æ¥ï¼Œä¼šå‘ç°ç¬¬åå…­è¡Œå¹¶ä¸ä¼šæ‰§è¡Œï¼Œä»£ç åœç•™åœ¨äº†ç¬¬åäº”è¡Œï¼Œä¸ä¼šå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´<code>UIApplicationMain</code>å‡½æ•°ä¸€ç›´æ²¡æœ‰è¿”å›ã€‚æˆ‘ä»¬çš„ç¨‹åºä¸€ç›´æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œçš„ï¼Œæˆ‘ä»¬æ‰“å°ä¸‹çœ‹çœ‹</p>
<pre><code>NSLog(@&quot;thread=%@&quot;,[NSThread currentThread]);

2018-03-30 22:53:12.821131+0800 RunLoopDemo[74265:4182972] thread=&lt;NSThread: 0x604000066180&gt;{number = 1, name = main}
</code></pre><p>çš„ç¡®ï¼Œå½“å‰å°±æ˜¯åœ¨ä¸»çº¿ç¨‹ï¼Œè¿™æ˜¯å¿…ç„¶çš„ã€‚æ•´ä¸ªé¡¹ç›®è¿è¡ŒæœŸé—´ï¼Œä¸»çº¿ç¨‹éƒ½ä¸ä¼šé€€å‡ºï¼Œä¸€æ—¦é€€å‡ºï¼Œç¨‹åºè‚¯å®šå°±æŒ‚äº†ã€‚ç©¶å…¶åŸå› ï¼Œæ˜¯å› ä¸º<code>UIApplicationMain</code>å‡½æ•°å†…å¼€å¯äº†ä¸€ä¸ªæ­»å¾ªç¯ï¼Œç”¨æ¥ä¿ä½ä¸»çº¿ç¨‹çš„ç”Ÿå‘½ï¼Œç¨‹åºå¤„äºè¿è¡ŒçŠ¶æ€ï¼Œä½¿å¾—æ•´ä¸ªé¡¹ç›®è¿è¡ŒæœŸé—´ï¼Œä¸»çº¿ç¨‹éƒ½ä¸ä¼šé€€å‡ºã€‚è¿™ä¸ªæ­»å¾ªç¯ï¼Œå…¶å®å°±æ˜¯RunLoop,RunLoppå°±æ˜¯ä¸ªæ­»å¾ªç¯ã€‚è¿™ä¸ªé»˜è®¤å¯åŠ¨çš„<code>RunLoop</code>æ˜¯è·Ÿä¸»çº¿ç¨‹ç›¸å…³è”çš„ã€‚<code>RunLoop</code>è¿™ä¹ˆè®¾è®¡ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<ul>
<li>ä¿è¯çº¿ç¨‹ä¸é€€å‡ºï¼Œå³ç¨‹åºçš„æŒç»­è¿è¡Œ</li>
<li>ç›‘å¬äº‹ä»¶ï¼Œè¯¢é—®æ˜¯å¦æœ‰äº‹ä»¶å‘ç”Ÿï¼Œä»äº‹ä»¶é˜Ÿåˆ—é‡Œå–å‡ºäº‹ä»¶å¹¶å¤„ç†(ç½‘ç»œã€è§¦æ‘¸ã€æ—¶é’Ÿç­‰äº‹ä»¶)</li>
<li>èŠ‚çœ<code>CPU</code>èµ„æº,æé«˜ç¨‹åºæ€§èƒ½ï¼šè¯¥åšäº‹æ—¶åšäº‹ï¼Œè¯¥ä¼‘æ¯æ—¶ä¼‘æ¯</li>
</ul>
<p>é‚£å°±å†™ä¸ªä»£ç ç©ä¸€ä¸‹è¯•è¯•çœ‹</p>
<pre><code>- (void)viewDidLoad {
    [super viewDidLoad];

    NSTimer *timer = [NSTimer timerWithTimeInterval:1.0     target:self selector:@selector(timerMethod) userInfo:nil     repeats:YES];
}

- (void)timerMethod {
    static int a = 0;
    a++;
    NSLog(@&quot;a=%zd&quot;,a);
}
</code></pre><p>ä¸€ä¸ªå¾ˆç®€å•çš„æ—¶é’Ÿäº‹ä»¶ï¼Œè¿™ä¸ªæ—¶å€™ä½ ä¼šå‘ç°æ–¹æ³•å¹¶æ²¡æœ‰èµ°ã€‚ä¸Šé¢å·²ç»æåˆ°ï¼Œ<code>RunLoop</code>ç”¨æ¥ç›‘å¬äº‹ä»¶ï¼Œéœ€è¦å°†<code>timer</code>åŠ åˆ°<code>RunLoop</code>ä¸­å»</p>
<pre><code>[[NSRunLoop currentRunLoop] addTimer:timer     forMode:NSDefaultRunLoopMode];
</code></pre><p>æ³¨æ„RunLoopæ— æ³•æ‰‹åŠ¨åˆ›å»ºï¼Œåªèƒ½è·å–ï¼Œä¸è¿‡å…¶å®ç¬¬ä¸€æ¬¡è·å–å°±æ˜¯åˆ›å»ºã€‚è¿™é‡Œé¢æœ‰ä¸ª<code>mode</code>å±æ€§ï¼Œæš‚æ—¶å†™é»˜è®¤ï¼Œè¿™æ—¶å€™è¿è¡Œç¨‹åºï¼Œæ­£å¸¸è¿è¡Œã€‚è¿™æ—¶å€™æˆ‘ä»¬å¾€æ§åˆ¶å™¨ä¸Šæ‹–ä¸ªtextView, è¿è¡Œ</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_03_30_03.gif" alt=""></p>
<p>é—®é¢˜å‡ºæ¥äº†ï¼Œå¯åŠ¨åæ—¶é’Ÿäº‹ä»¶æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ä¸€æ—¦æ‹–åŠ¨textView,æ—¶é’Ÿäº‹ä»¶å°±åœæ­¢æ‰“å°ï¼Œä¸æ‹–åŠ¨textView,æ—¶é’Ÿäº‹ä»¶åˆæ­£å¸¸è¿è¡Œã€‚è¿™æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ</p>
<p>ä¸Šé¢æˆ‘ä»¬å°†<code>timer</code>ä¸¢ç»™<code>RunLoop</code>çš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ¨¡å¼<code>mode</code>æ˜¯<code>NSDefaultRunLoopMode</code>é»˜è®¤æ¨¡å¼ã€‚</p>
<p>iOSä¸­æœ‰ä¸¤å¥—APIæ¥è®¿é—®å’Œä½¿ç”¨RunLoopå¯¹è±¡ï¼Œåˆ†åˆ«æ˜¯OCè¯­è¨€ä¸­çš„<code>Foundation</code>æ¡†æ¶(<code>NSRunLoop</code>)å’ŒCè¯­è¨€ä¸­çš„<code>Core Foundation</code>æ¡†æ¶(<code>CFRunLoopRef</code>),<code>NSRunLoop</code>æ˜¯åŸºäº<code>CFRunLoopRef</code>çš„ä¸€å±‚<code>OC</code>åŒ…è£…</p>
<p><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html" target="_blank" rel="external">RunLoopæ–‡æ¡£</a> </p>
<p><a href="http://opensource.apple.com/source/CF/CF-1151.16" target="_blank" rel="external">CFRunLoopRefæ–‡æ¡£</a></p>
<p>RunLoopå…¶å®å…±äº”ç§æ¨¡å¼</p>
<ul>
<li><code>NSDefaultRunLoopMode</code></li>
<li><code>UITrackingRunLoopMode</code></li>
<li><code>NSRunLoopCommonModes</code></li>
<li><code>NSConnectionReplyMode</code></li>
<li><code>NSModalPanelRunLoopMode</code></li>
</ul>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_01.png" alt=""></p>
<p><code>NSDefaultRunLoopMode</code>æ¨¡å¼å°±æ˜¯<code>RunLoop</code>çš„é»˜è®¤æ¨¡å¼ï¼Œè€Œ<code>UITrackingRunLoopMode</code>æ¨¡å¼åˆ™æ˜¯<code>UI</code>æ¨¡å¼ï¼Œ<code>UI</code>æ¨¡å¼åªèƒ½è¢«è§¦æ‘¸äº‹ä»¶å”¤é†’ï¼Œæ‰€ä»¥ä¼˜å…ˆçº§æœ€é«˜ã€‚è¿™é‡Œç¬¬ä¸‰ç§æ¨¡å¼<code>NSRunLoopCommonModes</code>ä¸¥æ ¼æ¥è¯´ä¸æ˜¯ä¸€ç§æ¨¡å¼ï¼Œè€Œæ˜¯ä¸€ç§å ä½æ¨¡å¼ï¼Œæ—¢èƒ½èµ·åˆ°é»˜è®¤æ¨¡å¼çš„æ•ˆæœåˆèƒ½èµ·åˆ°<code>UI</code>æ¨¡å¼çš„æ•ˆæœã€‚ç¬¬å››ç§å’Œç¬¬äº”ç§æ¨¡å¼åˆ†åˆ«æ˜¯åœ¨åˆšå¯åŠ¨è¿›å…¥<code>App</code>æ—¶è¿›å…¥çš„ç¬¬ä¸€ä¸ª<code>Mode</code>ï¼Œå¯åŠ¨åå°±ä¸å†ä½¿ç”¨ï¼Œå’Œæ¥å—ç³»ç»Ÿæ—¶é—´çš„å†…éƒ¨<code>Mode</code>,ä½œä¸ºå¼€å‘è€…è¿™ä¸¤ç§æ¨¡å¼åŸºæœ¬ä¸ä¼šä½¿ç”¨åˆ°ï¼Œ</p>
<p><code>Core Foundation</code>ä¸­å…³äº<code>RunLoop</code>æœ‰äº”ä¸ªç±»</p>
<ul>
<li><code>CFRunLoopRef</code></li>
<li><code>CFRunLoopModeRef</code></li>
<li><code>CFRunLoopSourceRef</code></li>
<li><code>CFRunLoopTimerRef</code></li>
<li><code>CFRunLoopObserverRef</code></li>
</ul>
<p><code>CFRunLoopRef</code>å¯¹åº”çš„å°±æ˜¯<code>NSRunLoop</code>,<code>CFRunLoopModeRef</code>ä»£è¡¨ä¸Šé¢è¯´åˆ°çš„<code>RunLoop</code>çš„å‡ ç§è¿è¡Œæ¨¡å¼ï¼Œ<code>CFRunLoopSourceRef</code>æ˜¯äº‹ä»¶æº,æˆ–è€…è¯´æ˜¯è¾“å…¥æºï¼Œç°åœ¨äº‹ä»¶æºåˆ†ä¸ºä¸¤ç§ï¼ŒéåŸºäº<code>Port</code>çš„<code>Source0</code>å’ŒåŸºäº<code>Port</code>çš„<code>Source1</code>,åŸºäº<code>Port</code>æ˜¯æŒ‡  é€šè¿‡å†…æ ¸å’Œå…¶ä»–çº¿ç¨‹é€šä¿¡ï¼Œæ¥æ”¶ã€åˆ†å‘ç³»ç»Ÿäº‹ä»¶ï¼Œ<code>CFRunLoopTimerRef</code>æ˜¯åŸºäºäº‹ä»¶çš„è§¦å‘å™¨ï¼Œç›¸å½“äº<code>NSTimer</code>,<code>CFRunLoopObserverRef</code>æ˜¯è§‚å¯Ÿè€…ï¼Œèƒ½å¤Ÿç›‘å¬<code>RunLoop</code>çš„çŠ¶æ€æ”¹å˜ï¼Œå¯ä»¥ç›‘å¬çš„æ—¶é—´ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ª</p>
<ul>
<li><code>kCFrunLoopEntry</code> (1UL &lt;&lt; 0)  å³å°†è¿›å…¥Loop</li>
<li><code>kCFRunLoopBeforeTimers</code> (1UL &lt;&lt; 1)  å³å°†å¤„ç†Timer</li>
<li><code>kCFRunLoopBeforeSources</code> (1UL &lt;&lt; 2)  å³å°†å¤„ç†Source</li>
<li><code>kCFRunLoopBeforeWaiting</code> (1UL &lt;&lt; 5) å³å°†è¿›å…¥ä¼‘çœ </li>
<li><code>kCFRunLoopAfterWaiting</code> (1UL &lt;&lt; 6) åˆšä»ä¼‘çœ ä¸­å”¤é†’</li>
<li><code>kCFRunLoopExit</code> (1UL &lt;&lt; 7) å³å°†é€€å‡ºLoop</li>
<li><code>kCFRunLoopAllActivities</code> æ‰€æœ‰çŠ¶æ€</li>
</ul>
<p>ä¸Šé¢æˆ‘ä»¬æ˜¯æŠŠæ—¶é’ŸåŠ åˆ°é»˜è®¤æ¨¡å¼ä¸‹ï¼Œç°åœ¨æˆ‘ä»¬åŠ åœ¨<code>UI</code>æ¨¡å¼çœ‹ä¸‹æ•ˆæœ</p>
<pre><code>[[NSRunLoop currentRunLoop] addTimer:timer     forMode:UITrackingRunLoopMode];
</code></pre><p>å†æ¬¡è¿è¡Œç¨‹åº</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_03_30_04.gif" alt=""></p>
<p>é—®é¢˜åˆå‡ºæ¥äº†ï¼Œå½“æˆ‘ä»¬æ‹–åˆ°<code>textView</code>æ—¶ï¼Œæ—¶é’Ÿäº‹ä»¶å¯ä»¥æ­£å¸¸æ‰“å°ï¼Œä½†æ˜¯ä¸€æ—¦åœæ­¢å°±ä¸å†æ‰“å°äº†ã€‚è¿™æ˜¯å› ä¸ºï¼Œæ—¶é’Ÿæ˜¯åŠ åˆ°<code>RunLoop</code>çš„<code>UI</code>æ¨¡å¼ä¸‹çš„ï¼Œè€Œ<code>UI</code>æ¨¡å¼åªæœ‰åœ¨è§¦æ‘¸å±å¹•çš„æ—¶å€™æ‰ä¼šå”¤é†’ï¼Œè€Œæ²¡æœ‰è§¦æ‘¸å±å¹•çš„æ—¶å€™<code>RunLoop</code>åˆ™å¤„äºä¼‘çœ çŠ¶æ€ï¼Œæ‰€ä»¥æ‰ä¼šå‡ºç°æ­¤é—®é¢˜ã€‚æ€ä¹ˆæ‰èƒ½è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå°†è¿™ä¸ªæ—¶é’Ÿæ—¢åŠ åˆ°é»˜è®¤æ¨¡å¼ä¸‹ï¼ŒåˆåŠ åˆ°<code>UI</code>æ¨¡å¼ä¸‹</p>
<pre><code> [[NSRunLoop currentRunLoop] addTimer:timer     forMode:NSDefaultRunLoopMode];
[[NSRunLoop currentRunLoop] addTimer:timer     forMode:UITrackingRunLoopMode];
</code></pre><p>è¿™è¦æ·»åŠ ä¸¤æ¬¡ï¼Œè€ŒğŸè‚¯å®šè€ƒè™‘åˆ°äº†è¿™ç‚¹ï¼Œæ‰€ä»¥æœ‰äº†<code>NSRunLoopCommonModes</code>è¿™ç§å ä½æ¨¡å¼</p>
<p>[[NSRunLoop currentRunLoop] addTimer:timer     forMode:NSRunLoopCommonModes];</p>
<p>å†æ¬¡è¿è¡Œï¼Œä¼šå‘ç°ä¸Šè¿°é—®é¢˜éƒ½å¾—åˆ°äº†è§£å†³ï¼Œæ‹–æ‹½ä¸å†å½±å“æ—¶é’Ÿæ–¹æ³•çš„æ‰§è¡Œäº†ã€‚ç®€å•ç”»ä¸ªå›¾</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_03_30_06.png" alt=""></p>
<p>è¿™æ˜¯ğŸå®˜ç½‘çš„å›¾</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_02.png" alt=""></p>
<p>ä¸Šé¢æåˆ°ï¼Œ<code>RunLoop</code>çš„ä½œç”¨ä¹‹ä¸€å°±æ˜¯ç›‘å¬äº‹ä»¶å¹¶æ‰§è¡Œï¼Œäº‹ä»¶å¯ä»¥æœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚æ—¶é’Ÿäº‹ä»¶ã€ç›‘å¬äº‹ä»¶ã€ç½‘ç»œäº‹ä»¶ç­‰ç­‰ã€‚<code>UI</code>æ¨¡å¼ä¸‹çš„è¿™äº›äº‹ä»¶å¿…é¡»é€šè¿‡è§¦æ‘¸æ‰èƒ½å”¤é†’<code>RunLoop</code>å»æ‰§è¡Œï¼Œæ‰§è¡Œå®Œä¹‹åRunLoopå°±å¤„äºä¼‘çœ çŠ¶æ€ï¼Œå¾ªç¯å¾€å¤ã€‚è€Œé»˜è®¤æ¨¡å¼ä¸‹ï¼Œåªè¦æœ‰è¿™äº›äº‹ä»¶ï¼Œå°±ä¼šåŠæ—¶é€šçŸ¥<code>RunLoop</code>å»æ‰§è¡Œã€‚</p>
<p>ç»§ç»­æ·±ç©¶ï¼Œå¦‚æœè¿™ä¸ªäº‹ä»¶æ˜¯ä¸ªè€—æ—¶æ“ä½œä¼šæ€æ ·ï¼Ÿæˆ‘ä»¬åœ¨<code>timerMethod</code>è¿™ä¸ªæ—¶é—´ä¸‹æ¨¡æ‹Ÿä¸€ä¸‹</p>
<pre><code>[NSThread sleepForTimeInterval:1.0];
</code></pre><p>æˆ‘è®©å®ƒæ¯æ¬¡ç¡ä¸ª2ç§’é’Ÿå†æ‰§è¡Œ</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_03_30_07.gif" alt=""></p>
<p>é—®é¢˜åˆå‡ºæ¥äº†ï¼Œä½ ä¼šå‘ç°<code>UI</code>è¢«å¡ä½äº†ï¼Œå› ä¸ºå½“å‰æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œæ¯æ¬¡éƒ½å¼ºè¿«å®ƒç¡2ç§’ï¼Œè¿™ç»å£ä¼šå¡ä½ã€‚æ—¢ç„¶è¿™æ ·ï¼Œé‚£å°±è®©è¿™ä¸ªè€—æ—¶æ“ä½œæ”¾åœ¨å­çº¿ç¨‹å»æ‰§è¡Œ</p>
<pre><code>- (void)viewDidLoad {
    [super viewDidLoad];
    NSThread *thread = [[NSThread alloc] initWithBlock:^{
        NSTimer *timer = [NSTimer timerWithTimeInterval:1.0 target:self selector:@selector(timerMethod) userInfo:nil repeats:YES];
        [[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes];
          NSLog(@&quot;111&quot;);
    }];
    [thread start];
}

- (void)timerMethod {
    NSLog(@&quot;222&quot;);
    [NSThread sleepForTimeInterval:2.0];
    static int a = 0;
    a++;
}
</code></pre><p>è¿™æ—¶å€™è¿è¡Œä¼šå‘ç°111å°½ç®¡æ‰“å°äº†ï¼Œä½†æ˜¯222æ²¡æœ‰æ‰“å°ï¼Œè¿™è¯´æ˜<code>timerMethod</code>æ–¹æ³•å¹¶æ²¡æœ‰æ‰§è¡Œï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿè¿™æ—¶å€™æˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ª<code>FN_Thread</code></p>
<pre><code>@implementation FN_Thread
- (void)dealloc {
    NSLog(@&quot;dealloc&quot;);
}
</code></pre><p>æŠŠ<code>NSThread</code>æ›¿æ¢æˆ<code>FN_Thread</code></p>
<pre><code> FN_Thread *thread = [[FN_Thread alloc] initWithBlock:^{
        NSTimer *timer = [NSTimer timerWithTimeInterval:1.0 target:self selector:@selector(timerMethod) userInfo:nil repeats:YES];
        [[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes];
        NSLog(@&quot;111&quot;);
    }];
[thread start];
</code></pre><p>å†æ¬¡è¿è¡Œï¼Œä¼šå‘ç°æ‰“å°å®Œ111ï¼Œæ¥ç€èµ°è¿›äº†<code>FN_Thread</code>ä¸­çš„<code>dealloc</code>æ–¹æ³•ï¼Œè¿™è¯´æ˜è¿™ä¸ªçº¿ç¨‹å¯¹è±¡<code>thread</code>è¢«é‡Šæ”¾äº†ï¼Œæ—¢ç„¶è¢«é‡Šæ”¾äº†ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ä¸Šçš„<code>timeMethod</code>æ–¹æ³•è‡ªç„¶å°±ä¸ä¼šæ‰§è¡Œäº†ã€‚é‚£æˆ‘ä»¬å¼ºå¼•ç”¨è¿™ä¸ªçº¿ç¨‹å¯¹è±¡è¯•ä¸€ä¸‹,åŠ ä¸Šå¯¹åº”ä»£ç </p>
<pre><code>@property (nonatomic, strong) FN_Thread *thread;

_thread = thread;
</code></pre><p>å†æ¬¡è¿è¡Œï¼Œä¼šå‘ç°<code>FN_Thread</code>ç±»ä¸­çš„<code>dealloc</code>æ–¹æ³•ä¸èµ°äº†ï¼Œä½†æ˜¯<code>timeMethod</code>æ–¹æ³•ä¾ç„¶æ²¡æœ‰æ‰§è¡Œã€‚çº¿ç¨‹å¯¹è±¡æ²¡æœ‰é‡Šæ”¾ï¼Œå½“å‰çº¿ç¨‹ä¸Šçš„æ—¶é’Ÿæ–¹æ³•åˆæ²¡æœ‰èµ°ï¼Œè¿™åˆæ˜¯ä»€ä¹ˆåŸå› ï¼Ÿå†åŠ ä¸€ä¸ªæ–¹æ³•çœ‹ä¸€ä¸‹</p>
<pre><code>- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event {
    NSLog(@&quot;thread=%@&quot;,_thread);
    [_thread start];
}
</code></pre><p>è¿è¡Œï¼Œè§¦æ‘¸å±å¹•çš„æ—¶å€™å†æ¬¡å¼€å¯è¿™ä¸ªçº¿ç¨‹ï¼Œå¼€å¯å‰æ‰“å°ä¸€ä¸‹</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_01_02.gif" alt=""></p>
<p>è¿™ä¸ªçº¿ç¨‹å¯¹è±¡è¿˜åœ¨ï¼Œä½†æ˜¯å¼€å¯ä¼šå´©</p>
<p>è¿™æ˜¯å› ä¸ºï¼Œè¿™ä¸ªçº¿ç¨‹å·²ç»æŒ‚äº†ï¼Œå·²ç»è¢«é‡Šæ”¾äº†ï¼Œè‚¯å®šæ— æ³•è¢«å¼€å¯ï¼Œä½†æ˜¯è¿™ä¸ª<code>OC</code>å¯¹è±¡<code>thread</code>è¿˜åœ¨ï¼Œå› ä¸ºè¢«æˆ‘ä»¬å¼ºå¼•ç”¨äº†ã€‚å¼ºå¼•ç”¨çº¿ç¨‹å¯¹è±¡ï¼Œå¹¶ä¸ä¼šé˜»æ­¢çº¿ç¨‹çš„é‡Šæ”¾ã€‚æ‰€ä»¥ä¼šå‡ºç°ä¸Šè¿°æƒ…å†µã€‚äº‹å®ä¸Šï¼Œå­çº¿ç¨‹<code>block</code>å†…çš„ä»£ç æ‰§è¡Œå®Œçº¿ç¨‹å°±ä¼šè¢«é‡Šæ”¾ï¼Œè¦æƒ³çº¿ç¨‹ä¸è¢«é‡Šæ”¾ã€‚å°±å¿…é¡»è®©çº¿ç¨‹æœ‰æ‰§è¡Œä¸å®Œçš„ä»»åŠ¡ã€‚é‚£æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®©çº¿ç¨‹ä¸€ç›´åœ¨æ‰§è¡Œ,åœ¨<code>block</code>å†…åŠ å¦‚ä¸‹ä»£ç </p>
<pre><code>while (true) {     }
</code></pre><p>è¿™æ—¶å€™ä¼šå‘ç°ç¨‹åºå¯ä»¥æ­£å¸¸è¿è¡Œäº†ã€‚ä½†è¿™å¹¶ä¸æ˜¯æ­£ç¡®çš„è§£å†³æ–¹æ³•ã€‚æ­£ç¡®çš„å§¿åŠ¿åº”è¯¥æ˜¯å°†äº‹ä»¶åŠ åˆ°<code>RunLoop</code>ä¸­ï¼Œç„¶åå¼€å¯å®ƒï¼Œå› ä¸º</p>
<font color="black" size="4px"><br>æ¯ä¸ªçº¿ç¨‹éƒ½å¯¹åº”ä¸€ä¸ª<code>RunLoop</code>,ä½†æ˜¯é™¤äº†ä¸»çº¿ç¨‹ï¼Œæ‰€æœ‰å­çº¿ç¨‹çš„<code>RunLoop</code>é»˜è®¤éƒ½æ²¡æœ‰å¼€å¯ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯<br></font>


<p>åœ¨<code>NSLog(@&quot;111&quot;);</code>ä»£ç å‰åŠ ä¸Š</p>
<pre><code>[[NSRunLoop currentRunLoop] run];
</code></pre><p>å†æ¬¡è¿è¡Œï¼Œä¼šå‘ç°æ—¶é’Ÿæ–¹æ³•<code>timeMethod</code>ç»ˆäºå¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°<code>NSLog(@&quot;111&quot;);</code>è¿™å¥ä»£ç åˆæ²¡æœ‰èµ°äº†ï¼Ÿè¿™æ˜¯å› ä¸º<code>NSRunLoop</code>æ˜¯ä¸ªæ­»å¾ªç¯ï¼Œä¸‹é¢çš„ä»£ç æ ¹æœ¬ä¸ä¼šæ‰§è¡Œã€‚å¥½åœ¨ï¼Œ<code>RunLoop</code>è¿˜æä¾›ç»™äº†ä¸€ä¸ªæŒ‡å®šçº¿ç¨‹è¿è¡Œæ—¶é—´çš„æ–¹æ³•<code>[[NSRunLoop currentRunLoop] runUntilDate:];</code>,æ¯•ç«Ÿä¸€å¼€å¯å°±åœä¸ä¸‹æ¥ï¼Œè¿™æ“ä½œå¾ˆéš¾æ¥å¾—ä½</p>
<p>è¿™é‡Œå°±è®©çº¿ç¨‹å­˜æ´»æŒ‡å®šæ—¶é—´æ„Ÿå—ä¸€ä¸‹</p>
<pre><code>[[NSRunLoop currentRunLoop] runUntilDate:[NSDate dateWithTimeIntervalSinceNow:5]];
</code></pre><p>å†æ¬¡è¿è¡Œ,ä¸€åˆ‡éƒ½å¾ˆæ˜äº†äº†</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_01_03.gif" alt=""></p>
<p>è¿™é‡Œå¦‚æœæƒ³å¼ºåˆ¶é€€å‡ºå­çº¿ç¨‹ï¼Œä½¿ç”¨<code>[NSThead exit]</code>,ä¸è¿‡å¹¶ä¸å»ºè®®è¿™ä¹ˆåš</p>
<p>æœ‰å¿…è¦å¼ºè°ƒä¸€ä¸‹ï¼Œå¦‚æœåœ¨ä¸»çº¿ç¨‹è°ƒç”¨<code>[NSThead exit]</code>ä¼šæ€æ ·ï¼Ÿ</p>
<p>ä½ ä¼šå‘ç°ç¨‹åºå¹¶ä¸ä¼šæŒ‚æ‰ï¼Œä½†æ˜¯ä¸»çº¿ç¨‹å¡æ­»äº†ï¼Œå­çº¿ç¨‹ä»ç„¶åœ¨ç»§ç»­ã€‚å…¶å®åœ¨<code>CPU</code>çœ¼é‡Œï¼Œä¸»çº¿ç¨‹å’Œå…¶ä»–å­çº¿ç¨‹ä¸€æ ·ï¼Œä¸€æ ·å¯ä»¥å¼ºé€€</p>
<p>iOSé‡Œæœ‰ä¸ª<code>peformSelector</code>æ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹</p>
<pre><code>- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event {    
    FN_Thread *thread = [[FN_Thread alloc] initWithBlock:^{
        NSLog(@&quot;touch&quot;);
    }];
    [thread start];
    [self performSelector:@selector(performMethod) onThread:thread withObject:nil     waitUntilDone:NO];
}

- (void)performMethod {
    NSLog(@&quot;performMethod&quot;);
}
</code></pre><p>è¿™æ—¶å€™ä½ ä¼šå‘ç°<code>performMethod</code>æ–¹æ³•æ ¹æœ¬å°±æ²¡èµ°ï¼Œ<code>performSelector</code>å°±æ˜¯çº¿ç¨‹é—´çš„é€šä¿¡ï¼Œ<code>performMethod</code>æ˜¯åœ¨å­çº¿ç¨‹<code>thread</code>ä¸Šæ‰§è¡Œçš„ï¼Œ<code>thread</code>çº¿ç¨‹çš„<code>block</code>ä»£ç èµ°å®Œçº¿ç¨‹å°±æŒ‚äº†ï¼Œæ‰€ä»¥ä¸ä¼šèµ°è¿›<code>performMethod</code>æ–¹æ³•ï¼Œéœ€è¦åŠ ä¸Šä¸‹é¢è¿™å¥ä»£ç ä¿ä½å­çº¿ç¨‹çš„ç”Ÿå‘½</p>
<pre><code>[[NSRunLoop currentRunLoop] runUntilDate:[NSDate dateWithTimeIntervalSinceNow:5]];
</code></pre><p>è¿™é‡Œçš„<code>performSelector</code>äº‹ä»¶å°±æ˜¯ä¸Šé¢æåˆ°çš„<code>RunLoop</code>å¤„ç†çš„<code>Source</code>äº‹ä»¶æºã€‚å¦‚æœæ˜¯<code>performSelectorOnMainThread</code>æ–¹æ³•å°±ä¸éœ€è¦å¼€å¯<code>RunLoop</code>,å› ä¸ºä¸»çº¿ç¨‹çš„<code>RunLoop</code>åœ¨ç¨‹åºå¯åŠ¨ä¹‹æ—¶å°±å·²ç»é»˜è®¤å¼€å¯äº†</p>
<p><code>NSTimer</code>ä½œä¸ºå®šæ—¶å™¨æœ‰æ—¶å€™å¹¶ä¸æ˜¯ååˆ†ç²¾å‡†çš„ï¼Œå¯èƒ½ä¼šå—åˆ°<code>RunLoop</code>çš„è¿è¡Œæ¨¡å¼çš„å½±å“ï¼Œå†åŠ ä¸Šå…¶æœ¬èº«çš„ç²¾åº¦æœ‰é™, å¯ä»¥ä½¿ç”¨<code>GCD</code>çš„å®šæ—¶å™¨ä½œä¸ºä»£æ›¿ï¼Œç²¾åº¦æ›´é«˜ï¼Œä¸”ä¸ä¼šå—åˆ°<code>RunLoop</code>çš„å½±å“ï¼Œå› ä¸ºå…¶æ˜¯åŸºäºCè¯­è¨€çš„</p>
<pre><code>int count = 0;
- (void)GCDTimer {
    // è·å¾—é˜Ÿåˆ—
    dispatch_queue_t queue = dispatch_get_main_queue(); //     dispatch_get_global_queue(0, 0);
    // åˆ›å»ºå®šæ—¶å™¨
    dispatch_source_t timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue);
    self.timer = timer;
    dispatch_time_t start = dispatch_time(DISPATCH_TIME_NOW, 3.0 * NSEC_PER_SEC);
    uint64_t interval = (uint64_t)(1.0 * NSEC_PER_SEC);
    dispatch_source_set_timer(timer, start, interval, 0);
    dispatch_source_set_event_handler(timer, ^{
        NSLog(@&quot;count=%zd&quot;,count);
        count++;
    });
    // å¯åŠ¨å®šæ—¶å™¨
    dispatch_resume(timer);
    // å–æ¶ˆå®šæ—¶å™¨
    //dispatch_cancel(self.timer);
}
</code></pre><p>ä¸Šé¢æåˆ°äº†<code>RunLoop</code>ä¸­çš„<code>Timer</code>å’Œ<code>Source</code>,è¿˜æœ‰ä¸€ä¸ª<code>Observer</code>ï¼Œç›‘å¬è€…ï¼Œæ˜¯ç”¨æ¥ç›‘å¬<code>RunLoop</code>æ‰€å¤„çš„çŠ¶æ€,<code>OC</code>ä¸­æ— æ³•åˆ›å»ºï¼Œåªèƒ½ä½¿ç”¨Cè¯­è¨€</p>
<pre><code>- (void)addOberser {
    CFRunLoopObserverRef observer = CFRunLoopObserverCreateWithHandler(CFAllocatorGetDefault(), kCFRunLoopAllActivities, YES, 0, ^(CFRunLoopObserverRef observer, CFRunLoopActivity activity) {
        NSLog(@&quot;activity = %zd&quot;, activity);
    });
    CFRunLoopAddObserver(CFRunLoopGetCurrent(), observer,     kCFRunLoopDefaultMode);
    CFRelease(observer);
}
</code></pre><p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_04.png" alt=""></p>
<p>å¯ä»¥çœ‹åˆ°<code>RunLoop</code>çš„è¿è¡Œé€»è¾‘ï¼Œæ¯æ¬¡éƒ½æ˜¯ä»ç¡çœ ä¸­å”¤é†’ï¼Œå¤„ç†ä¸€äº›äº‹ä»¶ï¼Œæœ€åå¤„äºä¼‘çœ çŠ¶æ€ã€‚ç›‘å¬çŠ¶æ€å˜åŒ–çš„<code>block</code>ä¸­å¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚å®šä¹‰ä¸€äº›å¤„ç†äº‹ä»¶</p>
<p>åœ¨é¡¹ç›®ä¸­ç»å¸¸ä¼šé‡åˆ°åŠ è½½å›¾ç‰‡çš„éœ€æ±‚ï¼Œç°åœ¨ä¸€èˆ¬éƒ½ä½¿ç”¨<code>SDWebImage</code>åº“ï¼Œå¦‚æœä¸ä½¿ç”¨è¿™ä¸ªåº“æ€ä¹ˆå¤„ç†ï¼Ÿ</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_06.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_05.png" alt=""></p>
<p>ä¸»è¦é€»è¾‘å°±æ˜¯å°†ä¸€ä¸ªä¸ªå›¾ç‰‡ä¸‹è½½ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ï¼Œä¸‹è½½æˆåŠŸå­˜å…¥å†…å­˜ç¼“å­˜ï¼Œç„¶åå†™å…¥æ²™ç›’ï¼Œä¸‹æ¬¡å†æ¬¡æ˜¾ç¤ºæ—¶å…ˆä»å†…å­˜ç¼“å­˜é‡Œè·å–ï¼Œè·å–ä¸åˆ°åˆ™ä»æ²™ç›’è·å–ï¼Œä¾ç„¶è·å–ä¸åˆ°åˆ™è¿›è¡Œä¸‹è½½ä»»åŠ¡ã€‚å…¶å®ä½¿ç”¨<code>SDWebImage</code>åº“ä¹Ÿä¾ç„¶ä¼šè¿›è¡Œè¿™äº›æ“ä½œã€‚</p>
<p>å¦‚æœï¼Œè¿™äº›ä¸‹è½½çš„å›¾ç‰‡éå¸¸çš„å¤§ï¼Œåˆ†è¾¨ç‡æ¯”è¾ƒé«˜ï¼Œä½ ä¼šå‘ç°è¿™æ—¶å€™æ»‘åŠ¨çš„æ—¶å€™ä¼šæœ‰æ˜æ˜¾å¡é¡¿ï¼Œæ˜¯å› ä¸ºå³ä¾¿ä¸‹è½½æ˜¯åœ¨å­çº¿ç¨‹ï¼Œä½†æ˜¯åœ¨æ¸²æŸ“çš„æ—¶å€™å›¾ç‰‡ä¼šè§£å‹ç¼©ï¼Œè¿™æ˜¯åœ¨ä¸»çº¿ç¨‹è¿›è¡Œçš„ï¼Œæ˜¯ä¸ªè€—æ—¶çš„æ“ä½œï¼Œå›¾ç‰‡åˆ†è¾¨ç‡é«˜çš„æƒ…å†µä¸‹å¡é¡¿å°¤å…¶æ˜æ˜¾ã€‚è¿™äº›ä¸‹è½½ä¸‹æ¥çš„å›¾ç‰‡æ˜¯åœ¨ä¸€æ¬¡<code>RunLoop</code>å¾ªç¯çš„æ—¶å€™æ¸²æŸ“æ˜¾ç¤ºï¼Œå¦‚æœä¸€æ¬¡<code>RunLooop</code>å¾ªç¯åªå¤„ç†ä¸€å¼ å›¾ç‰‡ï¼Œå¡é¡¿å°±ä¼šå¾—åˆ°æœ‰æ•ˆè§£å†³ï¼Œè¿™éœ€è¦ç”¨åˆ°<code>Observer</code>æ¥ç›‘å¬<code>RunLoop</code>çš„çŠ¶æ€ï¼Œ<code>RunLoop</code>åœ¨å¤„ç†å®Œäº‹ä»¶ä¼šè¿›å…¥ä¼‘çœ çŠ¶æ€ï¼Œé‚£å°±æ¯æ¬¡ç›‘å¬åœ¨<code>RunLoop</code>è¿›å…¥ä¼‘çœ çŠ¶æ€å‰å¤„ç†è¿™äº›å›¾ç‰‡ï¼Œç›´åˆ°æ²¡æœ‰å›¾ç‰‡å¤„ç†ç„¶åè¿›å…¥ä¼‘çœ çŠ¶æ€</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_08.png" alt=""></p>
<p><a href="https://github.com/ChinaFishNews/RunLoopDemo" target="_blank" rel="external">RunLoopDemo</a></p>
<p><a href="https://github.com/ChinaFishNews/LoadManyPictures" target="_blank" rel="external">LoadManyPictures</a></p>
<p><a href="https://github.com/ChinaFishNews/LoadBigImage" target="_blank" rel="external">LoadBigImage</a></p>
<hr>
<p>å¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–é—®é¢˜è¯·è”ç³»æˆ‘:fishnewsdream@gmail.com,æ¬¢è¿äº¤æµï¼Œå…±åŒæé«˜ï¼</p>
<p>Objective-C/SwiftæŠ€æœ¯å¼€å‘äº¤æµç¾¤201556264ï¼Œè®¨è®ºä½•ç§æŠ€æœ¯å¹¶ä¸å—é™ï¼Œæ¬¢è¿å„ä½å¤§ç‰›ç™¾å®¶äº‰é¸£ï¼</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">åˆšåˆšåœ¨çº¿å·¥ä½œå®¤</a>ï¼Œæ¬¢è¿å…³æ³¨æˆ–æå‡ºå»ºè®¾æ€§æ„è§ï¼</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">åˆšåˆšåœ¨çº¿è®ºå›</a>, æ¬¢è¿è¸Šè·ƒæé—®æˆ–è§£ç­”ï¼</p>
<p>å¦‚æœ‰è½¬è½½ï¼Œè¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RunLoop-CFRunLoopRef/">RunLoop,CFRunLoopRef</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/è¿›é˜¶/">è¿›é˜¶</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-å¤æ‚UITableViewçš„ç›¸å…³ä¼˜åŒ–" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/02/02/å¤æ‚UITableViewçš„ç›¸å…³ä¼˜åŒ–/" class="article-date">
  	<time datetime="2018-02-01T16:00:00.000Z" itemprop="datePublished">2018-02-02</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/02/å¤æ‚UITableViewçš„ç›¸å…³ä¼˜åŒ–/">å¤æ‚UITableViewçš„ç›¸å…³ä¼˜åŒ–</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><br></p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=536502758&auto=0&height=66"></iframe>


<p>ä»…åšè®°å½•ä½¿ç”¨ï¼Œä¼šæ¯”è¾ƒç²—ç³™ï¼Œä¸è¿‡å¤šæ¢è®¨ï¼</p>
<p><code>iOS</code>å¼€å‘ä¸­ï¼Œ<code>UITableView</code>å­˜åœ¨äºå‡ ä¹æ¯ä¸€ä¸ªåº”ç”¨ä¸­ã€‚ä¸æ˜¯é‚£ä¹ˆå¤æ‚çš„<code>UITableView</code>ä½¿ç”¨å¸¸è§„å†™æ³•æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯å¯¹äºå¤æ‚ä¸šåŠ¡ä¸€ä¸ª<code>UITableView</code>ä¸­å­˜åœ¨å‡ åä¸ªä¸åŒçš„<code>UITableViewCell</code>ï¼Œå†ä½¿ç”¨å¸¸è§„å†™æ³•ç®€ç›´å°±æ˜¯ç¾éš¾ï¼Œæœ‰äº›å†™æ³•æ€§èƒ½ä¸Šå¹¶æ— é—®é¢˜ï¼Œä½†æ˜¯ä¼˜é›…åº¦ä¸å¤Ÿï¼Œç»´æŠ¤æ€§è¾ƒå·®ã€‚ä»¥ä¸‹ä»å‡ ç‚¹é˜è¿°ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œå¤šæ˜¯å›¾ç‰‡</p>
<h3 id="UITableVIewCell_u7684_u521B_u5EFA"><a href="#UITableVIewCell_u7684_u521B_u5EFA" class="headerlink" title="UITableVIewCellçš„åˆ›å»º"></a><code>UITableVIewCell</code>çš„åˆ›å»º</h3><ol>
<li>æ¯ä¸ªcellå¯¹åº”ä¸€ä¸ªviewModel</li>
</ol>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_11.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_35.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_10.png" alt=""></p>
<p>2.æ¯ä¸ªsectionå¯¹åº”ä¸€ä¸ªviewModel</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_12.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_13.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_14.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_15.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_16.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_17.png" alt=""></p>
<h4 id="UITableViewCell_u4E0A_u7684UITextField"><a href="#UITableViewCell_u4E0A_u7684UITextField" class="headerlink" title="UITableViewCellä¸Šçš„UITextField"></a><code>UITableViewCell</code>ä¸Šçš„<code>UITextField</code></h4><ol>
<li>æå‰åˆ›å»º<code>cell</code>,ä¸ºå½“å‰<code>cell</code>ä¸Šçš„<code>textField</code>æŒ‡å®šå¥½ä¸‹ä¸€ä¸ªå“åº”è€…</li>
</ol>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_18.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_19.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_20.png" alt=""></p>
<p>2.éå†è·å–æ‰€æœ‰å¯å“åº”é”®ç›˜çš„<code>textField</code></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_22.png" alt=""></p>
<pre><code>    #import &quot;UIView+NextKeyBoard.h&quot;

@implementation UIView (NextKeyBoard)

/** è·å–å½“å‰è§†å›¾æ‰€æœ‰å¯ä»¥å“åº”é”®ç›˜çš„textFieldæˆ–textView */
- (NSArray *)lvdeepResponderViews {
    NSMutableArray&lt;UIView*&gt; *textFields = [[NSMutableArray alloc] init];
    CGFloat height = self.frame.size.height;
    if (height &gt; 1 &amp;&amp; self.hidden == NO) {
        for (UIView *textField in self.subviews) {
            if ((textField) &amp;&amp; [textField lvcanBecomeFirstResponder] &amp;&amp; [textField isUserInteractionEnabled] &amp;&amp; ![textField isHidden] &amp;&amp; [textField alpha] != 0.0) {
                [textFields addObject:textField];
            }

            if (textField.subviews.count &amp;&amp; [textField isUserInteractionEnabled] &amp;&amp; ![textField isHidden] &amp;&amp; [textField alpha]!= 0.0) {
                [textFields addObjectsFromArray:[textField lvdeepResponderViews]];
            }
        }
    }

    // æŒ‰ç…§ä½ç½®yæ’åº å¦‚æœyç›¸ç­‰ åˆ™æŒ‰ç…§xçš„å¤§å°æ’åº
    return [textFields sortedArrayUsingComparator:^NSComparisonResult(UIView *view1, UIView *view2) {

        CGRect frame1 = [view1 convertRect:view1.bounds toView:self];
        CGRect frame2 = [view2 convertRect:view2.bounds toView:self];

        CGFloat x1 = CGRectGetMinX(frame1);
        CGFloat y1 = CGRectGetMinY(frame1);
        CGFloat x2 = CGRectGetMinX(frame2);
        CGFloat y2 = CGRectGetMinY(frame2);

        if (y1 &lt; y2) {
            return NSOrderedAscending;
        } else if (y1 &gt; y2) {
            return NSOrderedDescending;
        } else if (x1 &lt; x2) {
            return NSOrderedAscending;
        } else if (x1 &gt; x2) {
            return NSOrderedDescending;
        } else {
            return NSOrderedSame;
        }
    }];
    return textFields;
}

/** åˆ¤æ–­å½“å‰çš„è¾“å…¥æ§ä»¶æ˜¯å¦å¯ä»¥æœ‰è¾“å…¥å“åº”çš„äº‹ä»¶ */
- (BOOL)lvcanBecomeFirstResponder {
    BOOL canBecomeFirstResponder = NO;
    if ([self isKindOfClass:[UITextField class]]) {
        canBecomeFirstResponder = [(UITextField*)self isEnabled];
    } else if ([self isKindOfClass:[UITextView class]]) {
        canBecomeFirstResponder = [(UITextView*)self isEditable];
    }

    if (canBecomeFirstResponder) {
        canBecomeFirstResponder = ([self isUserInteractionEnabled] &amp;&amp; ![self isHidden] &amp;&amp; [self alpha] != 0.0 &amp;&amp; ![self isAlertViewTextField]  &amp;&amp; ![self isSearchBarTextField]);
    }

    return canBecomeFirstResponder;
}

- (BOOL)isAlertViewTextField {
    UIResponder *alertViewController = [self lvviewController];
    BOOL isAlertViewTextField = NO;
    while (alertViewController &amp;&amp; isAlertViewTextField == NO) {
        if ([alertViewController isKindOfClass:[UIAlertController class]]) {
            isAlertViewTextField = YES;
            break;
        }

        alertViewController = [alertViewController nextResponder];
    }
    return isAlertViewTextField;
}

- (BOOL)isSearchBarTextField {
    UIResponder *searchBar = [self nextResponder];
    BOOL isSearchBarTextField = NO;
    while (searchBar &amp;&amp; isSearchBarTextField == NO) {
        if ([searchBar isKindOfClass:[UISearchBar class]]) {
            isSearchBarTextField = YES;
            break;
        } else if ([searchBar isKindOfClass:[UIViewController class]]) {
            break;
        }

        searchBar = [searchBar nextResponder];
    }
    return isSearchBarTextField;
}

- (UIViewController *)lvviewController {
    UIResponder *nextResponder =  self;
    do {
        nextResponder = [nextResponder nextResponder];
        if ([nextResponder isKindOfClass:[UIViewController class]]) {
            return (UIViewController*)nextResponder;
        }
    } while (nextResponder != nil);
    return nil;
}

@end
</code></pre><h3 id="UITableviewCell_u9AD8_u5EA6_u8BA1_u7B97"><a href="#UITableviewCell_u9AD8_u5EA6_u8BA1_u7B97" class="headerlink" title="UITableviewCellé«˜åº¦è®¡ç®—"></a><code>UITableviewCell</code>é«˜åº¦è®¡ç®—</h3><ol>
<li><p>æå‰åˆ›å»ºå¥½çš„<code>cell</code>ç›´æ¥è·å–cellçš„é«˜åº¦ (é€‚ç”¨äºç›¸åŒæ ·å¼<code>cell</code>æ•°é‡ç›¸å¯¹è¾ƒå°‘çš„æƒ…å†µ,å¯¹åº”ä¸Šé¢çš„æ¯ä¸ª<code>section</code>å¯¹åº”ä¸€ä¸ª<code>viewModel</code>æƒ…å†µ)</p>
</li>
<li><p>é€šè¿‡åè®®æˆ–è€…ä¸Šå›¾å±•ç¤ºçš„viewModel,æå‰è®¡ç®—å¥½<code>cell</code>çš„é«˜åº¦å¹¶ç¼“å­˜</p>
</li>
</ol>
<h3 id="UITableviewCell_u5E03_u5C40"><a href="#UITableviewCell_u5E03_u5C40" class="headerlink" title="UITableviewCellå¸ƒå±€"></a><code>UITableviewCell</code>å¸ƒå±€</h3><ol>
<li>æ¯ä¸ª<code>section</code>å¯¹åº”ä¸€ä¸ª<code>viewModel</code>æƒ…å†µ</li>
</ol>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_23.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_24.png" alt=""></p>
<p>2.æ¯ä¸ª<code>cell</code>å¯¹åº”ä¸€ä¸ª<code>model</code>å¯¹è±¡</p>
<h3 id="UITableviewCell_u4E0A_u4E8B_u4EF6_u54CD_u5E94"><a href="#UITableviewCell_u4E0A_u4E8B_u4EF6_u54CD_u5E94" class="headerlink" title="UITableviewCellä¸Šäº‹ä»¶å“åº”"></a><code>UITableviewCell</code>ä¸Šäº‹ä»¶å“åº”</h3><p>1.<code>delegate</code>,<code>block</code>,<code>RacSubject</code></p>
<p>2.ä½¿ç”¨å“åº”è€…é“¾<code>ResponderChain</code></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_26.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_27.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_28.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_29.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_30.png" alt=""></p>
<h3 id="u5185_u5B58_u95EE_u9898"><a href="#u5185_u5B58_u95EE_u9898" class="headerlink" title="å†…å­˜é—®é¢˜"></a>å†…å­˜é—®é¢˜</h3><p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_31.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_32.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_33.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2018_04_06_34.png" alt=""></p>
<p>ä»¥ä¸Š</p>
<hr>
<p>å¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–é—®é¢˜è¯·è”ç³»æˆ‘:fishnewsdream@gmail.com,æ¬¢è¿äº¤æµï¼Œå…±åŒæé«˜ï¼</p>
<p>Objective-C/SwiftæŠ€æœ¯å¼€å‘äº¤æµç¾¤201556264ï¼Œè®¨è®ºä½•ç§æŠ€æœ¯å¹¶ä¸å—é™ï¼Œæ¬¢è¿å„ä½å¤§ç‰›ç™¾å®¶äº‰é¸£ï¼</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">åˆšåˆšåœ¨çº¿å·¥ä½œå®¤</a>ï¼Œæ¬¢è¿å…³æ³¨æˆ–æå‡ºå»ºè®¾æ€§æ„è§ï¼</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">åˆšåˆšåœ¨çº¿è®ºå›</a>, æ¬¢è¿è¸Šè·ƒæé—®æˆ–è§£ç­”ï¼</p>
<p>å¦‚æœ‰è½¬è½½ï¼Œè¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/UITableView-ResponderChain/">UITableView,ResponderChain</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/OC/">OC</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2017" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/12/30/2017/" class="article-date">
  	<time datetime="2017-12-29T16:00:00.000Z" itemprop="datePublished">2017-12-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/30/2017/">2017</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><br></p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=526468316&auto=0&height=66"></iframe>


<p>æœ‰äººé—®æˆ‘ï¼Œ2017å¹´ä½ è¿‡å¾—è¿˜å¥½å—</p>
<p>ä»€ä¹ˆå«å¥½ï¼Œä»€ä¹ˆå«ä¸å¥½ï¼Ÿè¿™è¦çœ‹æ€ä¹ˆæ¯”äº†ï¼Œå¦‚æœè·Ÿè¿‡å»çš„16å¹´15å¹´æ¯”ï¼Œæˆ‘æ•¢è¯´ä¸å¥½å—</p>
<p>ä¸å¥½æ„æ€ï¼Œæˆ‘æ•¢ï¼ç¡®å®ä¸å¥½</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_30_09.jpg" alt=""></p>
<p>æ—©ä¸Šé—¹é’Ÿå‡†æ—¶å“èµ·ï¼Œå¿˜äº†å…³äº†ï¼Œåæ‰‹ä¸€ä¸ªåŠ¨ä½œï¼Œç†Ÿç»ƒå¹²è„†ï¼Œå†é†’æ—¶å·²å¿«ä¸­åˆäº†</p>
<p>æ‰“å¼€å¾®ä¿¡ï¼Œæ‰“å¼€QQï¼ˆåŸè°…æˆ‘è¿˜åœ¨ä½¿ç”¨QQï¼Œåœ¨ä¸‹æ˜¯ä¸ªå¿µæ—§çš„äººï¼‰, éƒ½åœ¨ç‹‚æ™’åå…«å²çš„ç…§ç‰‡ï¼Œæ™’ä¹‹å‰å¯èƒ½è¿˜è¦æ€è€ƒå“ªå¼ ç…§ç‰‡çœ‹èµ·æ¥æ²¡é‚£ä¹ˆå‚»ï¼Œå“ªå¼ çœ‹èµ·æ¥æ›´é’æ˜¥ï¼Œæ™’ä¸ªç…§ç‰‡å¾’å¢ä¸å°‘çƒ¦æ¼</p>
<p>æˆ‘å°±å¥½äº†ï¼Œæ¯•ç«Ÿè¿˜å¾—ä¸¤å¹´æ‰èƒ½åˆ°åå…«å²ï¼Œå˜´è§’ä¸ç»æ„ä¸Šæ‰¬äº†ä¸€ä¸‹ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰å››åäº”åº¦</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_30_01.jpg" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_30_02.jpg" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_30_03.jpg" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_30_04.jpg" alt=""></p>
<p>æŒºå¥½çš„ï¼Œè™½ç„¶ä¸€ä¸ªä¸ªéƒ½åƒæ˜¯åœ¨ç»™è‘¬çˆ±å®¶æ—å¼€å¹´ä¼šï¼Œç¨šå«©é’æ¶©ä½†åˆä¸å¤±æœæ°”ï¼Œåƒæ˜¯åˆšå‡ºç‚‰çš„è›‹ç³•ï¼Œå³ä½¿ä¸å°å¿ƒè¢«äººç”¨æŒ‡å¤´æ‘ä¸‹å»ï¼Œä¹Ÿä¼šå¾ˆå¿«æ¢å¤åˆ°ä¹‹å‰å…‰æ»‘æ— ç—•çš„æ¨¡æ ·</p>
<p>è¿™ç››ä¸–ç¾é¢œï¼Œéš¾ä»¥ç½®ä¿¡</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_30_10.gif" alt=""></p>
<p>æ—¶è‡³å¹´æœ«ï¼Œåˆåˆ°äº†åä¸‹æ¥æ¸…ç®—flagçš„æ—¶å€™äº†</p>
<p>å°½ç®¡ï¼Œæˆ‘ä»¬æ€»æ˜¯èº«ä½“åŠ›è¡Œï¼Œåšå®šä¸”æ‰§ç€çš„åå¤éªŒè¯ç€åŒä¸€ä¸ªçœŸç†ï¼šå½“åˆç«‹ä¸‹çš„flagï¼Œåªæ˜¯ç”¨æ¥æ–¹ä¾¿æ—¥åæ¨å€’çš„</p>
<p>æƒ³èµ·æ›¾ç»æ–—å¿—æ»¡æ»¡ã€æ­£æ°”å‡›ç„¶çš„åœ¨æœ‹å‹åœˆç«‹ä¸‹çš„é‚£äº›flagï¼Œæœ‰æ²¡æœ‰è§‰å¾—ç°åœ¨è„¸ä¸Šæœ‰äº›ç–¼</p>
<p>æ²¡é”™ï¼Œå°±æ˜¯è¿™ä¸ªæ„Ÿè§‰ã€‚ç«‹flagçš„æ—¶å€™æ€»æ˜¯æœ‰ç§èˆæˆ‘å…¶è°çš„å…´å¥‹æ„Ÿæ²¹ç„¶è€Œç”Ÿï¼Œç«‹çš„å¥½çš„è¯å¯èƒ½æ„Ÿè§‰è¿˜æœ‰ç‚¹ç§’ä¸è€Œè¨€ï¼Œä¸æˆ‘è€Œè¨€ï¼Œé€šå¸¸å¸…ä¸è¿‡ä¸‰ç§’</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_30_07" alt=""></p>
<p>å…¶å®åœ¨æœ‹å‹åœˆ<del>æ‰“å˜´ç‚®</del>ç«‹flagè¿™äº‹å„¿ï¼Œä¸å¿…å¤ªåœ¨æ„ï¼Œæ¯•ç«Ÿç”Ÿæ´»é‡Œæ€»æ˜¯éœ€è¦å¤§å¤§å°å°çš„ä»ªå¼æ„Ÿå’Œç›®æ ‡æ¥çº¦æŸæ”¾çºµçš„è‡ªå·±</p>
<p>å¹´è½»æ—¶æˆ‘ç«‹ä¸‹äº†æ— æ•°flagï¼Œå°±å¦‚åŒæˆ‘è¯´è¿‡æƒ³æˆ’ç†¬å¤œä¸€æ ·å¤šï¼Œæ­£æ˜¯è¿™äº›flagçš„å­˜åœ¨æ‰è®©æˆ‘æˆä¸º<del>æ›´å¥½</del>ç°åœ¨çš„è‡ªå·±</p>
<p>â€œè¿™æ¬¡è€ƒè¯•æ€ä¹ˆä¹Ÿè¦æ‹¿ä¸ªç¬¬ä¸€åï¼Œå†ä¸æµä¹Ÿè¦å‰ä¸‰â€</p>
<p>â€œå¤§å­¦éæ¸…åŒ—ä¸ä¸Šï¼Œå†ä¸æµä¹Ÿè¦985ã€211â€</p>
<p>â€œæˆ‘è¦è¿æ‹¿å››å¹´å¥–å­¦é‡‘ï¼Œè¿™ä¸æ˜¯å¼€ç©ç¬‘â€</p>
<p>â€œä»Šå¹´è¦å†çœ‹åæœ¬çº¸è´¨ä¹¦ï¼Œè¯»ä¹¦ä½¿æˆ‘å¿«ä¹â€</p>
<p>â€œæˆ‘è¦å¼€å§‹ç‚«â€˜è…¹â€™ï¼Œç»ƒå‡ºå…«å—è…¹è‚Œï¼Œè®©è¿åŠ¨æˆä¸ºä¸€ç§ä¹ æƒ¯ï¼Œå¥èº«æˆä¸ºä¸€ç§æ—¥å¸¸â€</p>
<p>â€œæˆ‘è¦è®©ä½™å¤ªä¸ä»…å‚æ¶ä¸æˆ‘çš„æ‰åï¼Œæ›´è¦æ‹œå€’åœ¨æˆ‘çš„å¨è‰ºä¹‹ä¸‹â€</p>
<p>â€œä¸–ç•Œè¿™ä¹ˆå¤§ï¼Œæˆ‘è¦å»çœ‹çœ‹ï¼Œæˆ‘è¦å¸¦ä½™å¤ªå»æµªæ¼«çš„åœŸè€³å…¶ï¼Œå»çœ‹æ›´å¹¿é˜”çš„ä¸–ç•Œâ€</p>
<p>â€œè¿™ä¸ªåŒåä¸€æˆ‘å°±çœ‹çœ‹ä»€ä¹ˆéƒ½ä¸ä¹°â€</p>
<p>â€œæ•™å¸ˆèµ„æ ¼è¯ã€é“¶è¡Œä»ä¸šèµ„æ ¼è¯ã€è¯åˆ¸èµ„æ ¼è¯ï¼Œä¸€è¯åœ¨æ‰‹ï¼Œå¤©ä¸‹æˆ‘æœ‰â€</p>
<p>â€œæ¯å¤©ä¸“ä¸šæŠ€èƒ½å­¦ä¹ ï¼Œè°ä¹Ÿä¸èƒ½é˜»æ­¢æˆ‘å­¦ä¹ çš„è„šæ­¥â€</p>
<p>â€œæ¯å¤©æ—©ç‚¹ç¡ï¼Œæ—©èµ·ä¸¤å°æ—¶â€</p>
<p>â€œä»Šå¹´å…ˆæŒ£å®ƒä¸€ä¸ªäº¿ï¼Œç›®æ ‡ä¸åœ¨å°ï¼Œåœ¨äºç§¯ç´¯â€</p>
<p>â€¦.</p>
<p>è¿™å“ªæ˜¯ç«‹flagå•Šï¼Œæœ‰äº›å°±æ˜¯åœ¨ç™½æ—¥åšæ¢¦</p>
<p>é²è¿…è¯´è¿‡ï¼šâ€œä¸€åƒä¸ªäººæœ‰ä¸€åƒä¸ªflag,å€’æˆ–è€…ä¸å€’ï¼Œå®ƒéƒ½åœ¨é‚£é‡Œï¼Œè§è¯ä½ çš„é…¸ç”œè‹¦è¾£â€</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_30_06" alt=""></p>
<p>ä¸ç®¡æ›¾ç»ç«‹ä¸‹çš„flagï¼Œæ˜¯ä¾ç„¶å±¹ç«‹åœ¨é£ä¸­ï¼Œè¿˜æ˜¯å·²ç»é£˜ç„¶å€’ä¸‹ï¼Œä½†ä¸å¯å¦è®¤çš„æ˜¯ä¸€ç›´åœ¨è¿›æ­¥ï¼Œåªæ˜¯ç¦»é¢„æœŸç›®æ ‡è¿˜æœ‰ç‚¹è¿œè€Œå·²</p>
<p>æ—¢ç„¶æœ‰äº›ä¸œè¥¿å¿…é¡»è¦ç»å†ï¼Œåˆä½•å¿…ç•æ‰‹ç•è„šï¼Ÿéƒ½æ˜¯æœ‰æ•…äº‹çš„äººï¼Œè°èƒ½è¾“ç»™è°</p>
<p>æƒ³æˆ‘17å¹´ç«‹çš„å‡ ä¸ªflagï¼Œç®€å•ã€æ˜“å®ç°ã€æ²¡éš¾åº¦ã€‚é¢„è®¡å­˜æ¬¾ä¸€ä¸‡ï¼Œç»“æœè´Ÿå€ºä¹ä¸‡, è¿˜å·®åä¸‡å°±è¾¾æ ‡äº†ï¼Œå·®è·ä¸æ˜¯å¾ˆå¤§</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_30_12" alt=""></p>
<p>è®²é“ç†ï¼Œä¸å¿…åœ¨æ„é‚£äº›æ‰“è„¸çš„flagï¼Œæ¯•ç«ŸçœŸæ­£çš„å‹‡å£«ï¼Œæ•¢äºç›´é¢æ‰“è„¸çš„flagï¼Œå±¥ç«‹å±¡ç ´ï¼Œå±¡ç ´å±¡ç«‹</p>
<p>æ–°çš„ä¸€å¹´ï¼Œæˆ‘çš„flagå¾ˆç®€å•</p>
<p>è¿‡å¾—æ¯”17å¹´å¥½å°±è¡Œ</p>
<p>å¦‚æœæ²¡åšåˆ°ï¼Œæ˜å¹´æˆ‘è¿˜å¾—è¿™ä¹ˆç«‹</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_30_14" alt=""></p>
<p>çœ‹èµ·æ¥éƒ½ä¸€ç‰‡æ­Œèˆå‡å¹³ï¼Œè…¾è®¯æ–°é—»å¾ˆåˆæ—¶æœºçš„æ¨é€äº†ä¸‰åˆ†é’Ÿçš„2017å¤§äº‹ä»¶</p>
<p>æ—¢æœ‰â€ä¸­å›½é¦–è‰˜å›½äº§èˆªæ¯ä¸‹æ°´â€ã€â€å›½äº§å¤§é£æœºC919æˆåŠŸé¦–é£â€ç­‰æŒ¯å¥‹å›½äººçš„æˆå°±ï¼Œåˆæœ‰â€æ­å·ä¿å§†çºµç«æ¡ˆâ€ã€â€æ±Ÿå“¥æ¡ˆâ€ç­‰è®©äººæ‰¼è…•å¹æ¯çš„æ‚²å‰§</p>
<p>æ¯å¹´çš„è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘è§‰å¾—æœ‰ç¯‡æ–‡ç« éƒ½å€¼å¾—æˆ‘ä»¬åå¤è¯µè¯»ï¼Œæ°¸è¿œè‡´æ•¬</p>
<p>åŸæ–‡åˆŠç™»äº1999å¹´çš„ã€Šå—æ–¹å‘¨æœ«ã€‹ï¼Œé¢˜ä¸ºã€Šæ€»æœ‰ä¸€ç§åŠ›é‡è®©ä½ æ³ªæµæ»¡é¢ã€‹ï¼Œåˆ«è¯´æˆ‘æ²¡å‘Šè¯‰ä½ </p>
<p>ç™»è¿‡é¡¶å³°æ–¹çŸ¥åˆå¿ƒå¯è´µï¼Œæœ‰è¿‡ä½è°·æ›´çŸ¥äººé—´å†·æš–</p>
<p>æ²¡æœ‰è°èƒ½ç•™ä½æ—¶é—´ï¼Œå”¯æœ‰åŠªåŠ›æ‰ä¸ä¼šè®©å…‰é˜´è™šåº¦</p>
<p>å†è§2017</p>
<p>æ‚¨å¥½2018</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_30_11" alt=""></p>
<hr>
<p>å¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–é—®é¢˜è¯·è”ç³»æˆ‘:fishnewsdream@gmail.com,æ¬¢è¿äº¤æµï¼Œå…±åŒæé«˜ï¼</p>
<p>Objective-C/SwiftæŠ€æœ¯å¼€å‘äº¤æµç¾¤201556264ï¼Œè®¨è®ºä½•ç§æŠ€æœ¯å¹¶ä¸å—é™ï¼Œæ¬¢è¿å„ä½å¤§ç‰›ç™¾å®¶äº‰é¸£ï¼</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">åˆšåˆšåœ¨çº¿å·¥ä½œå®¤</a>ï¼Œæ¬¢è¿å…³æ³¨æˆ–æå‡ºå»ºè®¾æ€§æ„è§ï¼</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">åˆšåˆšåœ¨çº¿è®ºå›</a>, æ¬¢è¿è¸Šè·ƒæé—®æˆ–è§£ç­”ï¼</p>
<p>å¦‚æœ‰è½¬è½½ï¼Œè¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/éšç¬”/">éšç¬”</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-ReactiveCocoaæ¢ç©¶-ç¼–ç¨‹æ€æƒ³" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/11/26/ReactiveCocoaæ¢ç©¶-ç¼–ç¨‹æ€æƒ³/" class="article-date">
  	<time datetime="2017-11-25T16:00:00.000Z" itemprop="datePublished">2017-11-26</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/26/ReactiveCocoaæ¢ç©¶-ç¼–ç¨‹æ€æƒ³/">ReactiveCocoaæ¢ç©¶-ç¼–ç¨‹æ€æƒ³</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><br></p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=30482048&auto=0&height=66"></iframe>

<p>è°ˆåˆ°ReactiveCocoa(RAC),è¯´å®ƒæ¯”è¾ƒç«ä¼¼ä¹ä¹Ÿæ²¡æœ‰é‚£ä¹ˆç«ï¼Œä¸€äº›å¤§å‚ç”¨çš„ä¹Ÿå¹¶ä¸å¤šï¼Œè¯´å®ƒä¸ç«è²Œä¼¼åˆç»å¸¸çœ‹åˆ°æˆ–å¬åˆ°ä¸€äº›é¼“å¹RACçš„æ–‡ç« å’Œè¨€è®ºã€‚å°½ç®¡å®ƒå¾ˆå¼ºå¤§ï¼Œä½†æ˜¯ä¹Ÿå¹¶æ²¡æœ‰å¾ˆæ™®åŠï¼Œå³ä¾¿å®ƒå¾ˆå¼ºå¤§ï¼</p>
<p>åœ¨äº†è§£ReactiveCocoaå‰ï¼Œå…ˆç®€å•ç²—ç•¥å›é¡¾ä¸€ä¸‹blockçš„å‡ ç§å¸¸ç”¨ç”¨æ³•åŠå‡ ç§å¸¸è§çš„ç¼–ç¨‹æ€æƒ³ã€‚</p>
<h3 id="block_u5E38_u7528_u7528_u6CD5"><a href="#block_u5E38_u7528_u7528_u6CD5" class="headerlink" title="blockå¸¸ç”¨ç”¨æ³•"></a>blockå¸¸ç”¨ç”¨æ³•</h3><h4 id="1-_block_u4F5C_u4E3A_u5BF9_u8C61_u7684_u5C5E_u6027"><a href="#1-_block_u4F5C_u4E3A_u5BF9_u8C61_u7684_u5C5E_u6027" class="headerlink" title="1. blockä½œä¸ºå¯¹è±¡çš„å±æ€§"></a>1. blockä½œä¸ºå¯¹è±¡çš„å±æ€§</h4><p>æ–°å»ºä¸€ä¸ªSingleå·¥ç¨‹ï¼Œåˆ›å»ºä¸€ä¸ªPersonç±»ï¼Œåœ¨Personç±»ä¸­å£°æ˜ä¸€ä¸ªblockã€‚ç³»ç»Ÿæœ‰ä¸ªå†…ç½®çš„blockä»£ç å—</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_26_01.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_26_02.png" alt=""></p>
<blockquote>
<p>æ³¨æ„ï¼Œåœ¨éARCç¯å¢ƒä¸‹blockéœ€è¦ä½¿ç”¨copyå£°æ˜ï¼Œä½¿ç”¨copyçš„åŸå› ,æ˜¯æŠŠblockä»æ ˆåŒºæ‹·è´åˆ°å †åŒº,å› ä¸ºæ ˆåŒºä¸­çš„å˜é‡å‡ºäº†ä½œç”¨åŸŸä¹‹åå°±ä¼šè¢«é”€æ¯,æ— æ³•åœ¨å…¨å±€ä½¿ç”¨,æ‰€ä»¥åº”è¯¥æŠŠæ ˆåŒºçš„å±æ€§æ‹·è´åˆ°å †åŒºä¸­å…¨å±€å…±äº«,è¿™æ ·å°±ä¸ä¼šè¢«é”€æ¯äº†,åœ¨MRCæ‰‹åŠ¨ç®¡ç†çš„å°±æ˜¯å †åŒº,ä¸éœ€è¦ç³»ç»Ÿç®¡ç†,MRCç¯å¢ƒå¿…é¡»ä½¿ç”¨copyæŠŠå˜é‡æ‹·è´åˆ°å…¨å±€çš„å †åŒºã€‚è€Œå¦‚æœåœ¨ARCç¯å¢ƒä¸‹å°±å¯ä»¥ä¸ä½¿ç”¨copyä¿®é¥°,å› ä¸ºARCä¸‹çš„å±æ€§æœ¬æ¥å°±åœ¨å †åŒºã€‚æ‰€ä»¥ç°åœ¨åœ¨é»˜è®¤æ˜¯ARCç¯å¢ƒä¸‹ä¾ç„¶æ²¿è¢­äº†ä¹‹å‰çš„ä½¿ç”¨æ–¹å¼copyï¼Œä½¿ç”¨strongä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚</p>
</blockquote>
<p>åœ¨Personç±»ä¸­å£°æ˜ä¸€ä¸ªblock</p>
<pre><code>@property (nonatomic, strong) void(^myBlock)(void);
</code></pre><p>åœ¨æ§åˆ¶å™¨ä¸­æŒæœ‰ä¸€ä¸ªPersonå¯¹è±¡ï¼Œå¹¶å£°æ˜ä¸€ä¸ªblockæ¥å—Personçš„è¿™ä¸ªblockå±æ€§</p>
<pre><code>self.p = [[Person alloc] init];

void(^testBlock)(void) = ^() {

 NSLog(@&quot;block as params&quot;);

    };

self.p.myBlock = testBlock
</code></pre><p>åœ¨ç‚¹å‡»å±å¹•çš„æ—¶å€™å®ç°è¿™ä¸ªblock</p>
<pre><code>self.p.myBlock();
</code></pre><h4 id="2-block_u4F5C_u4E3A_u65B9_u6CD5_u7684_u53C2_u6570"><a href="#2-block_u4F5C_u4E3A_u65B9_u6CD5_u7684_u53C2_u6570" class="headerlink" title="2.blockä½œä¸ºæ–¹æ³•çš„å‚æ•°"></a>2.blockä½œä¸ºæ–¹æ³•çš„å‚æ•°</h4><p>åŒæ ·åœ¨Personç±»ä¸­å£°æ˜ä¸€ä¸ªå¸¦æœ‰blockå‚æ•°çš„æ–¹æ³•å¹¶å®ç°</p>
<pre><code>- (void)eat:(void(^)(NSString *someThing))block;

- (void)eat:(void(^)(NSString * someThing))block {

block(@&quot;delicious&quot;);

}
</code></pre><p>åœ¨æ§åˆ¶å™¨ä¸­è°ƒç”¨,å…¶ä¸­blockä¸­çš„å·²çŸ¥æ•°æ®ç±»å‹çš„å‚æ•°æ˜¯Personå¯¹è±¡æä¾›ç»™å¤–ç•Œä½¿ç”¨çš„ï¼ŒAFNetworingä¸­è¿”å›çš„blockç»“æœå°±æ˜¯å¦‚æ­¤ã€‚</p>
<pre><code>[self.p eat:^(NSString *someThing) {
       NSLog(@&quot;eat %@&quot;,someThing);
   }];
</code></pre><h4 id="3-_u4F5C_u4E3A_u65B9_u6CD5_u7684_u8FD4_u56DE_u503C"><a href="#3-_u4F5C_u4E3A_u65B9_u6CD5_u7684_u8FD4_u56DE_u503C" class="headerlink" title="3.ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼"></a>3.ä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼</h4><p>blockä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼è¿™ç§ç”¨æ³•å¼€å‘ä¸­å…¶å®å¹¶ä¸å¸¸ç”¨ï¼Œä½†æ˜¯ä¸€äº›ç¬¬ä¸‰æ–¹ï¼Œæœ€å…¸å‹çš„å¸¸ç”¨çº¦æŸåº“<br><code>Masonry</code>åº“å°±å°†blockä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼æ¥ä½¿ç”¨ã€‚</p>
<p>åŒæ ·åœ¨Personä¸­å£°æ˜ä¸€ä¸ªrunæ–¹æ³•å¹¶å®ç°,å°†blockä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼</p>
<pre><code>- (void(^)(int m))run;

- (void(^)(int m))run {
    return ^(int m) {
        NSLog(@&quot;run %d&quot;,m);
    };
}
</code></pre><p>åœ¨æ§åˆ¶å™¨æ‰¾é‚£ä¸ªå¯ä»¥è¿™æ ·è°ƒç”¨</p>
<pre><code>- (void)methodTree {
    void(^block)(int m) =  self.p.run;
    block(100);
}
</code></pre><p>å¹¶æ²¡éœ€è¦ä¸€ä¸ªblockå…ˆæ¥æ”¶å†å®ç°ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨</p>
<pre><code>[self.p run](100);
</code></pre><p>æœ‰æ²¡æœ‰è§‰å¾—è¿™ç§è°ƒç”¨æ€ªæ€ªçš„ï¼Œå…¶å®å°±æ˜¯è°ƒç”¨æ–¹æ³•è¿”å›ä¸€ä¸ªblockå†è°ƒç”¨ è¿™ä¸ªblockï¼Œblockçš„è°ƒç”¨æ–¹å¼å°±æ˜¯<code>block()</code></p>
<p>æœ‰æ²¡æœ‰æ›´ç®€å•çš„å†™æ³•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰ï¼</p>
<pre><code>self.p.run(100);
</code></pre><p>ä¸ºä»€ä¹ˆå¯ä»¥ä½¿ç”¨ç‚¹è¯­æ³•è°ƒç”¨ï¼Ÿ</p>
<p>åœ¨OCä¸­åªæœ‰å½¢å¦‚getç±»å‹çš„æ–¹æ³•æ‰å¯ä»¥ä½¿ç”¨ç‚¹è¯­æ³•ç‚¹å‡ºæ¥ï¼Œå¦åˆ™æ˜¯èƒ½ä½¿ç”¨å½¢å¦‚<code>[self run]</code>è¿™ç§åŠ ç©ºæ ¼çš„è°ƒç”¨æ–¹æ³•ã€‚è€Œè¿™ç§å°†blockä½œä¸ºè¿”å›å€¼çš„æ–¹æ³•è¯­æ³•ç±»å‹å’Œgetæ–¹æ³•ç›¸åŒï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ç‚¹è¯­æ³•è°ƒç”¨ï¼Œä½†æ˜¯å¦‚æœå°†blockä½œä¸ºæ–¹æ³•çš„è¿”å›å€¼ï¼Œè€Œä¸”è¿™ä¸ªæ–¹æ³•åˆæœ‰å…¶ä»–å‚æ•°ï¼Œæ˜¯æ— æ³•é€šè¿‡ç‚¹è¯­æ³•è°ƒç”¨çš„ï¼Œå› ä¸ºç³»ç»Ÿåˆ¤æ–­è¿™ä¸æ˜¯getæ–¹æ³•ï¼Œgetæ–¹æ³•æ˜¯æ²¡æœ‰å‚æ•°çš„ã€‚</p>
<p><a href="https://github.com/ChinaFishNews/BlockDemo.git" target="_blank" rel="external">Demoåœ°å€</a></p>
<h3 id="u7F16_u7A0B_u601D_u60F3"><a href="#u7F16_u7A0B_u601D_u60F3" class="headerlink" title="ç¼–ç¨‹æ€æƒ³"></a>ç¼–ç¨‹æ€æƒ³</h3><p>äº†è§£å‡ ç§å¸¸è§„çš„ç¼–ç¨‹æ€æƒ³ï¼Œå¦‚é“¾å¼ç¼–ç¨‹ï¼Œå“åº”å¼ç¼–ç¨‹ï¼Œå‡½æ•°å¼ç¼–ç¨‹ç­‰ã€‚</p>
<h4 id="1-__u94FE_u5F0F_u7F16_u7A0B_u601D_u60F3"><a href="#1-__u94FE_u5F0F_u7F16_u7A0B_u601D_u60F3" class="headerlink" title="1. é“¾å¼ç¼–ç¨‹æ€æƒ³"></a>1. é“¾å¼ç¼–ç¨‹æ€æƒ³</h4><p>é“¾å¼ç¼–ç¨‹å°±æ˜¯å¯ä»¥é€šè¿‡â€ç‚¹â€è¯­æ³•ï¼Œå°†éœ€è¦æ‰§è¡Œçš„ä»£ç å—è¿ç»­çš„ä¹¦å†™ä¸‹å»ï¼Œä½¿å¾—ä»£ç ç®€å•æ˜“è¯»ï¼Œä¹¦å†™æ–¹ä¾¿ã€‚å…¸å‹çš„ä½¿ç”¨é“¾å¼ç¼–ç¨‹æ€æƒ³çš„æœ‰<code>Masonry</code>åº“,é€šè¿‡åˆ†æ<code>Mansory</code>åº“çš„ä½¿ç”¨æœºåˆ¶æ¥äº†è§£ä¸€ä¸‹é“¾å¼ç¼–ç¨‹ã€‚</p>
<p>åŒæ ·æ–°å»ºä¸€ä¸ªSingleå·¥ç¨‹ï¼Œæ·»åŠ ä¸€ä¸ªView</p>
<pre><code>UIView *redView = [[UIView alloc] init];

redView.backgroundColor = [UIColor redColor];

[self.view addSubview:redView];

[redView mas_makeConstraints:^(MASConstraintMaker *make) {

    make.left.top.equalTo(@100);

    make.right.bottom.equalTo(@-100);

}];
</code></pre><p>ä¸Šé¢çš„<code>MASConstraintMaker</code>,æˆ‘ä»¬ç§°ä¹‹ä¸ºçº¦æŸåˆ¶é€ è€…ï¼Œè¿™é‡Œé¢å°±å°†blockä½œä¸ºæ–¹æ³•çš„å‚æ•°æ¥ä½¿ç”¨äº†ï¼Œä¸ºä»€ä¹ˆå¯¹redViewæ·»åŠ çº¦æŸï¼Œè€Œblocké‡Œé¢ä½¿ç”¨çš„ç¡®æ˜¯çº¦æŸåˆ¶é€ è€…å‘¢ï¼Ÿ</p>
<p>ç‚¹è¿›<code>mas_makeConstraints</code>è¿™ä¸ªæ–¹æ³•çœ‹ä¸€çœ‹</p>
<pre><code>- (NSArray *)mas_makeConstraints:(void(^)(MASConstraintMaker *))block {
    self.translatesAutoresizingMaskIntoConstraints = NO;
    MASConstraintMaker *constraintMaker = [[MASConstraintMaker alloc] initWithView:self];
    block(constraintMaker);
    return [constraintMaker install];
}
</code></pre><p>é¦–å…ˆè¿™ä¸ªæ–¹æ³•å…³æ‰äº†è€å¼çš„è‡ªåŠ¨å¸ƒå±€<code>self.translatesAutoresizingMaskIntoConstraints = NO;</code>,é˜²æ­¢å’ŒAutolayoutå†²çª,ç„¶ååˆ›å»ºä¸€ä¸ªçº¦æŸåˆ¶é€ è€…å¹¶è¿”å›ã€‚è€Œåœ¨åˆ›å»ºè¿™ä¸ªçº¦æŸåˆ¶é€ è€…çš„æ—¶å€™å°†selfä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œ<code>[[MASConstraintMaker alloc] initWithView:self];</code>,è€Œè¿™ä¸ªselfå°±æ˜¯redViewï¼Œå³è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨è€…ã€‚åˆ°è¿™ä¸ªæ–¹æ³•é‡Œé¢çœ‹ä¸€ä¸‹</p>
<pre><code>- (id)initWithView:(MAS_VIEW *)view {
    self = [super init];
    if (!self) return nil;

    self.view = view;
    self.constraints = NSMutableArray.new;

    return self;
}
</code></pre><p>å¯è§è¿™ä¸ªçº¦æŸåˆ¶é€ è€…å°†viewä½œä¸ºå±æ€§ç»‘å®šèµ·æ¥äº†ï¼Œåˆ°<code>[constraintMaker install];</code>è¿™ä¸ªæ–¹æ³•é‡Œé¢<br>å¯ä»¥çœ‹åˆ°å°±æ˜¯æˆ‘ä»¬ä¸æ„¿æ„å†™çš„å„ç§<br><code>[NSLayoutConstraint constraintWithItem:
                                        attribute:
                                        relatedBy:
                                           toItem:
                                        attribute:
                                       multiplier:
                                         constant:]</code></p>
<p>é€šè¿‡ä¸Šé¢æµç¨‹æˆ‘ä»¬çŸ¥é“<code>mas_makeConstraints</code>çš„æ‰§è¡Œæµç¨‹</p>
<blockquote>
<p>1.åˆ›å»ºçº¦æŸåˆ¶é€ è€…MASConstraintMaker,å¹¶ä¸”ç»‘å®šæ§ä»¶,ç”Ÿæˆä¸€ä¸ªä¿å­˜æ‰€æœ‰çº¦æŸçš„æ•°ç»„</p>
<p>2.æ‰§è¡Œmas_makeConstraintsä¼ å…¥çš„Block</p>
<p>3.è®©çº¦æŸåˆ¶é€ è€…å®‰è£…çº¦æŸ!</p>
<blockquote>
<p> 3.1 æ¸…ç©ºä¹‹å‰çš„æ‰€æœ‰çº¦æŸ</p>
<p>3.2 éå†çº¦æŸæ•°ç»„,ä¸€ä¸ªä¸€ä¸ªå®‰è£…</p>
</blockquote>
</blockquote>
<p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹blockä¸­çš„ä»£ç <code>make.left.top.equalTo(@100);</code>,è¿™é‡Œä½¿ç”¨çš„å³æ˜¯é“¾å¼ç¼–ç¨‹ï¼Œæˆ‘ä»¬å‘ç°<code>make.left</code>åä¾ç„¶å¯ä»¥<code>.top</code>,<code>.right</code>,ä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·å†™ï¼Ÿç‚¹è¿›å»å¯ä»¥çœ‹åˆ°    </p>
<pre><code>- (MASConstraint *)left {
    return [self addConstraintWithLayoutAttribute:NSLayoutAttributeLeft];
}
</code></pre><p>è¿™æ˜¯ä¸€ä¸ªgetæ–¹æ³•ï¼Œä¸Šæ–‡æœ‰æåˆ°OCä¸­åªæœ‰å½¢å¦‚getæ–¹æ³•æ‰å¯ä»¥ä½¿ç”¨ç‚¹è¯­æ³•ç‚¹å‡ºæ¥ã€‚è€Œè¿™ä¸ªgetæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª<code>MASConstraint</code>ï¼Œä½ ä¼šå‘ç°<code>MASConstraint</code>ç±»ä¸­è¿™äº›å…¨æ˜¯getæ–¹æ³•ï¼Œè€Œè¿”å›å€¼å…¨æ˜¯è°ƒç”¨è€…æœ¬èº«<code>MASConstraint</code></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_26_03.png" alt=""></p>
<p>éšä¾¿ç‚¹è¿›å»ä¸€ä¸ªgetæ–¹æ³•</p>
<pre><code>- (MASConstraint *)addConstraintWithLayoutAttribute:    (NSLayoutAttribute)layoutAttribute {
    NSAssert(!self.hasLayoutRelation, @&quot;Attributes should be     chained before defining the constraint relation&quot;);

    return [self.delegate constraint:self     addConstraintWithLayoutAttribute:layoutAttribute];
}
</code></pre><p>å¯ä»¥å‘ç°éƒ½æ˜¯é€šè¿‡ä»£ç†æ¥å®ç°ï¼Œæœ€ç»ˆè¿”å›çš„æ˜¯ä¸€ä¸ªçº¦æŸ<code>MASConstraint</code>ï¼Œå¹¶æ·»åŠ åˆ°çº¦æŸæ•°ç»„ä¸­,è¿™ä¹Ÿå°±å¯ä»¥è§£é‡Šäº†ä¸ºä»€ä¹ˆ<code>make.left</code>åä¾ç„¶å¯ä»¥<code>.top</code>,<code>.right</code>ç»§ç»­ç‚¹å‡ºæ¥ï¼Œäº‹å®ä¸Šåªè¦ä½ æ„¿æ„ï¼Œä½ å¯ä»¥ä¸€ç›´è¿™ä¹ˆå†™ä¸‹å»ï¼Œå› ä¸ºè¿”å›å€¼éƒ½æ˜¯è¿™äº›æ–¹æ³•çš„è°ƒç”¨è€…ã€‚è€Œè¿™ä¹Ÿæ˜¯é“¾å¼ç¼–ç¨‹æœ€é‡è¦çš„æ€æƒ³ç‰¹ç‚¹ï¼Œå³ï¼š</p>
<h3 id="u65B9_u6CD5_u7684_u8FD4_u56DE_u503C_u5FC5_u987B_u8981_u6709_u65B9_u6CD5_u8C03_u7528_u8005"><a href="#u65B9_u6CD5_u7684_u8FD4_u56DE_u503C_u5FC5_u987B_u8981_u6709_u65B9_u6CD5_u8C03_u7528_u8005" class="headerlink" title="æ–¹æ³•çš„è¿”å›å€¼å¿…é¡»è¦æœ‰æ–¹æ³•è°ƒç”¨è€…"></a>æ–¹æ³•çš„è¿”å›å€¼å¿…é¡»è¦æœ‰æ–¹æ³•è°ƒç”¨è€…</h3><p>ä¸ºä»€ä¹ˆæ˜¯ â€œè¦æœ‰æ–¹æ³•è°ƒç”¨è€…â€è€Œä¸æ˜¯â€œè¦æ˜¯æ–¹æ³•çš„è°ƒç”¨è€…â€å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬æ¥ç€çœ‹<code>make.left.top.equalTo(@100)</code>ä¸­çš„<code>equalTo</code>æ–¹æ³•</p>
<pre><code>- (MASConstraint * (^)(id))equalTo {
    return ^id(id attribute) {
        return self.equalToWithRelation(attribute,     NSLayoutRelationEqual);
    };
}
</code></pre><p>å¯è§ï¼Œè¿™ä¸ª<code>equalTo</code>æ–¹æ³•è¿”å›çš„ä¸æ˜¯æ–¹æ³•è°ƒç”¨è€…ï¼Œè€Œæ˜¯ä¸€ä¸ªè¿”å›å€¼ä¸ºæ–¹æ³•è°ƒç”¨è€…çš„blockã€‚è€Œæˆ‘ä»¬åœ¨è°ƒç”¨<code>equalTo</code>æ–¹æ³•çš„æ—¶å€™ç´§è·Ÿç€åé¢åŠ äº†â€œ(100)â€,ä¹Ÿå°±æ˜¯è¯´è°ƒç”¨äº†è¿™ä¸ªè¿”å›çš„<code>block</code>,<code>bclok</code>æ‰§è¡Œåè¿”å›çš„åˆæ˜¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨è€…<code>MASConstraint</code>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ä½ æ„¿æ„ï¼Œåœ¨<code>make.left.top.equalTo(@100)</code>ä¹‹åï¼Œä½ ä¾ç„¶å¯ä»¥ç»§ç»­è°ƒç”¨<code>get</code>æ–¹æ³•ï¼Œå½¢å¦‚</p>
<p><code>make.left.top.equalTo(@100).right.bottom.equalTo(@-100);</code></p>
<p>åªæ˜¯åœ¨<code>equalTo</code>ä¹‹åç»§ç»­è°ƒç”¨<code>get</code>æ–¹æ³•ï¼Œåé¢çš„çº¦æŸå€¼ä¼šè¦†ç›–æ‰å‰é¢çš„çº¦æŸå€¼ã€‚æ‰€ä»¥ï¼Œç†è®ºä¸Šå¯ä»¥ï¼Œç„¶è€Œå¹¶ä¸åº”è¯¥è¿™ä¹ˆåšã€‚</p>
<h5 id="u90A3_u5982_u679C_u6211_u4EEC_u81EA_u5DF1_u4E5F_u60F3_u73A9_u4E00_u4E2A_u5177_u5907_u94FE_u5F0F_u7F16_u7A0B_u7279_u70B9_u7684_u7C7B_u8BE5_u600E_u4E48_u5199_u5462_uFF1F_u8BB0_u4F4F_uFF0C_u94FE_u5F0F_u7F16_u7A0B_uFF0C_u65B9_u6CD5_u8FD4_u56DE_u503C_u5FC5_u987B_u8981_u6709_u65B9_u6CD5_u8C03_u7528_u8005_u3002_u7136_u540E_u53EF_u4EE5_u53C2_u8003Masonary_u5E93_u7C97_u7565_u73A9_u4E00_u4E0B_u3002"><a href="#u90A3_u5982_u679C_u6211_u4EEC_u81EA_u5DF1_u4E5F_u60F3_u73A9_u4E00_u4E2A_u5177_u5907_u94FE_u5F0F_u7F16_u7A0B_u7279_u70B9_u7684_u7C7B_u8BE5_u600E_u4E48_u5199_u5462_uFF1F_u8BB0_u4F4F_uFF0C_u94FE_u5F0F_u7F16_u7A0B_uFF0C_u65B9_u6CD5_u8FD4_u56DE_u503C_u5FC5_u987B_u8981_u6709_u65B9_u6CD5_u8C03_u7528_u8005_u3002_u7136_u540E_u53EF_u4EE5_u53C2_u8003Masonary_u5E93_u7C97_u7565_u73A9_u4E00_u4E0B_u3002" class="headerlink" title="é‚£å¦‚æœæˆ‘ä»¬è‡ªå·±ä¹Ÿæƒ³ç©ä¸€ä¸ªå…·å¤‡é“¾å¼ç¼–ç¨‹ç‰¹ç‚¹çš„ç±»è¯¥æ€ä¹ˆå†™å‘¢ï¼Ÿè®°ä½ï¼Œé“¾å¼ç¼–ç¨‹ï¼Œæ–¹æ³•è¿”å›å€¼å¿…é¡»è¦æœ‰æ–¹æ³•è°ƒç”¨è€…ã€‚ç„¶åå¯ä»¥å‚è€ƒMasonaryåº“ç²—ç•¥ç©ä¸€ä¸‹ã€‚"></a>é‚£å¦‚æœæˆ‘ä»¬è‡ªå·±ä¹Ÿæƒ³ç©ä¸€ä¸ªå…·å¤‡é“¾å¼ç¼–ç¨‹ç‰¹ç‚¹çš„ç±»è¯¥æ€ä¹ˆå†™å‘¢ï¼Ÿè®°ä½ï¼Œé“¾å¼ç¼–ç¨‹ï¼Œæ–¹æ³•è¿”å›å€¼å¿…é¡»è¦æœ‰æ–¹æ³•è°ƒç”¨è€…ã€‚ç„¶åå¯ä»¥å‚è€ƒ<code>Masonary</code>åº“ç²—ç•¥ç©ä¸€ä¸‹ã€‚</h5><ol>
<li>å…ˆåˆ›å»ºä¸€ä¸ªè®¡ç®—ç®¡ç†å™¨å§<code>CalculateManager</code>ï¼Œå®šä¹‰ç®€å•çš„åŠ å‡ä¹˜é™¤æ–¹æ³•å¹¶é€ä¸€è¶‹å®ç°ï¼Œå¹¶å£°æ˜ä¸€ä¸ªå±æ€§å»ä¿å­˜è®¡ç®—ç»“æœ, è¿™äº›æ–¹æ³•éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼Œå°±æ˜¯è¿”å›å€¼æ˜¯ä¸€ä¸ªblockï¼Œè€Œblockçš„è¿”å›å€¼æ˜¯è¿™ä¸ªç±»æœ¬èº«ï¼Œè¿™å°±ç¡®ä¿äº†åœ¨è°ƒç”¨æ–¹æ³•åä¾ç„¶å¯ä»¥ç»§ç»­è°ƒç”¨ã€‚</li>
</ol>
<pre><code>@interface CalculateManager : NSObject

@property(assign,nonatomic)double result;

+ (instancetype)sharedInstance;

-(CalculateManager *(^)(float value))add;

-(CalculateManager *(^)(float value))minus;

-(CalculateManager *(^)(float value))multi;

-(CalculateManager *(^)(float value))divis;

@end

@implementation CalculateManager

    + (instancetype)sharedInstance {
    static dispatch_once_t onceToken;
    static CalculateManager *mgr = nil;
    dispatch_once(&amp;onceToken, ^{
        mgr = [[self alloc] init];
    });
    return mgr;
}

-(CalculateManager * (^)(float value))add{
    return ^(float value){
        _result += value;
        return self;
    };
}

-(CalculateManager *(^)(float value))minus {
    return ^(float value){
        _result -= value;
        return self;
    };
}

-(CalculateManager *(^)(float value))multi {
    return ^(float value){
        _result *= value;
        return self;
    };
}

-(CalculateManager *(^)(float value))divis {
    return ^(float value){
        _result /= value;
        return self;
    };
}
</code></pre><p> 2.æ¥ä¸‹æ¥ä½ ä¼šå‘ç°å·²ç»å¯ä»¥ä½¿ç”¨é“¾å¼ç¼–ç¨‹äº†</p>
<pre><code>CalculateManager *manger = [[CalculateManager alloc] init];
double result = manger.add(3).minus(3).result;
</code></pre><p>  åªè¦ä½ æ„¿æ„ï¼Œä¾ç„¶å¯ä»¥åœ¨è¿”å›ç»“æœå‰ç»§ç»­ç‚¹ä¸‹å»ã€‚ä½†æ˜¯ä½ ä¼šå‘ç°åœ¨è¿”å›ç»“æœåæ²¡æ³•ç»§ç»­è°ƒç”¨æ–¹æ³•äº†ã€‚è€Œä¸”è¿™ç§è°ƒç”¨ä¾ç„¶éœ€è¦åˆ›å»ºå®ä¾‹ï¼Œå’Œ<code>Masonry</code>å½¢å¼ä¾ç„¶ä¸åŒï¼Œé‚£å°±ç»§ç»­æ”¹è¿›ã€‚åœ¨ä½¿ç”¨<code>Masonry</code>æ—¶ä½ ä¼šå‘ç°ä»»ä½•ç»§æ‰¿è‡ª<code>UIView</code>çš„æ§ä»¶éƒ½å¯ä»¥è°ƒç”¨<code>mas_makeConstraints</code>æˆ–å…¶ä»–æ–¹æ³•ï¼Œé‚£è¯´æ˜è¿™ç»å£æ˜¯ä¸ª<code>UIView</code>çš„åˆ†ç±»ã€‚ä»¿ç…§æ­¤æ€è·¯ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>NSObject</code>çš„åˆ†ç±»ï¼Œä½¿å¾—<code>NSObject</code>ä»»ä½•å­ç±»å®ä¾‹éƒ½å¯ä»¥è°ƒç”¨ã€‚</p>
<pre><code> @interface NSObject (Calculate)

- (double)fn_calculate:(void(^)(CalculateManager * mgr))block;

@end

@implementation NSObject (Calculate)

- (double)fn_calculate:(void(^)(CalculateManager * mgr))block {
    CalculateManager * mgr = [CalculateManager sharedInstance];
    block(mgr);
    return mgr.result;
}
</code></pre><p>ä¸Šé¢è¿™ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯å‚æ•°ä¸º<code>CalculateManager</code>çš„blockï¼Œè¿”å›ç»“æœä¸º<code>CalculateManager</code>çš„å±æ€§å€¼ã€‚ç°åœ¨å°±å¯ä»¥è¿™ä¹ˆä½¿ç”¨äº†ï¼š</p>
<pre><code>double result = [self fn_calculate:^(CalculateManager *mgr) {
        mgr.add(10).add(10).divis(3).multi(5.8).minus(2.2);
    }];
</code></pre><p>@end</p>
<p>åªè¦ä½ æ„¿æ„ï¼Œä½ å¯ä»¥ä¸€ç›´ç‚¹ä¸‹å»ã€‚è¿™ç§å†™æ³•å…¶å®åœ¨OCä¸­éå¸¸å°‘è§ï¼Œä½†æ˜¯åƒ<code>Masonry</code>ä¸€äº›ç¬¬ä¸‰æ–¹åº“éƒ½ä½¿ç”¨äº†è¿™ç§æ€æƒ³ã€‚</p>
<p><a href="https://github.com/ChinaFishNews/ChainProgrammingDemo" target="_blank" rel="external">Demoä¸‹è½½</a></p>
<h4 id="u51FD_u6570_u7F16_u7A0B_u601D_u60F3_28FP_29"><a href="#u51FD_u6570_u7F16_u7A0B_u601D_u60F3_28FP_29" class="headerlink" title="å‡½æ•°ç¼–ç¨‹æ€æƒ³(FP)"></a>å‡½æ•°ç¼–ç¨‹æ€æƒ³(FP)</h4><p>å‡½æ•°ç¼–ç¨‹æ˜¯æŠŠæ“ä½œå°½é‡å†™æˆä¸€ç³»åˆ—åµŒå¥—çš„å‡½æ•°æˆ–è€…æ–¹æ³•è°ƒç”¨ã€‚æ¯ä¸ªæ–¹æ³•å¿…é¡»è¦æœ‰è¿”å›å€¼ï¼ŒæŠŠå‡½æ•°æˆ–è€…blockå½“ä½œå‚æ•°ã€‚</p>
<p>ç»§ç»­ä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨<code>CalculateManager</code>ä¸­å£°æ˜å¹¶å®ç°ä¸€ä¸ªæ–¹æ³•</p>
<pre><code>- (instancetype)manager:(double(^)(double))block;


- (instancetype)manager:(double(^)(double))block {
    _result = block(_result);
        return self;
}
</code></pre><p>è¿™ä¸ªæ–¹æ³•å‚æ•°æ˜¯ä¸€ä¸ªblockï¼Œè¿™ä¸ªblockåˆæœ‰è¿”å›å€¼å’Œå‚æ•°ï¼Œæ–¹æ³•çš„è¿”å›å€¼åˆæ˜¯è‡ªå·±çš„ä¸€ä¸ªå®ä¾‹ã€‚è¿™é‡Œæ–¹æ³•çš„è¿”å›å€¼å®Œå…¨å¯ä»¥ä¸æ˜¯è‡ªå·±çš„å®ä¾‹ï¼Œè€Œæ˜¯ä¸€ä¸ªå…·ä½“çš„ç»“æœã€‚ä½†æ˜¯å¦‚æœæ˜¯ä¸€ä¸ªå…·ä½“çš„ç»“æœï¼Œå¦‚æœè¿™ä¸ªç±»ä¸­æœ‰å¾ˆå¤šå…¶ä»–çš„å±æ€§ï¼Œé‚£å¯¹åº”çš„å°±ç›¸åº”æœ‰å¾ˆå¤šé›·åŒçš„æ–¹æ³•ï¼Œæ‰€ä»¥è¿”å›ä¸€ä¸ªå®ä¾‹ï¼Œè°ƒç”¨çš„æ—¶å€™å¯ä»¥é€šè¿‡è¿™ä¸ªå®ä¾‹å»è·å¾—å¯¹åº”çš„å±æ€§å€¼ã€‚</p>
<pre><code>CalculateManager * mgr = [[CalculateManager alloc] init];
    double h_Result = [[mgr manager:^double(double parameter) {
       parameter += 10;
          parameter *= 2;
          return parameter;
   }] result];
   NSLog(@&quot;%f&quot;,h_Result);
</code></pre><h4 id="u54CD_u5E94_u5F0F_u7F16_u7A0B_u601D_u60F3_28RP_29"><a href="#u54CD_u5E94_u5F0F_u7F16_u7A0B_u601D_u60F3_28RP_29" class="headerlink" title="å“åº”å¼ç¼–ç¨‹æ€æƒ³(RP)"></a>å“åº”å¼ç¼–ç¨‹æ€æƒ³(RP)</h4><p>å“åº”å¼ç¼–ç¨‹ä¸éœ€è¦è€ƒè™‘è°ƒç”¨é¡ºåºï¼Œåªéœ€è¦è€ƒè™‘ç»“æœã€‚ iOSä¸­æœ€å…·ä»£è¡¨æ€§çš„å°±æ˜¯<code>KVO</code>çš„ä½¿ç”¨ã€‚çœ‹ä¸€ä¸‹ç®€å•å®ç”¨ã€‚</p>
<p>å…ˆåˆ›å»ºä¸€ä¸ª<code>Person</code>ç±»ï¼Œå£°æ˜ä¸€ä¸ª<code>name</code>å±æ€§ï¼Œç›‘å¬<code>Person</code>çš„<code>name</code>å±æ€§</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_01_01.png" alt=""></p>
<p>ä½ ä¼šå‘ç°æ²¡ä»€ä¹ˆæ¯›ç—…ã€‚å¦‚æœè¿™æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠ<code>name</code>å±æ€§å˜æˆä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œå†å»ä½¿ç”¨ç®­å¤´å‡½æ•°æ–¹å¼å»ä¿®æ”¹<code>name</code>çš„å€¼</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_01_02.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_01_03.png" alt=""></p>
<p>è¿™ä¸ªæ—¶å€™ä½ ä¼šå‘ç°å¹¶æ²¡æœ‰èµ°è¿›ç›‘å¬å‡½æ•°ã€‚è¿™å’Œä¸Šé¢æ­£å¸¸ä½¿ç”¨çš„æ—¶å€™æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿé‚£å°±æ˜¯ä¿®æ”¹<code>name</code>å±æ€§çš„æ—¶å€™ï¼Œæˆå‘˜å˜é‡ä¸ä¼šè°ƒç”¨<code>set</code>æ–¹æ³•, è€Œä½¿ç”¨ç‚¹è¯­æ³•æ€»æ˜¯ä¼šè°ƒç”¨<code>set</code>å‡½æ•°ã€‚æœ‰ç†ç”±ç›¸ä¿¡ï¼Œä½¿ç”¨<code>KVO</code>çš„æ—¶å€™é‡å†™äº†å±æ€§çš„<code>set</code>æ–¹æ³•ã€‚</p>
<blockquote>
<h3 id="u600E_u4E48_u53EF_u4EE5_u91CD_u5199set_u65B9_u6CD5_uFF1F"><a href="#u600E_u4E48_u53EF_u4EE5_u91CD_u5199set_u65B9_u6CD5_uFF1F" class="headerlink" title="æ€ä¹ˆå¯ä»¥é‡å†™setæ–¹æ³•ï¼Ÿ"></a>æ€ä¹ˆå¯ä»¥é‡å†™<code>set</code>æ–¹æ³•ï¼Ÿ</h3><ol>
<li>å¯ä»¥ä½¿ç”¨åˆ†ç±»çš„å½¢å¼é‡å†™</li>
<li>å¯ä»¥ä½¿ç”¨å­ç±»å»é‡å†™</li>
</ol>
</blockquote>
<p>æƒ³æƒ³çœ‹ï¼Œè‹¹æœæœ‰æ²¡æœ‰å¯èƒ½å»ä½¿ç”¨åˆ†ç±»çš„å½¢å¼å»é‡å†™ï¼Ÿ ç»å£ä¸å¯èƒ½ï¼å› ä¸ºå¦‚æœåˆ†ç±»ä¸­å»é‡å†™å±æ€§çš„<code>set</code>æ–¹æ³•ï¼Œåˆ™åŸæœ‰ç±»ä¸­å³ä¾¿é‡å†™äº†è¯¥å±æ€§çš„<code>set</code>æ–¹æ³•ä¹Ÿä¸ä¼šè°ƒç”¨,ä¼šä¼˜å…ˆä½¿ç”¨åˆ†ç±»ä¸­çš„æ–¹æ³•ã€‚è€Œæˆ‘ä»¬åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šå»é‡å†™<code>set</code>æ–¹æ³•å»åšä¸€äº›å…¶ä»–æ“ä½œã€‚æ‰€ä»¥åªå¯èƒ½æ˜¯ç¬¬äºŒç§æƒ…å†µï¼Œä½¿ç”¨å­ç±»å»é‡å†™äº†<code>set</code>æ–¹æ³•ã€‚é‚£è¿‡ç¨‹åº”è¯¥æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p>
<blockquote>
<ol>
<li>è‡ªå®šä¹‰è¢«ç›‘å¬ç±»çš„å­ç±»</li>
<li>é‡å†™è¢«ç›‘å¬å±æ€§çš„<code>set</code>æ–¹æ³•ï¼Œåœ¨å†…éƒ¨è°ƒç”¨<code>super</code>æ¢å¤çˆ¶ç±»çš„åšæ³•ï¼Œé€šçŸ¥è§‚å¯Ÿè€…</li>
</ol>
</blockquote>
<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Ÿ å¦‚ä½•è®©å¤–ç•Œè°ƒç”¨è‡ªå®šä¹‰å­ç±»çš„æ–¹æ³•ï¼Ÿæ‰€ä»¥è¿˜æœ‰æœ€é‡è¦çš„ä¸€ç‚¹</p>
<blockquote>
<p> iOSä¸­æœ‰ä¸ª<code>isa</code>æŒ‡é’ˆ, ä¿®æ”¹å½“å‰å¯¹è±¡çš„isaæŒ‡é’ˆ,æŒ‡å‘è‡ªå®šä¹‰çš„å­ç±»!</p>
</blockquote>
<p>éªŒè¯ä¸€ä¸‹çŒœæµ‹ï¼ŒæŸ¥çœ‹ä¸€ä¸‹åœ¨èµ°è¿›ç›‘å¬æ–¹æ³•åå¯¹è±¡çš„<code>isa</code>æŒ‡é’ˆæŒ‡å‘ã€‚</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_01_04.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_01_05.png" alt=""></p>
<p>çŸ¥é“äº†<code>KVO</code>çš„å†…éƒ¨æœºåˆ¶ï¼Œé‚£æˆ‘ä»¬è‡ªå·±å°±å¯ä»¥å†™ä¸€ä¸ªç®€å•çš„<code>KVO</code>ã€‚</p>
<p>ä»¥ä¸Šé¢ä¸ºä¾‹ï¼Œç›‘å¬Personç±»çš„nameå±æ€§ï¼Œåˆ›å»ºä¸€ä¸ªNSObjectçš„åˆ†ç±»ï¼Œæ·»åŠ ç›‘å¬æ–¹æ³•å¹¶å®ç°,æœ€åå†ä½¿ç”¨æ·»åŠ çš„è¿™ä¸ªæ–¹æ³•ç›‘å¬å³å¯ã€‚</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_24_02.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_24_03.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_24_04.png" alt=""></p>
<p>æ³¨æ„åœ¨ä½¿ç”¨<code>objc_msgSend</code>æ—¶éœ€è¦åœ¨Build Settingä¸­å°†<code>Enable Strict Checking of objc_msgSend Calls</code>è®¾ç½®ä¸º<code>NO</code></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_12_24_01.png" alt=""></p>
<p><a href="https://github.com/ChinaFishNews/ReactProgrammingDemo" target="_blank" rel="external">Demoä¸‹è½½</a></p>
<hr>
<p>å¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–é—®é¢˜è¯·è”ç³»æˆ‘:fishnewsdream@gmail.com,æ¬¢è¿äº¤æµï¼Œå…±åŒæé«˜ï¼</p>
<p>Objective-C/SwiftæŠ€æœ¯å¼€å‘äº¤æµç¾¤201556264ï¼Œè®¨è®ºä½•ç§æŠ€æœ¯å¹¶ä¸å—é™ï¼Œæ¬¢è¿å„ä½å¤§ç‰›ç™¾å®¶äº‰é¸£ï¼</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">åˆšåˆšåœ¨çº¿å·¥ä½œå®¤</a>ï¼Œæ¬¢è¿å…³æ³¨æˆ–æå‡ºå»ºè®¾æ€§æ„è§ï¼</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">åˆšåˆšåœ¨çº¿è®ºå›</a>, æ¬¢è¿è¸Šè·ƒæé—®æˆ–è§£ç­”ï¼</p>
<p>å¦‚æœ‰è½¬è½½ï¼Œè¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ReactiveCocoa-block/">ReactiveCocoa,block</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/è¿›é˜¶/">è¿›é˜¶</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-CocoaPodsç»„ä»¶äºŒè¿›åˆ¶åŒ–è§£å†³æ–¹æ¡ˆ" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/11/18/CocoaPodsç»„ä»¶äºŒè¿›åˆ¶åŒ–è§£å†³æ–¹æ¡ˆ/" class="article-date">
  	<time datetime="2017-11-17T16:00:00.000Z" itemprop="datePublished">2017-11-18</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/18/CocoaPodsç»„ä»¶äºŒè¿›åˆ¶åŒ–è§£å†³æ–¹æ¡ˆ/">CocoaPodsç»„ä»¶äºŒè¿›åˆ¶åŒ–è§£å†³æ–¹æ¡ˆ</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><br></p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=507777634&auto=0&height=66"></iframe>

<blockquote>
<p>ä¸ºä»€ä¹ˆè¦è½¬è½½ï¼Ÿå› ä¸ºåŸæ–‡å†™çš„å¾ˆå¥½ï¼</p>
<p>ä¸ºä»€ä¹ˆè¦è½¬è½½ï¼Ÿå› ä¸ºå®åœ¨æƒ…ä¸è‡ªç¦ï¼</p>
<p>ä¸ºä»€ä¹ˆè¦è½¬è½½ï¼Ÿå› ä¸ºè‡ªå·±å†™ä¸ä¸Šæ¥ï¼</p>
</blockquote>
<p><a href="http://www.cocoachina.com/cms/wap.php?action=article&amp;id=17109" target="_blank" rel="external">æ–‡ç« é“¾æ¥!!!</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/è½¬è½½/">è½¬è½½</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/è½¬è½½/">è½¬è½½</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-æœºå™¨å­¦ä¹ -CoreMLç›®æ ‡è·Ÿè¸ª" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/11/12/æœºå™¨å­¦ä¹ -CoreMLç›®æ ‡è·Ÿè¸ª/" class="article-date">
  	<time datetime="2017-11-11T16:00:00.000Z" itemprop="datePublished">2017-11-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/12/æœºå™¨å­¦ä¹ -CoreMLç›®æ ‡è·Ÿè¸ª/">æœºå™¨å­¦ä¹ -CoreMLç›®æ ‡è·Ÿè¸ª</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><br></p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=507777634&auto=0&height=66"></iframe>


<p>ç‰©ä½“è·Ÿè¸ªéœ€è¦å¤„ç†è¿ç»­çš„è§†é¢‘å¸§ï¼Œæ‰€ä»¥éœ€è¦<code>VNSequenceRequestHandler</code>ç±»æ¥å¤„ç†å¤šå¸§å›¾åƒï¼Œä¹‹å‰è¯†åˆ«å•å¼ å›¾ç‰‡ä½¿ç”¨çš„æ˜¯<code>VNImageRequestHandler</code>ç±»ã€‚è·Ÿè¸ªå¤šç‰©ä½“æ—¶ï¼Œå¯ä»¥ä½¿ç”¨VNDetectedObjectObservation.uuidåŒºåˆ†è·Ÿè¸ªå¯¹è±¡ï¼Œå¹¶åšç›¸åº”å¤„ç†ã€‚è¿™é‡Œç²—ç•¥æ¼”ç¤ºä¸€ä¸‹è¿½è¸ªå•ä¸ªç‰©ä½“ã€‚</p>
<ol>
<li>å‰æœŸUIå‡†å¤‡</li>
</ol>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_12_02.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_12_03.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_12_04.png" alt=""></p>
<p>2  æ•è·å¯¹è±¡ï¼Œè®¾ç½®ç²¾å‡†è¿½è¸ª</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_12_05.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_12_06.png" alt=""></p>
<p>3.æ•ˆæœæ¼”ç¤º<br><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_07_10.gif" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_12_01.gif" alt=""></p>
<p><br><br><a href="https://github.com/ChinaFishNews/ObjectsTracking" target="_blank" rel="external">Demoä¸‹è½½</a></p>
<hr>
<p>å¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–é—®é¢˜è¯·è”ç³»æˆ‘:fishnewsdream@gmail.com,æ¬¢è¿äº¤æµï¼Œå…±åŒæé«˜ï¼</p>
<p>Objective-C/SwiftæŠ€æœ¯å¼€å‘äº¤æµç¾¤201556264ï¼Œè®¨è®ºä½•ç§æŠ€æœ¯å¹¶ä¸å—é™ï¼Œæ¬¢è¿å„ä½å¤§ç‰›ç™¾å®¶äº‰é¸£ï¼</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">åˆšåˆšåœ¨çº¿å·¥ä½œå®¤</a>ï¼Œæ¬¢è¿å…³æ³¨æˆ–æå‡ºå»ºè®¾æ€§æ„è§ï¼</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">åˆšåˆšåœ¨çº¿è®ºå›</a>, æ¬¢è¿è¸Šè·ƒæé—®æˆ–è§£ç­”ï¼</p>
<p>å¦‚æœ‰è½¬è½½ï¼Œè¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vision-ç›®æ ‡è·Ÿè¸ªï¼ŒVNDetectedObjectObservation-VNSequenceRequestHandler/">Vision,ç›®æ ‡è·Ÿè¸ªï¼ŒVNDetectedObjectObservation,VNSequenceRequestHandler</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Swift/">Swift</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-æœºå™¨å­¦ä¹ -CoreMLäººè„¸è¯†åˆ«" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/11/07/æœºå™¨å­¦ä¹ -CoreMLäººè„¸è¯†åˆ«/" class="article-date">
  	<time datetime="2017-11-06T16:00:00.000Z" itemprop="datePublished">2017-11-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/07/æœºå™¨å­¦ä¹ -CoreMLäººè„¸è¯†åˆ«/">æœºå™¨å­¦ä¹ -CoreMLäººè„¸è¯†åˆ«</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><br></p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=167850&auto=0&height=66"></iframe>

<p>ä½¿ç”¨Visionæ¡†æ¶è¿›è¡Œäººè„¸è¯†åˆ«ï¼Œä¸ä»…å¯ä»¥è¯†åˆ«å‡ºäººè„¸çš„é¢éƒ¨è½®å»“ï¼Œè¿˜å¯ä»¥è¯†åˆ«å‡ºäººè„¸çš„ç‰¹å¾ç‚¹ï¼Œæ¯”å¦‚çœ¼ç›ã€é¼»å­ã€å˜´å·´ç­‰ã€‚è¿›è¡Œäººè„¸è¯·æ±‚çš„ç±»æ˜¯<code>VNDetectFaceRectanglesRequest</code>ï¼Œäººè„¸ç‰¹å¾è¯·æ±‚çš„ç±»æ˜¯<code>VNDetectFaceRectanglesRequest</code>,è¯·æ±‚ç»“æœçš„ä¿¡æ¯ç±»æ˜¯<code>VNFaceObservation</code>ã€‚ä¸‹é¢ç›´æ¥ä¸Šä»£ç ã€‚</p>
<ol>
<li>æ­å»ºåŸºæœ¬UI</li>
</ol>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_07_03.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_07_04.png" alt=""></p>
<ol>
<li>è¯†åˆ«é¢éƒ¨è½®å»“</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">processImage</span><span class="params">(image:UIImage)</span></span> &#123;</span><br><span class="line">       <span class="keyword">self</span>.resultLabel.text = <span class="string">"processing..."</span></span><br><span class="line">       <span class="keyword">let</span> handler = <span class="type">VNImageRequestHandler</span>.<span class="keyword">init</span>(cgImage: image.cgImage!)</span><br><span class="line">       <span class="keyword">let</span> request = <span class="type">VNDetectFaceRectanglesRequest</span>.<span class="keyword">init</span>(completionHandler: handleFaceDetect)</span><br><span class="line">       <span class="keyword">try</span>? handler.perform([request])</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">handleFaceDetect</span><span class="params">(request:VNRequest,error:Error?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> obversations = request.results <span class="keyword">as</span>? [<span class="type">VNFaceObservation</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">fatalError</span>(<span class="string">"no face"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.resultLabel.text = <span class="string">"<span class="subst">\(obversations.<span class="built_in">count</span>)</span>face"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> subView <span class="keyword">in</span> <span class="keyword">self</span>.btnImageView.subviews <span class="keyword">where</span> subView.tag == <span class="number">100</span> &#123;</span><br><span class="line">            subView.removeFromSuperview()</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> faceObversion <span class="keyword">in</span> obversations &#123;</span><br><span class="line">            <span class="keyword">self</span>.showFaceContour(faceObversion: faceObversion, toView: <span class="keyword">self</span>.btnImageView)</span><br><span class="line">            </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="component">func showFaceContour(faceObversion face : VNFaceObservation, toView view : UIView) &#123;</span><br><span class="line">    let boundingBox = face<span class="string">.boundingBox</span></span><br><span class="line">    let imageBoundingBox = view<span class="string">.bounds</span></span><br><span class="line">    </span><br><span class="line">    let w = boundingBox<span class="string">.size.width</span> * imageBoundingBox<span class="string">.width</span></span><br><span class="line">    let h = boundingBox<span class="string">.size.height</span> * imageBoundingBox<span class="string">.height</span></span><br><span class="line">    </span><br><span class="line">    let x = boundingBox<span class="string">.origin.x</span> * imageBoundingBox<span class="string">.width</span></span><br><span class="line">    let y = imageBoundingBox<span class="string">.height</span> - boundingBox<span class="string">.origin.y</span> * imageBoundingBox<span class="string">.height</span> - h</span><br><span class="line">    </span><br><span class="line">    let subview = UIView(frame: CGRect(x: x, y: y, width: w, height: h))</span><br><span class="line">    subview<span class="string">.layer.borderColor</span> = UIColor<span class="string">.green.cgColor</span></span><br><span class="line">    subview<span class="string">.layer.borderWidth</span> = 1</span><br><span class="line">    subview<span class="string">.layer.cornerRadius</span> = 1</span><br><span class="line">    subview<span class="string">.tag</span> = 100</span><br><span class="line">    view<span class="string">.addSubview(subview)</span></span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ç›¸å½“äºåœ¨äººè„¸ä¸Šç”»äº†ä¸€ä¸ªè½®å»“è§†å›¾æ·»åŠ ä¸Šå»ã€‚boundingBoxæ˜¯CGRectç±»å‹ï¼Œä½†æ˜¯boundingBoxè¿”å›çš„æ˜¯x,y,w,hçš„æ¯”ä¾‹(value:0~1)ï¼Œéœ€è¦è¿›è¡Œè½¬æ¢ã€‚åŸå§‹åæ ‡ç³»çš„åŸç‚¹æ˜¯å·¦ä¸Šè§’ï¼Œè€Œè¿™é‡Œæ˜¯å·¦ä¸‹è§’ï¼Œå¹¶ä¸”yè½´çš„æ–¹å‘å’ŒåŸå§‹åæ ‡ç³»ç›¸åã€‚</li>
</ul>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_07_05.png" alt=""></p>
<p>3.é¢éƒ¨è½®å»“å±•ç¤º</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_07_06.png" alt=""></p>
<p>4.è¯†åˆ«é¢éƒ¨ç‰¹å¾<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">processImage</span><span class="params">(image:UIImage)</span></span> &#123;</span><br><span class="line">       <span class="keyword">self</span>.resultLabel.text = <span class="string">"processing..."</span></span><br><span class="line">       <span class="keyword">let</span> handler = <span class="type">VNImageRequestHandler</span>.<span class="keyword">init</span>(cgImage: image.cgImage!)</span><br><span class="line">       <span class="keyword">let</span> request = <span class="type">VNDetectFaceLandmarksRequest</span>.<span class="keyword">init</span>(completionHandler: handleFaceDetect)</span><br><span class="line">       <span class="keyword">try</span>? handler.perform([request])</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">handleFaceDetect</span><span class="params">(request:VNRequest,error:Error?)</span></span> &#123;</span><br><span class="line">       <span class="keyword">guard</span> <span class="keyword">let</span> obversations = request.results <span class="keyword">as</span>? [<span class="type">VNFaceObservation</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="built_in">fatalError</span>(<span class="string">"no face"</span>)</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">self</span>.resultLabel.text = <span class="string">"<span class="subst">\(obversations.<span class="built_in">count</span>)</span> face"</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">var</span> landmarkRegions : [<span class="type">VNFaceLandmarkRegion2D</span>] = []</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">for</span> faceObversion <span class="keyword">in</span> obversations &#123;</span><br><span class="line">           landmarkRegions += <span class="keyword">self</span>.showFaceFeature(faceObversion: faceObversion, toView: <span class="keyword">self</span>.btnImageView)</span><br><span class="line">           resultImage =  <span class="keyword">self</span>.drawOnImage(source: <span class="keyword">self</span>.resultImage,</span><br><span class="line">                                             boundingRect: faceObversion.boundingBox,</span><br><span class="line">                                             faceLandmarkRegions: landmarkRegions)</span><br><span class="line">       &#125;</span><br><span class="line"><span class="keyword">self</span>.btnImageView.setBackgroundImage(resultImage, <span class="keyword">for</span>: .normal)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·å–ç‰¹å¾ç‚¹<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">showFaceFeature</span><span class="params">(faceObversion face: VNFaceObservation, toView view: UIView)</span></span> -&gt;[<span class="type">VNFaceLandmarkRegion2D</span>] &#123;</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> landmarks = face.landmarks <span class="keyword">else</span> &#123; <span class="keyword">return</span> [] &#125;</span><br><span class="line">        <span class="keyword">var</span> landmarkRegions: [<span class="type">VNFaceLandmarkRegion2D</span>] = []</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> rightEye = landmarks.rightEye &#123;</span><br><span class="line">            landmarkRegions.append(rightEye)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> nose = landmarks.nose &#123;</span><br><span class="line">            landmarkRegions.append(nose)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> landmarkRegions</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>é‡æ–°ç»˜åˆ¶å›¾ç‰‡ï¼ˆå«é¢éƒ¨ç‰¹å¾ï¼‰<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">func drawOnImage(source: UIImage,</span><br><span class="line">                   boundingRect: CGRect,</span><br><span class="line">                   faceLandmarkRegions: [VNFaceLandmarkRegion2D]) -&gt; UIImage &#123;</span><br><span class="line">      UIGraphicsBeginImageContextWithOptions(source.<span class="built_in">size</span>, <span class="keyword">false</span>, <span class="number">1</span>)</span><br><span class="line">      let context = UIGraphicsGetCurrentContext()!</span><br><span class="line">      context.translateBy(x: <span class="number">0</span>, y: source.<span class="built_in">size</span>.<span class="variable">height</span>)</span><br><span class="line">      context.scaleBy(x: <span class="number">1.0</span>, y: -<span class="number">1.0</span>)</span><br><span class="line">      context.setBlendMode(CGBlendMode.colorBurn)</span><br><span class="line">      context.setLineJoin(.<span class="built_in">round</span>)</span><br><span class="line">      context.setLineCap(.<span class="built_in">round</span>)</span><br><span class="line">      context.setShouldAntialias(<span class="keyword">true</span>)</span><br><span class="line">      context.setAllowsAntialiasing(<span class="keyword">true</span>)</span><br><span class="line">      context.setLineWidth(<span class="number">5.0</span>)</span><br><span class="line">      context.setStrokeColor(UIColor.black.cgColor)</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// origin image</span></span><br><span class="line">      let <span class="built_in">rect</span> = CGRect(x: <span class="number">0</span>, y:<span class="number">0</span>, <span class="variable">width</span>: source.<span class="built_in">size</span>.<span class="variable">width</span>, <span class="variable">height</span>: source.<span class="built_in">size</span>.<span class="variable">height</span>)</span><br><span class="line">      context.<span class="title">draw</span>(source.cgImage!, in: <span class="built_in">rect</span>)</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// face contour</span></span><br><span class="line">      let rectWidth = source.<span class="built_in">size</span>.<span class="variable">width</span> * boundingRect.<span class="built_in">size</span>.<span class="variable">width</span></span><br><span class="line">      let rectHeight = source.<span class="built_in">size</span>.<span class="variable">height</span> * boundingRect.<span class="built_in">size</span>.<span class="variable">height</span></span><br><span class="line">      context.addRect(CGRect(x: boundingRect.origin.x * source.<span class="built_in">size</span>.<span class="variable">width</span>, y:boundingRect.origin.y * source.<span class="built_in">size</span>.<span class="variable">height</span>, <span class="variable">width</span>: rectWidth, <span class="variable">height</span>: rectHeight))</span><br><span class="line">      context.drawPath(using: CGPathDrawingMode.<span class="built_in">stroke</span>)</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// draw face feature</span></span><br><span class="line">      context.setStrokeColor(UIColor.<span class="built_in">red</span>.cgColor)</span><br><span class="line">      <span class="keyword">for</span> faceLandmarkRegion in faceLandmarkRegions &#123;</span><br><span class="line">          var points: [CGPoint] = []</span><br><span class="line">          <span class="keyword">for</span> i in <span class="number">0.</span>.&lt;faceLandmarkRegion.pointCount &#123;</span><br><span class="line">              let <span class="built_in">point</span> = faceLandmarkRegion.normalizedPoints[i]</span><br><span class="line">              let p = CGPoint(x: CGFloat(<span class="built_in">point</span>.x), y: CGFloat(<span class="built_in">point</span>.y))</span><br><span class="line">              points.<span class="built_in">append</span>(p)</span><br><span class="line">          &#125;</span><br><span class="line">          let mappedPoints = points.<span class="built_in">map</span> &#123; CGPoint(x: boundingRect.origin.x * source.<span class="built_in">size</span>.<span class="variable">width</span> + $<span class="number">0.</span>x * rectWidth, y: boundingRect.origin.y * source.<span class="built_in">size</span>.<span class="variable">height</span> + $<span class="number">0.</span>y * rectHeight) &#125;</span><br><span class="line">          context.addLines(between: mappedPoints)</span><br><span class="line">          context.drawPath(using: CGPathDrawingMode.<span class="built_in">stroke</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      let coloredImg : UIImage = UIGraphicsGetImageFromCurrentImageContext()!</span><br><span class="line">      UIGraphicsEndImageContext()</span><br><span class="line">      <span class="keyword">return</span> coloredImg</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p> VNDetectFaceLandmarksRequestè¯·æ±‚è¿”å›çš„ä¹Ÿæ˜¯VNFaceObservationï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™VNFaceObservation å¯¹è±¡çš„landmarkså±æ€§å°±ä¼šæœ‰å€¼ï¼Œè¿™ä¸ªå±æ€§é‡Œé¢å­˜å‚¨äº†äººç‰©é¢éƒ¨ç‰¹å¾çš„ç‚¹<br>å¦‚ï¼š</p>
<ul>
<li>faceContourï¼šè„¸éƒ¨è½®å»“</li>
<li>leftEyeã€rightEyeï¼š å·¦çœ¼ã€å³çœ¼</li>
<li>noseï¼š é¼»å­</li>
<li>noseCrest: é¼»åµ´</li>
<li>outerLipsã€innerLipsï¼š å¤–å”‡ã€å†…å”‡</li>
<li>leftEyebrowã€rightEyebrow: å·¦çœ‰æ¯›ã€å³çœ‰æ¯›</li>
<li>leftPupilã€rightPupilï¼š å·¦ç³ã€å³ç³</li>
</ul>
<p>5.é¢éƒ¨ç‰¹å¾ç‚¹å±•ç¤º</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_07_07.png" alt=""></p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_07_08.png" alt=""></p>
<p><br><br><a href="https://github.com/ChinaFishNews/HumanFaceRecognize.git" target="_blank" rel="external">Demoä¸‹è½½</a></p>
<hr>
<p>å¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–é—®é¢˜è¯·è”ç³»æˆ‘:fishnewsdream@gmail.com,æ¬¢è¿äº¤æµï¼Œå…±åŒæé«˜ï¼</p>
<p>Objective-C/SwiftæŠ€æœ¯å¼€å‘äº¤æµç¾¤201556264ï¼Œè®¨è®ºä½•ç§æŠ€æœ¯å¹¶ä¸å—é™ï¼Œæ¬¢è¿å„ä½å¤§ç‰›ç™¾å®¶äº‰é¸£ï¼</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">åˆšåˆšåœ¨çº¿å·¥ä½œå®¤</a>ï¼Œæ¬¢è¿å…³æ³¨æˆ–æå‡ºå»ºè®¾æ€§æ„è§ï¼</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">åˆšåˆšåœ¨çº¿è®ºå›</a>, æ¬¢è¿è¸Šè·ƒæé—®æˆ–è§£ç­”ï¼</p>
<p>å¦‚æœ‰è½¬è½½ï¼Œè¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Core-ML-Vision-äººè„¸è¯†åˆ«/">Core ML, Vision,äººè„¸è¯†åˆ«</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Swift/">Swift</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-æœºå™¨å­¦ä¹ -CoreMLæ–‡å­—è¯†åˆ«" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/11/07/æœºå™¨å­¦ä¹ -CoreMLæ–‡å­—è¯†åˆ«/" class="article-date">
  	<time datetime="2017-11-06T16:00:00.000Z" itemprop="datePublished">2017-11-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/07/æœºå™¨å­¦ä¹ -CoreMLæ–‡å­—è¯†åˆ«/">æœºå™¨å­¦ä¹ -CoreMLæ–‡å­—è¯†åˆ«</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><br></p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=421563094&auto=0&height=66"></iframe>


<ol>
<li>è·å–å¸¦æœ‰æ–‡å­—çš„å›¾ç‰‡<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">btnPressed</span><span class="params">(<span class="number">_</span> sender: Any)</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> picker = <span class="type">UIImagePickerController</span>()</span><br><span class="line">    picker.delegate = <span class="keyword">self</span></span><br><span class="line">    picker.sourceType = .savedPhotosAlbum</span><br><span class="line">    present(picker, animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// UIImagePickerControllerDelegate</span></span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">imagePickerController</span><span class="params">(<span class="number">_</span> picker: UIImagePickerController, didFinishPickingMediaWithInfo info: [String : Any])</span></span> &#123;</span><br><span class="line">        picker.dismiss(animated: <span class="literal">true</span>, completion: <span class="literal">nil</span>)</span><br><span class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> image = (info[<span class="type">UIImagePickerControllerOriginalImage</span>] <span class="keyword">as</span>? <span class="type">UIImage</span>) <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">fatalError</span>(<span class="string">"no image"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">self</span>.btnImageView.setBackgroundImage(image, <span class="keyword">for</span>: .normal)</span><br><span class="line"><span class="comment">//        self.btnImageView.layer.sublayers?.forEach &#123; $0.removeFromSuperlayer() &#125;</span></span><br><span class="line"><span class="comment">//        if self.btnImageView.layer.sublayers != nil &#123;</span></span><br><span class="line"><span class="comment">//            for layer in self.btnImageView.layer.sublayers! &#123;</span></span><br><span class="line"><span class="comment">//                layer.removeFromSuperlayer()</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> textLayers:[<span class="type">CAShapeLayer</span>] = []</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> cgImage = image.cgImage &#123;</span><br><span class="line">            <span class="keyword">let</span> textRecognizedRequest = <span class="type">VNDetectTextRectanglesRequest</span>.<span class="keyword">init</span>(completionHandler: &#123; (request:<span class="type">VNRequest</span>, error:<span class="type">Error</span>?) <span class="keyword">in</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (request.results <span class="keyword">as</span>? [<span class="type">VNTextObservation</span>]) != <span class="literal">nil</span> &#123;</span><br><span class="line">                    textLayers = <span class="keyword">self</span>.addShapesToText(obversations: request.results <span class="keyword">as</span>! [<span class="type">VNTextObservation</span>], view: <span class="keyword">self</span>.btnImageView)</span><br><span class="line">                    <span class="keyword">for</span> layer <span class="keyword">in</span> textLayers &#123;</span><br><span class="line">                        <span class="keyword">self</span>.btnImageView.layer.addSublayer(layer)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">let</span> handler = <span class="type">VNImageRequestHandler</span>.<span class="keyword">init</span>(cgImage: cgImage, options: [:])</span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> <span class="number">_</span> = <span class="keyword">try</span>? handler.perform([textRecognizedRequest]) <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">fatalError</span>(<span class="string">"failed"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>2.æ·»åŠ Layerå±•ç¤º</p>
<figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="component">func addShapesToText(obversations:[VNTextObservation],view:UIView) -&gt; [CAShapeLayer] &#123;</span><br><span class="line">       let layers: [CAShapeLayer] = obversations<span class="string">.map</span> &#123; observation in</span><br><span class="line">           </span><br><span class="line">           let w = observation<span class="string">.boundingBox.size.width</span> * view<span class="string">.bounds.width</span></span><br><span class="line">           let h = observation<span class="string">.boundingBox.size.height</span> * view<span class="string">.bounds.height</span></span><br><span class="line">           let x = observation<span class="string">.boundingBox.origin.x</span> * view<span class="string">.bounds.width</span></span><br><span class="line">           let y = view<span class="string">.bounds.height</span> - observation<span class="string">.boundingBox.origin.y</span> * view<span class="string">.bounds.height</span> - h</span><br><span class="line">           </span><br><span class="line">           let layer = CAShapeLayer()</span><br><span class="line">           layer<span class="string">.frame</span> = CGRect(x: x , y: y, width: w, height: h)</span><br><span class="line">           layer<span class="string">.borderColor</span> = UIColor<span class="string">.green.cgColor</span></span><br><span class="line">           layer<span class="string">.borderWidth</span> = 2</span><br><span class="line">           layer<span class="string">.cornerRadius</span> = 3</span><br><span class="line">           </span><br><span class="line">           return layer</span><br><span class="line">       &#125;</span></span><br><span class="line">       return layers</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>3.æ•ˆæœå±•ç¤º</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_07_09.png" alt=""></p>
<p><br><br><a href="https://github.com/ChinaFishNews/TextRecognized.git" target="_blank" rel="external">Demoä¸‹è½½</a></p>
<hr>
<p>å¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–é—®é¢˜è¯·è”ç³»æˆ‘:fishnewsdream@gmail.com,æ¬¢è¿äº¤æµï¼Œå…±åŒæé«˜ï¼</p>
<p>Objective-C/SwiftæŠ€æœ¯å¼€å‘äº¤æµç¾¤201556264ï¼Œè®¨è®ºä½•ç§æŠ€æœ¯å¹¶ä¸å—é™ï¼Œæ¬¢è¿å„ä½å¤§ç‰›ç™¾å®¶äº‰é¸£ï¼</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">åˆšåˆšåœ¨çº¿å·¥ä½œå®¤</a>ï¼Œæ¬¢è¿å…³æ³¨æˆ–æå‡ºå»ºè®¾æ€§æ„è§ï¼</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">åˆšåˆšåœ¨çº¿è®ºå›</a>, æ¬¢è¿è¸Šè·ƒæé—®æˆ–è§£ç­”ï¼</p>
<p>å¦‚æœ‰è½¬è½½ï¼Œè¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vision-æ–‡å­—æ£€æµ‹ï¼ŒVNDetectTextRectanglesRequest/">Vision,æ–‡å­—æ£€æµ‹ï¼ŒVNDetectTextRectanglesRequest</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Swift/">Swift</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-æœºå™¨å­¦ä¹ -CoreMLç»“åˆSiri" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/11/03/æœºå™¨å­¦ä¹ -CoreMLç»“åˆSiri/" class="article-date">
  	<time datetime="2017-11-02T16:00:00.000Z" itemprop="datePublished">2017-11-03</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/03/æœºå™¨å­¦ä¹ -CoreMLç»“åˆSiri/">æœºå™¨å­¦ä¹ -CoreMLç»“åˆSiri</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><br></p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=242603&auto=0&height=66"></iframe>


<h5 id="u4F7F_u7528AVFoundation_u62CD_u6444_u7167_u7247_uFF0C_u518D_u4F7F_u7528Core_ML_u5904_u7406_u5206_u6790_u7167_u7247_uFF0C_u6700_u540E_u901A_u8FC7Siri_u544A_u77E5_u62CD_u6444_u7684_u5BF9_u8C61_u662F_u4EC0_u4E48_u3002"><a href="#u4F7F_u7528AVFoundation_u62CD_u6444_u7167_u7247_uFF0C_u518D_u4F7F_u7528Core_ML_u5904_u7406_u5206_u6790_u7167_u7247_uFF0C_u6700_u540E_u901A_u8FC7Siri_u544A_u77E5_u62CD_u6444_u7684_u5BF9_u8C61_u662F_u4EC0_u4E48_u3002" class="headerlink" title="ä½¿ç”¨AVFoundationæ‹æ‘„ç…§ç‰‡ï¼Œå†ä½¿ç”¨Core MLå¤„ç†åˆ†æç…§ç‰‡ï¼Œæœ€åé€šè¿‡Siriå‘ŠçŸ¥æ‹æ‘„çš„å¯¹è±¡æ˜¯ä»€ä¹ˆã€‚"></a>ä½¿ç”¨AVFoundationæ‹æ‘„ç…§ç‰‡ï¼Œå†ä½¿ç”¨Core MLå¤„ç†åˆ†æç…§ç‰‡ï¼Œæœ€åé€šè¿‡Siriå‘ŠçŸ¥æ‹æ‘„çš„å¯¹è±¡æ˜¯ä»€ä¹ˆã€‚</h5><ol>
<li><p>å‰æœŸé…ç½®</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> captureView : <span class="type">UIView</span>!</span><br><span class="line"><span class="keyword">var</span> synthe = <span class="type">AVSpeechSynthesizer</span>()</span><br><span class="line">    <span class="keyword">var</span> uttrence = <span class="type">AVSpeechUtterance</span>()</span><br><span class="line">    <span class="keyword">var</span> predicte = <span class="string">""</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> captureSession : <span class="type">AVCaptureSession</span>!</span><br><span class="line">    <span class="keyword">var</span> cameraOutput : <span class="type">AVCapturePhotoOutput</span>!</span><br><span class="line">    <span class="keyword">var</span> previewLayer : <span class="type">AVCaptureVideoPreviewLayer</span>!</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="func"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.viewDidLoad()</span><br><span class="line">        </span><br><span class="line">        captureView = <span class="type">UIView</span>.<span class="keyword">init</span>(frame: <span class="type">CGRect</span>.<span class="keyword">init</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="number">200</span>, height: <span class="number">200</span>))</span><br><span class="line">        <span class="keyword">self</span>.view.addSubview(captureView)</span><br><span class="line">        setupCamera()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="func"><span class="keyword">func</span> <span class="title">setupCamera</span><span class="params">()</span></span> &#123;</span><br><span class="line">        captureSession = <span class="type">AVCaptureSession</span>()</span><br><span class="line">        captureSession.sessionPreset = <span class="type">AVCaptureSession</span>.<span class="type">Preset</span>.photo</span><br><span class="line">        cameraOutput = <span class="type">AVCapturePhotoOutput</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> device = <span class="type">AVCaptureDevice</span>.<span class="keyword">default</span>(<span class="keyword">for</span>: .video)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">let</span> input = <span class="keyword">try</span>? <span class="type">AVCaptureDeviceInput</span>.<span class="keyword">init</span>(device: device!) &#123;</span><br><span class="line">            <span class="keyword">if</span>(captureSession.canAddInput(input)) &#123;</span><br><span class="line">                captureSession.addInput(input)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(captureSession.canAddOutput(cameraOutput)) &#123;</span><br><span class="line">                    captureSession.addOutput(cameraOutput)</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                previewLayer = <span class="type">AVCaptureVideoPreviewLayer</span>.<span class="keyword">init</span>(session: captureSession)</span><br><span class="line">                previewLayer.videoGravity = .resizeAspectFill</span><br><span class="line">                previewLayer.frame = <span class="type">CGRect</span>.<span class="keyword">init</span>(x: <span class="number">0</span>, y: <span class="number">0</span>, width: <span class="number">200</span>, height: <span class="number">200</span>)</span><br><span class="line">                captureView.layer.addSublayer(previewLayer)</span><br><span class="line">                captureSession.startRunning()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è·å–ç…§ç‰‡</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">launchUI</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">let</span> setting = <span class="type">AVCapturePhotoSettings</span>()</span><br><span class="line">    <span class="comment">// xcode9's Bug</span></span><br><span class="line">    <span class="keyword">let</span> previewPixelType = setting.__availablePreviewPhotoPixelFormatTypes.first!</span><br><span class="line">    <span class="keyword">let</span> previewFormat = [ kCVPixelBufferPixelFormatTypeKey <span class="keyword">as</span> <span class="type">String</span>: previewPixelType,</span><br><span class="line">                          kCVPixelBufferWidthKey <span class="keyword">as</span> <span class="type">String</span>: <span class="string">"<span class="subst">\(captureView.bounds.size.width)</span>"</span>,</span><br><span class="line">                          kCVPixelBufferHeightKey <span class="keyword">as</span> <span class="type">String</span>: <span class="string">"<span class="subst">\(captureView.bounds.size.height)</span>"</span>] <span class="keyword">as</span> [<span class="type">String</span> : <span class="type">Any</span>]</span><br><span class="line">    setting.previewPhotoFormat = previewFormat</span><br><span class="line">    cameraOutput.capturePhoto(with: setting, delegate: <span class="keyword">self</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AVCapturePhotoCaptureDelegate</span></span><br><span class="line"><span class="func"><span class="keyword">func</span> <span class="title">photoOutput</span><span class="params">(<span class="number">_</span> output: AVCapturePhotoOutput, didFinishProcessingPhoto photo: AVCapturePhoto, error: Error?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> error != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"error occured: <span class="subst">\(error!.localizedDescription)</span>"</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">let</span> imageData = photo.fileDataRepresentation(),<span class="keyword">let</span> image = <span class="type">UIImage</span>.<span class="keyword">init</span>(data: imageData) &#123;</span><br><span class="line">       <span class="comment">// Predict</span></span><br><span class="line">       <span class="keyword">self</span>.predict(image: image)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>åœ¨Xcode9ä¸ŠavailablePreviewPhotoPixelFormatTypesè¿™ä¸ªå±æ€§å‰é¢éœ€è¦åŠ ä¸ŠåŒä¸‹åˆ’çº¿,æ›´é«˜ç‰ˆæœ¬åˆ™ä¸éœ€è¦</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2017_11_03_01.png" alt=""></p>
<p>3.å›¾ç‰‡å¤„ç†é¢„æµ‹</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> <span class="func"><span class="keyword">func</span> <span class="title">predict</span><span class="params">(image:UIImage)</span></span> &#123;</span><br><span class="line"><span class="comment">//        if let data = UIImagePNGRepresentation(image) &#123;</span></span><br><span class="line"><span class="comment">//            let fileName = getDocumentsDirectory().appendingPathComponent("captureImage")</span></span><br><span class="line"><span class="comment">//            print("fleName:\(fileName)")</span></span><br><span class="line"><span class="comment">//            try? data.write(to: fileName)</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        <span class="keyword">let</span> model = <span class="keyword">try</span>! <span class="type">VNCoreMLModel</span>.<span class="keyword">init</span>(<span class="keyword">for</span>: <span class="type">VGG16</span>().model)</span><br><span class="line">        <span class="keyword">let</span> request = <span class="type">VNCoreMLRequest</span>.<span class="keyword">init</span>(model: model, completionHandler: &#123; (request:<span class="type">VNRequest</span>, error:<span class="type">Error</span>?) <span class="keyword">in</span></span><br><span class="line">            <span class="keyword">weak</span> <span class="keyword">var</span> weakSelf = <span class="keyword">self</span></span><br><span class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> results = request.results <span class="keyword">as</span>? [<span class="type">VNClassificationObservation</span>] <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">fatalError</span>(<span class="string">"no result"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> bestPrediction = <span class="string">""</span></span><br><span class="line">            <span class="keyword">var</span> bestConfidence:<span class="type">VNConfidence</span> = <span class="number">0</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> classfication:<span class="type">VNClassificationObservation</span> <span class="keyword">in</span> results &#123;</span><br><span class="line">                <span class="keyword">if</span> classfication.confidence &gt; bestConfidence &#123;</span><br><span class="line">                    bestConfidence = classfication.confidence</span><br><span class="line">                    bestPrediction = classfication.identifier</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          </span><br><span class="line">            weakSelf!.say(string: <span class="string">"<span class="subst">\(bestPrediction)</span>"</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="type">DispatchQueue</span>.main.asyncAfter(deadline: <span class="type">DispatchTime</span>.now() + <span class="number">5</span>, execute: &#123;</span><br><span class="line">                weakSelf!.launchUI()</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">let</span> handler = <span class="type">VNImageRequestHandler</span>.<span class="keyword">init</span>(cgImage: image.cgImage!)</span><br><span class="line">        <span class="keyword">try</span>? handler.perform([request])</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>4.è¯­éŸ³æ’­æŠ¥<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">func <span class="title">say</span><span class="params">(<span class="built_in">string</span>: String)</span> </span>&#123;</span><br><span class="line">      uttrence = AVSpeechUtterance.init(<span class="built_in">string</span>: <span class="built_in">string</span>)</span><br><span class="line">      uttrence.rate = <span class="number">0.3</span></span><br><span class="line">      uttrence.voice = AVSpeechSynthesisVoice.init(language: <span class="string">"zh_CN"</span>)</span><br><span class="line">      uttrence.pitchMultiplier = <span class="number">0.8</span></span><br><span class="line">      uttrence.postUtteranceDelay = <span class="number">0.2</span></span><br><span class="line">      synthe.speak(uttrence)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œé¢é€‰æ‹©çš„æ˜¯æ±‰è¯­ï¼Œä¸ç®¡é€‰æ‹©çš„æ˜¯ä»€ä¹ˆè¯­éŸ³ç§ç±»ï¼Œè‹±è¯­éƒ½æ˜¯æ”¯æŒçš„</p>
<p>5.æ•ˆæœæ¼”ç¤º</p>
<p><img src="http://7xqjid.com1.z0.glb.clouddn.com/2019_11_03_02.gif" alt=""></p>
<p><a href="https://github.com/ChinaFishNews/CoreML-and-Siri.git" target="_blank" rel="external">Demoä¸‹è½½</a></p>
<hr>
<p>å¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–é—®é¢˜è¯·è”ç³»æˆ‘:fishnewsdream@gmail.com,æ¬¢è¿äº¤æµï¼Œå…±åŒæé«˜ï¼</p>
<p>Objective-C/SwiftæŠ€æœ¯å¼€å‘äº¤æµç¾¤201556264ï¼Œè®¨è®ºä½•ç§æŠ€æœ¯å¹¶ä¸å—é™ï¼Œæ¬¢è¿å„ä½å¤§ç‰›ç™¾å®¶äº‰é¸£ï¼</p>
<p><a href="http://www.ggteach.com/index.html" target="_blank" rel="external">åˆšåˆšåœ¨çº¿å·¥ä½œå®¤</a>ï¼Œæ¬¢è¿å…³æ³¨æˆ–æå‡ºå»ºè®¾æ€§æ„è§ï¼</p>
<p><a href="http://bbs.ggteach.com" target="_blank" rel="external">åˆšåˆšåœ¨çº¿è®ºå›</a>, æ¬¢è¿è¸Šè·ƒæé—®æˆ–è§£ç­”ï¼</p>
<p>å¦‚æœ‰è½¬è½½ï¼Œè¯·æ³¨æ˜å‡ºå¤„ï¼Œè°¢è°¢ï¼</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Core-ML-Siri-AVFoundation/">Core ML, Siri, AVFoundation</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Swift/">Swift</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 å«ç¬‘é¥®ç ’éœœ
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<span id="busuanzi_container_site_pv">
    æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
</span>
<span id="busuanzi_container_page_pv">
  æœ¬æ–‡æ€»é˜…è¯»é‡<span id="busuanzi_value_page_pv"></span>æ¬¡
</span>
</footer>

    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>